INFO:root:Results will be dumped in results/afa/cub_afa
DEBUG:root:And the dataset's root directory is /home/xty20/cem/cem/data/CUB200/
[rank: 0] Global seed set to 42
[rank: 0] Global seed set to 42
{
    "batch_size": 128,
    "check_val_every_n_epoch": 3,
    "competence_levels": [
        1,
        0
    ],
    "dataset": "cub",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "afacem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "num_workers": 8,
    "results_dir": "results/afa/cub_afa",
    "root_dir": "/home/xty20/cem/cem/data/CUB200/",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 0.1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "num_rollouts": 1,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.25,
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 128,
            "clip_gradient": 0.1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "ML",
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 50,
            "n_components": 200,
            "num_samples": 10,
            "optimizer": "adam",
            "patience": 3,
            "prior": "autoreg",
            "prior_hids": [
                1,
                1
            ],
            "prior_layers": 2,
            "prior_units": 1,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "AF"
            ],
            "weight_decay": 0.01
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": true,
            "ent_coef": 0.0,
            "lin_layers": [
                512,
                512,
                256,
                256
            ],
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "allow_no_action": false,
        "bool": false,
        "c_extractor_arch": "resnet34",
        "cbm_aneal_rate": 1,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_cbm_loss",
        "emb_size": 16,
        "enable_checkpointing": true,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "mask_no_action": true,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_ac_model": true,
        "train_afa_model": true,
        "training_intervention_prob": 0.25,
        "weight_decay": 0.001,
        "weight_loss": true
    },
    "trials": 1
}
		Selected concepts: [0, 1, 2, 3, 37, 38, 39, 40, 41, 42, 43, 44, 51, 52, 76, 77, 86, 87, 88, 99, 100, 101]
		Updated concept group map (with 7 groups):
			has_bill_shape -> [0, 1, 2, 3]
			has_head_pattern -> [4, 5]
			has_breast_color -> [6, 7, 8, 9, 10, 11]
			has_bill_length -> [12, 13]
			has_wing_shape -> [14, 15]
			has_tail_pattern -> [16, 17, 18]
			has_bill_color -> [19, 20, 21]
INFO:root:Training sample shape is: torch.Size([128, 3, 299, 299]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([128]) with type torch.LongTensor
INFO:root:	Number of output classes: 200
INFO:root:Training concept shape is: torch.Size([128, 22]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 22
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240512_121338-jpdic6v6
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run ac_flow_model_split_0
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_test
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_test/runs/jpdic6v6
DEBUG:root:AC Model input shape:	x:torch.Size([22])	b:torch.Size([22])	m:torch.Size([22])	y:torch.Size([])AC Data loader batch size: 128
DEBUG:root:Found AC flow model saved in results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:root:<class 'cem.models.acflow.ACFlow'>
False
DEBUG:root:Restarting run because we could not find test_accuracy_ACFlowModel in old results.
DEBUG:root:Getting test results without interventions.
[TRIAL 1/1 BEGINS AT 12/05/2024 at 12:13:37

Testing: 0it [00:00, ?it/s]
Testing:   0%|          | 0/46 [00:00<?, ?it/s]
Testing DataLoader 0:   0%|          | 0/46 [00:00<?, ?it/s]
Testing DataLoader 0:   2%|‚ñè         | 1/46 [00:02<01:50,  2.46s/it]
Testing DataLoader 0:   4%|‚ñç         | 2/46 [00:02<00:59,  1.36s/it]
Testing DataLoader 0:   7%|‚ñã         | 3/46 [00:02<00:42,  1.01it/s]
Testing DataLoader 0:   9%|‚ñä         | 4/46 [00:03<00:34,  1.23it/s]
Testing DataLoader 0:  11%|‚ñà         | 5/46 [00:03<00:28,  1.43it/s]
Testing DataLoader 0:  13%|‚ñà‚ñé        | 6/46 [00:03<00:25,  1.60it/s]
Testing DataLoader 0:  15%|‚ñà‚ñå        | 7/46 [00:04<00:22,  1.74it/s]
Testing DataLoader 0:  17%|‚ñà‚ñã        | 8/46 [00:04<00:20,  1.87it/s]
Testing DataLoader 0:  20%|‚ñà‚ñâ        | 9/46 [00:04<00:18,  1.98it/s]
Testing DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 10/46 [00:04<00:17,  2.08it/s]
Testing DataLoader 0:  24%|‚ñà‚ñà‚ñç       | 11/46 [00:05<00:16,  2.18it/s]
Testing DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 12/46 [00:05<00:15,  2.26it/s]
Testing DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 13/46 [00:05<00:14,  2.33it/s]
Testing DataLoader 0:  30%|‚ñà‚ñà‚ñà       | 14/46 [00:05<00:13,  2.40it/s]
Testing DataLoader 0:  33%|‚ñà‚ñà‚ñà‚ñé      | 15/46 [00:06<00:12,  2.46it/s]
Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñç      | 16/46 [00:06<00:11,  2.52it/s]
Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 17/46 [00:06<00:11,  2.57it/s]
Testing DataLoader 0:  39%|‚ñà‚ñà‚ñà‚ñâ      | 18/46 [00:06<00:10,  2.62it/s]
Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 19/46 [00:07<00:10,  2.67it/s]
Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 20/46 [00:07<00:09,  2.71it/s]
Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 21/46 [00:07<00:09,  2.75it/s]
Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 22/46 [00:07<00:08,  2.78it/s]
Testing DataLoader 0:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 23/46 [00:08<00:08,  2.82it/s]
Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 24/46 [00:08<00:07,  2.85it/s]
Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 25/46 [00:08<00:07,  2.88it/s]
Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 26/46 [00:08<00:06,  2.91it/s]
Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 27/46 [00:09<00:06,  2.94it/s]
Testing DataLoader 0:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 28/46 [00:09<00:06,  2.96it/s]
Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 29/46 [00:09<00:05,  2.99it/s]
Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 30/46 [00:09<00:05,  3.01it/s]
Testing DataLoader 0:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 31/46 [00:10<00:04,  3.03it/s]
Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 32/46 [00:10<00:04,  3.05it/s]
Testing DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 33/46 [00:10<00:04,  3.07it/s]
Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 34/46 [00:11<00:03,  3.09it/s]
Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 35/46 [00:11<00:03,  3.11it/s]
Testing DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 36/46 [00:11<00:03,  3.12it/s]
Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 37/46 [00:11<00:02,  3.14it/s]
Testing DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 38/46 [00:12<00:02,  3.16it/s]
Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 39/46 [00:12<00:02,  3.17it/s]
Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 40/46 [00:12<00:01,  3.18it/s]
Testing DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 41/46 [00:12<00:01,  3.20it/s]
Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 42/46 [00:13<00:01,  3.21it/s]
Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 43/46 [00:13<00:00,  3.22it/s]
Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 44/46 [00:13<00:00,  3.24it/s]
Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 45/46 [00:13<00:00,  3.25it/s]
Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 46/46 [00:13<00:00,  3.29it/s]
Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 46/46 [00:13<00:00,  3.29it/s]wandb: - 0.014 MB of 0.014 MB uploaded
wandb: \ 0.014 MB of 0.014 MB uploaded
wandb: | 0.014 MB of 0.014 MB uploaded
wandb: / 0.024 MB of 0.024 MB uploaded
wandb:                                                                                
wandb: üöÄ View run ac_flow_model_split_0 at: https://wandb.ai/thomasyuan/cub_test/runs/jpdic6v6
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_test
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240512_121338-jpdic6v6/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
[rank: 0] Global seed set to 42
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240512_121403-1usu8bnn
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_test
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_test/runs/1usu8bnn
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1.ckpt
DEBUG:root:Loaded model
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Testing with budget None

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Test metric             DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      test_accuracy         0.4421815574169159
        test_nll            -0.8886246085166931
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
AC Model test_accuracy: 44.22%, 
AC Model test_nll: -88.86%, 
AC Model training_time: 27594.26%, 
AC Model num_epochs: 2100.00%, 
with 21.0 epochs in 275.94 seconds
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	weight_loss -> True
	c_extractor_arch -> resnet34
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_cbm_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> True
	only_train_ac_model -> False
	allow_no_action -> False
	mask_no_action -> True
	train_afa_model -> True
	continue_training -> False
	cbm_aneal_rate -> 1
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'architecture': 'flow', 'max_epochs': 50, 'batch_size': 128, 'transformations': ['AF', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['ML', 'LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 200, 'prior_units': 1, 'prior_layers': 2, 'prior_hids': [1, 1], 'optimizer': 'adam', 'learning_rate': 0.0001, 'weight_decay': 0.01, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 0.1, 'num_samples': 10, 'patience': 3, 'save_path': 'results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt'}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'lin_layers': [512, 512, 256, 256], 'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': True, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 1
	results_dir -> results/afa/cub_afa
	dataset -> cub
	num_workers -> 8
	batch_size -> 128
	root_dir -> /home/xty20/cem/cem/data/CUB200/
	sampling_percent -> 0.25
	sampling_groups -> True
	competence_levels -> [1, 0]
	check_val_every_n_epoch -> 3
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['afacem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	max_epochs -> 300
	time_last_called -> 2024/05/12 at 12:13:32
	n_concepts -> 22
	n_tasks -> 200
	concept_map -> {'has_bill_shape': [0, 1, 2, 3], 'has_head_pattern': [4, 5], 'has_breast_color': [6, 7, 8, 9, 10, 11], 'has_bill_length': [12, 13], 'has_wing_shape': [14, 15], 'has_tail_pattern': [16, 17, 18], 'has_bill_color': [19, 20, 21]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 0.1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	num_rollouts -> 1
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 24489665 ]
[Number of non-trainable parameters in model 2299229 ]
	Found cached model... loading it
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
DEBUG:root:Getting test results without interventions
DEBUG:root:Testing with budget None
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        Test metric               DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ent_loss                      0.0
          pg_loss            -0.0045936089009046555
      test_agent_loss          0.02897859364748001
     test_avg_c_y_acc          0.7944111397784184
      test_c_accuracy          0.9352329640309608
        test_c_auc              0.882309514916601
         test_c_f1             0.8895155442058229
       test_cbm_loss            6.873708724975586
     test_concept_loss          4.24691915512085
    test_current_steps         1096.1920166015625
    test_horizon_limit                 2.0
test_intervention_accuracy     0.7762938230383973
   test_intervention_auc               0.0
  test_intervention_loss       0.02897859364748001
test_intervention_task_loss    2.6267895698547363
         test_loss             6.9026875495910645
    test_mask_accuracy                 0.0
      test_task_loss                   0.0
      test_y_accuracy          0.6535893155258765
        test_y_auc                     0.0
         test_y_f1             0.5264147807134674
          v_loss               0.29437950253486633
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
val_c_acc: 93.52%, val_y_acc: 65.36%, val_c_auc: 88.23%, val_y_auc: 0.00% with 42.0 epochs in 2261.31 seconds
wandb: - 0.014 MB of 0.014 MB uploaded
wandb: \ 0.014 MB of 0.026 MB uploaded
wandb: | 0.014 MB of 0.031 MB uploaded
wandb: / 0.014 MB of 0.031 MB uploaded
wandb: - 0.031 MB of 0.031 MB uploaded
wandb:                                                                                
wandb: üöÄ View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1 at: https://wandb.ai/thomasyuan/cub_test/runs/1usu8bnn
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_test
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240512_121403-1usu8bnn/logs
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        Test metric               DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ent_loss                      0.0
          pg_loss             -0.007775212172418833
      test_agent_loss         0.039289213716983795
     test_avg_c_y_acc          0.7953486365205388
      test_c_accuracy          0.9355367621677599
        test_c_auc              0.919672409594299
         test_c_f1              0.80124670337223
       test_cbm_loss            6.675674915313721
     test_concept_loss          4.159456729888916
    test_current_steps          1124.135009765625
    test_horizon_limit                 2.0
test_intervention_accuracy     0.8077321366931308
   test_intervention_auc               0.0
  test_intervention_loss      0.039289213716983795
test_intervention_task_loss    2.5162181854248047
         test_loss              6.714964866638184
    test_mask_accuracy                 0.0
      test_task_loss                   0.0
      test_y_accuracy          0.6551605108733172
        test_y_auc                     0.0
         test_y_f1             0.18964278436939014
          v_loss               0.40066733956336975
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
c_acc: 93.55%, y_acc: 65.52%, c_auc: 91.97%, y_auc: 0.00% with 42.0 epochs in 2261.31 seconds
DEBUG:root:Restarting run because we could not find test_acc_y_afacem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
[rank: 0] Global seed set to 42
DEBUG:root:		Test accuracy when intervening with 0 concept groups is 54.76% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:		Test accuracy when intervening with 1 concept groups is 67.69% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:		Test accuracy when intervening with 2 concept groups is 73.14% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:		Test accuracy when intervening with 3 concept groups is 76.91% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:		Test accuracy when intervening with 4 concept groups is 82.95% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:		Test accuracy when intervening with 5 concept groups is 85.31% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:		Test accuracy when intervening with 6 concept groups is 89.21% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:		Test accuracy when intervening with 7 concept groups is 92.73% (avg int time is 0.00215s and construction time is 0.00022s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
[rank: 0] Global seed set to 42
DEBUG:root:		Test accuracy when intervening with 0 concept groups is 65.48% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:		Test accuracy when intervening with 1 concept groups is 83.29% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:		Test accuracy when intervening with 2 concept groups is 89.39% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:		Test accuracy when intervening with 3 concept groups is 91.61% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:		Test accuracy when intervening with 4 concept groups is 92.15% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:		Test accuracy when intervening with 5 concept groups is 92.22% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:		Test accuracy when intervening with 6 concept groups is 92.03% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:		Test accuracy when intervening with 7 concept groups is 90.99% (avg int time is 0.00107s and construction time is 0.00023s).
DEBUG:root:Restarting run because we could not find test_acc_y_group_random_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
[rank: 0] Global seed set to 42
DEBUG:root:		Test accuracy when intervening with 0 concept groups is 65.48% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 1 concept groups is 69.66% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 2 concept groups is 73.42% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 3 concept groups is 77.01% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 4 concept groups is 80.70% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 5 concept groups is 84.50% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 6 concept groups is 87.92% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 7 concept groups is 90.99% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:Restarting run because we could not find test_acc_y_afacem_policy_ints_co_0_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
[rank: 0] Global seed set to 42
DEBUG:root:		Test accuracy when intervening with 0 concept groups is 65.48% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:		Test accuracy when intervening with 1 concept groups is 27.60% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:		Test accuracy when intervening with 2 concept groups is 9.60% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:		Test accuracy when intervening with 3 concept groups is 4.28% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:		Test accuracy when intervening with 4 concept groups is 1.36% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:		Test accuracy when intervening with 5 concept groups is 0.35% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:		Test accuracy when intervening with 6 concept groups is 0.00% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:		Test accuracy when intervening with 7 concept groups is 0.00% (avg int time is 0.00216s and construction time is 0.00011s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_co_0_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
[rank: 0] Global seed set to 42
DEBUG:root:		Test accuracy when intervening with 0 concept groups is 65.48% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:		Test accuracy when intervening with 1 concept groups is 72.28% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:		Test accuracy when intervening with 2 concept groups is 66.14% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:		Test accuracy when intervening with 3 concept groups is 49.10% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:		Test accuracy when intervening with 4 concept groups is 24.75% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:		Test accuracy when intervening with 5 concept groups is 6.54% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:		Test accuracy when intervening with 6 concept groups is 0.28% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:		Test accuracy when intervening with 7 concept groups is 0.00% (avg int time is 0.00108s and construction time is 0.00009s).
DEBUG:root:Restarting run because we could not find test_acc_y_group_random_no_prior_ints_co_0_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
[rank: 0] Global seed set to 42
DEBUG:root:		Test accuracy when intervening with 0 concept groups is 65.48% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 1 concept groups is 48.00% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 2 concept groups is 28.22% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 3 concept groups is 13.07% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 4 concept groups is 4.07% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 5 concept groups is 1.05% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 6 concept groups is 0.14% (avg int time is 0.00073s and construction time is 0.00004s).
DEBUG:root:		Test accuracy when intervening with 7 concept groups is 0.00% (avg int time is 0.00073s and construction time is 0.00004s).
[rank: 0] Global seed set to 42
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1.ckpt

Predicting: 0it [00:00, ?it/s]
Predicting:   0%|          | 0/46 [00:00<?, ?it/s]
Predicting DataLoader 0:   0%|          | 0/46 [00:00<?, ?it/s]
Predicting DataLoader 0:   2%|‚ñè         | 1/46 [00:00<00:00, 93.55it/s]
Predicting DataLoader 0:   4%|‚ñç         | 2/46 [00:00<00:01, 23.40it/s]
Predicting DataLoader 0:   7%|‚ñã         | 3/46 [00:00<00:02, 18.22it/s]
Predicting DataLoader 0:   9%|‚ñä         | 4/46 [00:00<00:02, 16.72it/s]
Predicting DataLoader 0:  11%|‚ñà         | 5/46 [00:00<00:02, 15.90it/s]
Predicting DataLoader 0:  13%|‚ñà‚ñé        | 6/46 [00:00<00:02, 14.95it/s]
Predicting DataLoader 0:  15%|‚ñà‚ñå        | 7/46 [00:00<00:02, 14.85it/s]
Predicting DataLoader 0:  17%|‚ñà‚ñã        | 8/46 [00:00<00:02, 14.86it/s]
Predicting DataLoader 0:  20%|‚ñà‚ñâ        | 9/46 [00:00<00:02, 14.57it/s]
Predicting DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 10/46 [00:00<00:02, 14.34it/s]
Predicting DataLoader 0:  24%|‚ñà‚ñà‚ñç       | 11/46 [00:00<00:02, 13.92it/s]
Predicting DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 12/46 [00:00<00:02, 13.71it/s]
Predicting DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 13/46 [00:00<00:02, 13.67it/s]
Predicting DataLoader 0:  30%|‚ñà‚ñà‚ñà       | 14/46 [00:01<00:02, 13.62it/s]
Predicting DataLoader 0:  33%|‚ñà‚ñà‚ñà‚ñé      | 15/46 [00:01<00:02, 13.67it/s]
Predicting DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñç      | 16/46 [00:01<00:02, 13.70it/s]
Predicting DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 17/46 [00:01<00:02, 13.64it/s]
Predicting DataLoader 0:  39%|‚ñà‚ñà‚ñà‚ñâ      | 18/46 [00:01<00:02, 13.56it/s]
Predicting DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 19/46 [00:01<00:02, 13.47it/s]
Predicting DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 20/46 [00:01<00:01, 13.44it/s]
Predicting DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 21/46 [00:01<00:01, 13.45it/s]
Predicting DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 22/46 [00:01<00:01, 13.43it/s]
Predicting DataLoader 0:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 23/46 [00:01<00:01, 13.46it/s]
Predicting DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 24/46 [00:01<00:01, 13.48it/s]
Predicting DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 25/46 [00:01<00:01, 13.48it/s]
Predicting DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 26/46 [00:01<00:01, 13.46it/s]
Predicting DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 27/46 [00:02<00:01, 13.45it/s]
Predicting DataLoader 0:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 28/46 [00:02<00:01, 13.46it/s]
Predicting DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 29/46 [00:02<00:01, 13.44it/s]
Predicting DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 30/46 [00:02<00:01, 13.42it/s]
Predicting DataLoader 0:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 31/46 [00:02<00:01, 13.46it/s]
Predicting DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 32/46 [00:02<00:01, 13.48it/s]
Predicting DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 33/46 [00:02<00:00, 13.53it/s]
Predicting DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 34/46 [00:02<00:00, 13.53it/s]
Predicting DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 35/46 [00:02<00:00, 13.54it/s]
Predicting DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 36/46 [00:02<00:00, 13.58it/s]
Predicting DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 37/46 [00:02<00:00, 13.60it/s]
Predicting DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 38/46 [00:02<00:00, 13.61it/s]
Predicting DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 39/46 [00:02<00:00, 13.65it/s]
Predicting DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 40/46 [00:02<00:00, 13.67it/s]
Predicting DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 41/46 [00:02<00:00, 13.70it/s]
Predicting DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 42/46 [00:03<00:00, 13.71it/s]
Predicting DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 43/46 [00:03<00:00, 13.71it/s]
Predicting DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 44/46 [00:03<00:00, 13.74it/s]
Predicting DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 45/46 [00:03<00:00, 13.75it/s]
Predicting DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 46/46 [00:03<00:00, 13.79it/s]
Predicting DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 46/46 [00:03<00:00, 13.49it/s]INFO:root:Computing OIS score...


  0%|          | 0/22 [00:00<?, ?it/s]
  0%|          | 0/22 [00:06<?, ?it/s]
Process SpawnProcess-57:
Traceback (most recent call last):
  File "/usr/local/software/master/python/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
  File "/usr/local/software/master/python/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 19, in _save_result
    result = fun(**kwargs)
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 90, in load_call
    return function(**kwargs), False
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/metrics/oracle.py", line 695, in oracle_impurity_score
    pred_matrix = concept_purity_matrix(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/metrics/oracle.py", line 364, in concept_purity_matrix
    estimator.fit(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/utils/traceback_utils.py", line 70, in error_handler
    raise e.with_traceback(filtered_tb) from None
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/tensorflow/python/eager/execute.py", line 53, in quick_execute
    tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
tensorflow.python.framework.errors_impl.InternalError: Graph execution error:

Detected at node 'Adam/StatefulPartitionedCall_2' defined at (most recent call last):
    File "<string>", line 1, in <module>
    File "/usr/local/software/master/python/3.8/lib/python3.8/multiprocessing/spawn.py", line 116, in spawn_main
      exitcode = _main(fd, parent_sentinel)
    File "/usr/local/software/master/python/3.8/lib/python3.8/multiprocessing/spawn.py", line 129, in _main
      return self._bootstrap(parent_sentinel)
    File "/usr/local/software/master/python/3.8/lib/python3.8/multiprocessing/process.py", line 315, in _bootstrap
      self.run()
    File "/usr/local/software/master/python/3.8/lib/python3.8/multiprocessing/process.py", line 108, in run
      self._target(*self._args, **self._kwargs)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 19, in _save_result
      result = fun(**kwargs)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 90, in load_call
      return function(**kwargs), False
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/metrics/oracle.py", line 695, in oracle_impurity_score
      pred_matrix = concept_purity_matrix(
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/metrics/oracle.py", line 364, in concept_purity_matrix
      estimator.fit(
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/utils/traceback_utils.py", line 65, in error_handler
      return fn(*args, **kwargs)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/engine/training.py", line 1742, in fit
      tmp_logs = self.train_function(iterator)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/engine/training.py", line 1338, in train_function
      return step_function(self, iterator)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/engine/training.py", line 1322, in step_function
      outputs = model.distribute_strategy.run(run_step, args=(data,))
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/engine/training.py", line 1303, in run_step
      outputs = model.train_step(data)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/engine/training.py", line 1084, in train_step
      self.optimizer.minimize(loss, self.trainable_variables, tape=tape)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/optimizers/optimizer.py", line 544, in minimize
      self.apply_gradients(grads_and_vars)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/optimizers/optimizer.py", line 1230, in apply_gradients
      return super().apply_gradients(grads_and_vars, name=name)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/optimizers/optimizer.py", line 652, in apply_gradients
      iteration = self._internal_apply_gradients(grads_and_vars)
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/optimizers/optimizer.py", line 1260, in _internal_apply_gradients
      return tf.__internal__.distribute.interim.maybe_merge_call(
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/optimizers/optimizer.py", line 1352, in _distributed_apply_gradients_fn
      distribution.extended.update(
    File "/home/xty20/cem/venv/lib/python3.8/site-packages/keras/src/optimizers/optimizer.py", line 1347, in apply_grad_to_update_var
      return self._update_step_xla(grad, var, id(self._var_key(var)))
Node: 'Adam/StatefulPartitionedCall_2'
libdevice not found at ./libdevice.10.bc
	 [[{{node Adam/StatefulPartitionedCall_2}}]] [Op:__inference_train_function_707]
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 913, in <module>
    main(
  File "experiments/run_experiments_rl.py", line 536, in main
    training.evaluate_representation_metrics(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 1847, in evaluate_representation_metrics
    ois, loaded = utils.execute_and_save(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 48, in execute_and_save
    raise ValueError(
ValueError: Subprocess of saving to results/afa/cub_afa/test_ois_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_split_0.joblib failed!
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 27, in <module>
    import cem.interventions.utils as intervention_utils
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 655, in _load_unlocked
  File "<frozen importlib._bootstrap>", line 618, in _load_backward_compatible
  File "<frozen zipimport>", line 259, in load_module
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/interventions/utils.py", line 25, in <module>
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 655, in _load_unlocked
  File "<frozen importlib._bootstrap>", line 618, in _load_backward_compatible
  File "<frozen zipimport>", line 241, in load_module
  File "<frozen zipimport>", line 709, in _get_module_code
  File "<frozen zipimport>", line 536, in _get_data
KeyboardInterrupt
INFO:root:Results will be dumped in results/afa/cub_afa
DEBUG:root:And the dataset's root directory is /home/xty20/cem/cem/data/CUB200/
[rank: 0] Global seed set to 42
[rank: 0] Global seed set to 42
{
    "batch_size": 128,
    "check_val_every_n_epoch": 3,
    "competence_levels": [
        1,
        0
    ],
    "dataset": "cub",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "afacem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "num_workers": 8,
    "results_dir": "results/afa/cub_afa",
    "root_dir": "/home/xty20/cem/cem/data/CUB200/",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 0.1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "num_rollouts": 1,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.25,
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 128,
            "clip_gradient": 0.1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "ML",
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 50,
            "n_components": 200,
            "num_samples": 10,
            "optimizer": "adam",
            "patience": 3,
            "prior": "autoreg",
            "prior_hids": [
                1,
                1
            ],
            "prior_layers": 2,
            "prior_units": 1,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "AF"
            ],
            "weight_decay": 0.01
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": true,
            "ent_coef": 0.0,
            "lin_layers": [
                512,
                512,
                256,
                256
            ],
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "allow_no_action": false,
        "bool": false,
        "c_extractor_arch": "resnet34",
        "cbm_aneal_rate": 1,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_cbm_loss",
        "emb_size": 16,
        "enable_checkpointing": true,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "mask_no_action": true,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_ac_model": true,
        "train_afa_model": true,
        "training_intervention_prob": 0.25,
        "weight_decay": 0.001,
        "weight_loss": true
    },
    "trials": 1
}
		Selected concepts: [0, 1, 2, 3, 37, 38, 39, 40, 41, 42, 43, 44, 51, 52, 76, 77, 86, 87, 88, 99, 100, 101]
		Updated concept group map (with 7 groups):
			has_bill_shape -> [0, 1, 2, 3]
			has_head_pattern -> [4, 5]
			has_breast_color -> [6, 7, 8, 9, 10, 11]
			has_bill_length -> [12, 13]
			has_wing_shape -> [14, 15]
			has_tail_pattern -> [16, 17, 18]
			has_bill_color -> [19, 20, 21]
INFO:root:Training sample shape is: torch.Size([128, 3, 299, 299]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([128]) with type torch.LongTensor
INFO:root:	Number of output classes: 200
INFO:root:Training concept shape is: torch.Size([128, 22]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 22
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240512_122941-1egqbnhl
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run ac_flow_model_split_0
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_test
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_test/runs/1egqbnhl
DEBUG:root:AC Model input shape:	x:torch.Size([22])	b:torch.Size([22])	m:torch.Size([22])	y:torch.Size([])AC Data loader batch size: 128
DEBUG:root:Found AC flow model saved in results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:root:<class 'cem.models.acflow.ACFlow'>
False
DEBUG:root:Restarting run because we could not find test_accuracy_ACFlowModel in old results.
DEBUG:root:Getting test results without interventions.
[TRIAL 1/1 BEGINS AT 12/05/2024 at 12:29:40

Testing: 0it [00:00, ?it/s]
Testing:   0%|          | 0/46 [00:00<?, ?it/s]
Testing DataLoader 0:   0%|          | 0/46 [00:00<?, ?it/s]
Testing DataLoader 0:   2%|‚ñè         | 1/46 [00:00<00:30,  1.48it/s]
Testing DataLoader 0:   4%|‚ñç         | 2/46 [00:00<00:20,  2.13it/s]
Testing DataLoader 0:   7%|‚ñã         | 3/46 [00:01<00:17,  2.50it/s]
Testing DataLoader 0:   9%|‚ñä         | 4/46 [00:01<00:15,  2.74it/s]
Testing DataLoader 0:  11%|‚ñà         | 5/46 [00:01<00:14,  2.91it/s]
Testing DataLoader 0:  13%|‚ñà‚ñé        | 6/46 [00:01<00:13,  3.03it/s]
Testing DataLoader 0:  15%|‚ñà‚ñå        | 7/46 [00:02<00:12,  3.13it/s]
Testing DataLoader 0:  17%|‚ñà‚ñã        | 8/46 [00:02<00:11,  3.21it/s]
Testing DataLoader 0:  20%|‚ñà‚ñâ        | 9/46 [00:02<00:11,  3.27it/s]
Testing DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 10/46 [00:03<00:10,  3.32it/s]
Testing DataLoader 0:  24%|‚ñà‚ñà‚ñç       | 11/46 [00:03<00:10,  3.36it/s]
Testing DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 12/46 [00:03<00:10,  3.39it/s]
Testing DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 13/46 [00:03<00:09,  3.43it/s]
Testing DataLoader 0:  30%|‚ñà‚ñà‚ñà       | 14/46 [00:04<00:09,  3.45it/s]
Testing DataLoader 0:  33%|‚ñà‚ñà‚ñà‚ñé      | 15/46 [00:04<00:08,  3.48it/s]
Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñç      | 16/46 [00:04<00:08,  3.50it/s]
Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 17/46 [00:04<00:08,  3.52it/s]
Testing DataLoader 0:  39%|‚ñà‚ñà‚ñà‚ñâ      | 18/46 [00:05<00:07,  3.53it/s]
Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 19/46 [00:05<00:07,  3.55it/s]
Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 20/46 [00:05<00:07,  3.56it/s]
Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 21/46 [00:05<00:06,  3.58it/s]
Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 22/46 [00:06<00:06,  3.59it/s]
Testing DataLoader 0:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 23/46 [00:06<00:06,  3.60it/s]
Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 24/46 [00:06<00:06,  3.61it/s]
Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 25/46 [00:06<00:05,  3.62it/s]
Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 26/46 [00:07<00:05,  3.63it/s]
Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 27/46 [00:07<00:05,  3.63it/s]
Testing DataLoader 0:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 28/46 [00:07<00:04,  3.64it/s]
Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 29/46 [00:07<00:04,  3.65it/s]
Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 30/46 [00:08<00:04,  3.66it/s]
Testing DataLoader 0:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 31/46 [00:08<00:04,  3.66it/s]
Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 32/46 [00:08<00:03,  3.67it/s]
Testing DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 33/46 [00:08<00:03,  3.67it/s]
Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 34/46 [00:09<00:03,  3.68it/s]
Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 35/46 [00:09<00:02,  3.68it/s]
Testing DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 36/46 [00:09<00:02,  3.69it/s]
Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 37/46 [00:10<00:02,  3.69it/s]
Testing DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 38/46 [00:10<00:02,  3.70it/s]
Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 39/46 [00:10<00:01,  3.70it/s]
Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 40/46 [00:10<00:01,  3.70it/s]
Testing DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 41/46 [00:11<00:01,  3.71it/s]
Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 42/46 [00:11<00:01,  3.71it/s]
Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 43/46 [00:11<00:00,  3.72it/s]
Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 44/46 [00:11<00:00,  3.72it/s]
Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 45/46 [00:12<00:00,  3.72it/s]
Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 46/46 [00:12<00:00,  3.77it/s]
Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 46/46 [00:12<00:00,  3.77it/s]wandb: - 0.014 MB of 0.014 MB uploaded
wandb: \ 0.014 MB of 0.014 MB uploaded
wandb: | 0.024 MB of 0.024 MB uploaded
wandb:                                                                                
wandb: üöÄ View run ac_flow_model_split_0 at: https://wandb.ai/thomasyuan/cub_test/runs/1egqbnhl
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_test
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240512_122941-1egqbnhl/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
[rank: 0] Global seed set to 42
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240512_123000-yxlhiwfx
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_test
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_test/runs/yxlhiwfx
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1.ckpt
DEBUG:root:Loaded model
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Testing with budget None

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Test metric             DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      test_accuracy         0.44149118661880493
        test_nll            -0.860091507434845
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
AC Model test_accuracy: 44.15%, 
AC Model test_nll: -86.01%, 
AC Model training_time: 27594.26%, 
AC Model num_epochs: 2100.00%, 
with 21.0 epochs in 275.94 seconds
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	weight_loss -> True
	c_extractor_arch -> resnet34
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_cbm_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> True
	only_train_ac_model -> False
	allow_no_action -> False
	mask_no_action -> True
	train_afa_model -> True
	continue_training -> False
	cbm_aneal_rate -> 1
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'architecture': 'flow', 'max_epochs': 50, 'batch_size': 128, 'transformations': ['AF', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['ML', 'LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 200, 'prior_units': 1, 'prior_layers': 2, 'prior_hids': [1, 1], 'optimizer': 'adam', 'learning_rate': 0.0001, 'weight_decay': 0.01, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 0.1, 'num_samples': 10, 'patience': 3, 'save_path': 'results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt'}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'lin_layers': [512, 512, 256, 256], 'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': True, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 1
	results_dir -> results/afa/cub_afa
	dataset -> cub
	num_workers -> 8
	batch_size -> 128
	root_dir -> /home/xty20/cem/cem/data/CUB200/
	sampling_percent -> 0.25
	sampling_groups -> True
	competence_levels -> [1, 0]
	check_val_every_n_epoch -> 3
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['afacem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	max_epochs -> 300
	time_last_called -> 2024/05/12 at 12:29:37
	n_concepts -> 22
	n_tasks -> 200
	concept_map -> {'has_bill_shape': [0, 1, 2, 3], 'has_head_pattern': [4, 5], 'has_breast_color': [6, 7, 8, 9, 10, 11], 'has_bill_length': [12, 13], 'has_wing_shape': [14, 15], 'has_tail_pattern': [16, 17, 18], 'has_bill_color': [19, 20, 21]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 0.1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	num_rollouts -> 1
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 24489665 ]
[Number of non-trainable parameters in model 2299229 ]
	Found cached model... loading it
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
DEBUG:root:Getting test results without interventions
DEBUG:root:Testing with budget None
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        Test metric               DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ent_loss                      0.0
          pg_loss            -0.0045936089009046555
      test_agent_loss          0.02897859364748001
     test_avg_c_y_acc          0.7944111397784184
      test_c_accuracy          0.9352329640309608
        test_c_auc              0.882309514916601
         test_c_f1             0.8895155442058229
       test_cbm_loss            6.873708724975586
     test_concept_loss          4.24691915512085
    test_current_steps         1096.1920166015625
    test_horizon_limit                 2.0
test_intervention_accuracy     0.7762938230383973
   test_intervention_auc               0.0
  test_intervention_loss       0.02897859364748001
test_intervention_task_loss    2.6267895698547363
         test_loss             6.9026875495910645
    test_mask_accuracy                 0.0
      test_task_loss                   0.0
      test_y_accuracy          0.6535893155258765
        test_y_auc                     0.0
         test_y_f1             0.5264147807134674
          v_loss               0.29437950253486633
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
val_c_acc: 93.52%, val_y_acc: 65.36%, val_c_auc: 88.23%, val_y_auc: 0.00% with 42.0 epochs in 2261.31 seconds
wandb: - 0.014 MB of 0.014 MB uploaded
wandb: \ 0.014 MB of 0.019 MB uploaded
wandb: | 0.014 MB of 0.019 MB uploaded
wandb: / 0.031 MB of 0.031 MB uploaded
wandb:                                                                                
wandb: üöÄ View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1 at: https://wandb.ai/thomasyuan/cub_test/runs/yxlhiwfx
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_test
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240512_123000-yxlhiwfx/logs
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        Test metric               DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ent_loss                      0.0
          pg_loss             -0.007775212172418833
      test_agent_loss         0.039289213716983795
     test_avg_c_y_acc          0.7953486365205388
      test_c_accuracy          0.9355367621677599
        test_c_auc              0.919672409594299
         test_c_f1              0.80124670337223
       test_cbm_loss            6.675674915313721
     test_concept_loss          4.159456729888916
    test_current_steps          1124.135009765625
    test_horizon_limit                 2.0
test_intervention_accuracy     0.8077321366931308
   test_intervention_auc               0.0
  test_intervention_loss      0.039289213716983795
test_intervention_task_loss    2.5162181854248047
         test_loss              6.714964866638184
    test_mask_accuracy                 0.0
      test_task_loss                   0.0
      test_y_accuracy          0.6551605108733172
        test_y_auc                     0.0
         test_y_f1             0.18964278436939014
          v_loss               0.40066733956336975
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
c_acc: 93.55%, y_acc: 65.52%, c_auc: 91.97%, y_auc: 0.00% with 42.0 epochs in 2261.31 seconds
DEBUG:root:Restarting run because we could not find test_acc_y_afacem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa in old results.
[rank: 0] Global seed set to 42
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_0.25_model_trial_0.pt
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_0.1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.25_afa_resnet34_fold_1.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7]
DEBUG:root:Intervening in <class 'cem.models.afacbm.AFAModel'> using <class 'cem.interventions.afacem_policy.AFACemInterventionPolicy'>
DEBUG:root:Intervening with 0 out of 7 concept groups
DEBUG:root:	For split 0 with 0 groups intervened
DEBUG:root:Testing with budget 0
DEBUG:root:	Test Accuracy when intervening with 0 concept groups is 65.48.
DEBUG:root:Intervening with 1 out of 7 concept groups
DEBUG:root:	For split 0 with 1 groups intervened
DEBUG:root:Testing with budget 1
DEBUG:root:	Test Accuracy when intervening with 1 concept groups is 72.76.
DEBUG:root:Intervening with 2 out of 7 concept groups
DEBUG:root:	For split 0 with 2 groups intervened
DEBUG:root:Testing with budget 2
DEBUG:root:	Test Accuracy when intervening with 2 concept groups is 76.42.
DEBUG:root:Intervening with 3 out of 7 concept groups
DEBUG:root:	For split 0 with 3 groups intervened
DEBUG:root:Testing with budget 3
DEBUG:root:	Test Accuracy when intervening with 3 concept groups is 78.12.
DEBUG:root:Intervening with 4 out of 7 concept groups
DEBUG:root:	For split 0 with 4 groups intervened
DEBUG:root:Testing with budget 4
DEBUG:root:	Test Accuracy when intervening with 4 concept groups is 80.70.
DEBUG:root:Intervening with 5 out of 7 concept groups
DEBUG:root:	For split 0 with 5 groups intervened
DEBUG:root:Testing with budget 5
DEBUG:root:	Test Accuracy when intervening with 5 concept groups is 84.23.
DEBUG:root:Intervening with 6 out of 7 concept groups
DEBUG:root:	For split 0 with 6 groups intervened
DEBUG:root:Testing with budget 6
DEBUG:root:	Test Accuracy when intervening with 6 concept groups is 87.78.
DEBUG:root:Intervening with 7 out of 7 concept groups
DEBUG:root:	For split 0 with 7 groups intervened
DEBUG:root:Testing with budget 7

[1]+  Stopped                 python experiments/run_experiments_rl.py -c experiments/configs/afa_configs/cub_afa.yaml --debug --project_name="cub_test"
