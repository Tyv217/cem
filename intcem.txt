Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 3, in <module>
    import joblib
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/__init__.py", line 114, in <module>
    from .memory import Memory
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/memory.py", line 35, in <module>
    from ._store_backends import StoreBackendBase, FileSystemStoreBackend
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/_store_backends.py", line 16, in <module>
    from .backports import concurrency_safe_rename
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/backports.py", line 112, in <module>
    import numpy as np
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/numpy/__init__.py", line 144, in <module>
    from . import lib
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/numpy/lib/__init__.py", line 26, in <module>
    from . import index_tricks
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/numpy/lib/index_tricks.py", line 12, in <module>
    import numpy.matrixlib as matrixlib
  File "<frozen importlib._bootstrap>", line 991, in _find_and_load
  File "<frozen importlib._bootstrap>", line 975, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 671, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 779, in exec_module
  File "<frozen importlib._bootstrap_external>", line 874, in get_code
  File "<frozen importlib._bootstrap_external>", line 972, in get_data
KeyboardInterrupt
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 3, in <module>
    import joblib
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/__init__.py", line 114, in <module>
    from .memory import Memory
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/memory.py", line 35, in <module>
    from ._store_backends import StoreBackendBase, FileSystemStoreBackend
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/_store_backends.py", line 16, in <module>
    from .backports import concurrency_safe_rename
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/joblib/backports.py", line 112, in <module>
    import numpy as np
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/numpy/__init__.py", line 141, in <module>
    from . import core
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/numpy/core/__init__.py", line 23, in <module>
    from . import multiarray
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/numpy/core/multiarray.py", line 10, in <module>
    from . import overrides
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/numpy/core/overrides.py", line 6, in <module>
    from numpy.core._multiarray_umath import (
KeyboardInterrupt
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 12, in <module>
    import pytorch_lightning as pl
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/__init__.py", line 35, in <module>
    from pytorch_lightning.callbacks import Callback  # noqa: E402
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/callbacks/__init__.py", line 14, in <module>
    from pytorch_lightning.callbacks.batch_size_finder import BatchSizeFinder
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/callbacks/batch_size_finder.py", line 24, in <module>
    from pytorch_lightning.callbacks.callback import Callback
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/callbacks/callback.py", line 25, in <module>
    from pytorch_lightning.utilities.types import STEP_OUTPUT
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/__init__.py", line 23, in <module>
    from pytorch_lightning.utilities.imports import (  # noqa: F401
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/imports.py", line 28, in <module>
    _TORCHMETRICS_GREATER_EQUAL_0_11 = compare_version("torchmetrics", operator.ge, "0.11.0")  # using new API with task
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/lightning_utilities/core/imports.py", line 77, in compare_version
    pkg = importlib.import_module(package)
  File "/home/xty20/cem/venv/lib/python3.8/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/__init__.py", line 22, in <module>
    from torchmetrics import functional  # noqa: E402
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/functional/__init__.py", line 14, in <module>
    from torchmetrics.functional.audio._deprecated import _permutation_invariant_training as permutation_invariant_training
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/functional/audio/__init__.py", line 14, in <module>
    from torchmetrics.functional.audio.pit import permutation_invariant_training, pit_permutate
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/functional/audio/pit.py", line 22, in <module>
    from torchmetrics.utilities import rank_zero_warn
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/utilities/__init__.py", line 14, in <module>
    from torchmetrics.utilities.checks import check_forward_full_state_property
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/utilities/checks.py", line 25, in <module>
    from torchmetrics.metric import Metric
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/metric.py", line 41, in <module>
    from torchmetrics.utilities.plot import _AX_TYPE, _PLOT_OUT_TYPE, plot_single_or_multi_val
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torchmetrics/utilities/plot.py", line 26, in <module>
    import matplotlib.axes
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/axes/__init__.py", line 1, in <module>
    from . import _base
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/axes/_base.py", line 14, in <module>
    from matplotlib import _api, cbook, _docstring, offsetbox
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/offsetbox.py", line 597, in <module>
    class DrawingArea(OffsetBox):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/artist.py", line 150, in __init_subclass__
    cls._update_set_signature_and_docstring()
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/artist.py", line 178, in _update_set_signature_and_docstring
    + kwdoc(cls))
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/artist.py", line 1857, in kwdoc
    ai = ArtistInspector(artist)
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/artist.py", line 1444, in __init__
    self.aliasd = self.get_aliases()
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/artist.py", line 1457, in get_aliases
    names = [name for name in dir(self.o)
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/matplotlib/artist.py", line 1457, in <listcomp>
    names = [name for name in dir(self.o)
KeyboardInterrupt
INFO:root:Results will be dumped in results/afa/mnist_afa
DEBUG:root:And the dataset's root directory is /home/xty20/data
[rank: 0] Global seed set to 42
DEBUG:root:		Updated concept group map (with 8 groups):
DEBUG:root:			0 -> [0, 1, 2]
DEBUG:root:			1 -> [3, 4, 5]
DEBUG:root:			2 -> [6, 7, 8]
DEBUG:root:			5 -> [9, 10, 11, 12, 13]
DEBUG:root:			8 -> [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
DEBUG:root:			9 -> [24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
DEBUG:root:			10 -> [34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
DEBUG:root:			11 -> [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]
/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/seed.py:47: LightningDeprecationWarning: `pytorch_lightning.utilities.seed.seed_everything` has been deprecated in v1.8.0 and will be removed in v2.0.0. Please use `lightning_fabric.utilities.seed.seed_everything` instead.
  rank_zero_deprecation(
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "c2y_layers": [
        128,
        128
    ],
    "c_extractor_arch": "Function: c_extractor_arch",
    "check_val_every_n_epoch": 2,
    "dataset": "mnist_add",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "intcem_policy",
        "optimal_greedy_no_prior"
    ],
    "max_epochs": 83,
    "noise_level": 0.0,
    "num_operands": 12,
    "num_workers": 8,
    "results_dir": "results/afa/mnist_afa",
    "root_dir": "/home/xty20/data",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.625,
    "selected_digits": [
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ]
    ],
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 512,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 100,
            "n_components": 40,
            "num_samples": 10,
            "optimizer": "adam",
            "prior": "autoreg",
            "prior_hids": [
                256,
                256
            ],
            "prior_layers": 2,
            "prior_units": 256,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "save_path": "/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt",
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "TL",
                "AF"
            ]
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": false,
            "ent_coef": 0.0,
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "bool": false,
        "c_extractor_arch": "resnet18",
        "cbm_aneal_rate": 0.99999,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_loss",
        "emb_size": 16,
        "extra_dims": 0,
        "learning_rate": 0.001,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "sgd",
        "patience": 5,
        "save_model": true,
        "separate_ac_model_training": true,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_afa_model": false,
        "training_intervention_prob": 0.25,
        "weight_decay": 4e-06
    },
    "skip_repr_evaluation": true,
    "test_dataset_size": 1024,
    "test_subsampling": 1,
    "threshold_labels": 30,
    "train_dataset_size": 5000,
    "trials": 1,
    "use_task_class_weights": true,
    "weight_loss": true
}
INFO:root:Training sample shape is: torch.Size([64, 12, 28, 28]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.FloatTensor
INFO:root:	Number of output classes: 1
INFO:root:Training concept shape is: torch.Size([64, 54]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 54
INFO:root:Computing task class weights in the training dataset with size 79...
INFO:root:Setting log level to: "DEBUG"
WARNING:root:We will rerun model IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_split_0 as requested by the config
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
Class distribution is: [0.471 0.529]
[TRIAL 1/1 BEGINS AT 27/04/2024 at 00:34:16
Problem at: /home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py 1411 train_ac_model
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 901, in <module>
    main(
  File "experiments/run_experiments_rl.py", line 255, in main
    _, _, ac_model_saved_path = training.train_ac_model(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 1411, in train_ac_model
    with wandb.init(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/wandb_init.py", line 1204, in init
    raise e
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/wandb_init.py", line 1181, in init
    run = wi.init()
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/wandb_init.py", line 751, in init
    result = run_init_handle.wait(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/lib/mailbox.py", line 283, in wait
    found, abandoned = self._slot._get_and_clear(timeout=wait_timeout)
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/lib/mailbox.py", line 130, in _get_and_clear
    if self._wait(timeout=timeout):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/lib/mailbox.py", line 126, in _wait
    return self._event.wait(timeout=timeout)
  File "/usr/local/software/master/python/3.8/lib/python3.8/threading.py", line 558, in wait
    signaled = self._cond.wait(timeout)
  File "/usr/local/software/master/python/3.8/lib/python3.8/threading.py", line 306, in wait
    gotit = waiter.acquire(True, timeout)
KeyboardInterrupt
Error in atexit._run_exitfuncs:
Traceback (most recent call last):
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1079, in wait
    return self._wait(timeout=timeout)
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1804, in _wait
    (pid, sts) = self._try_wait(0)
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1762, in _try_wait
    (pid, sts) = os.waitpid(self.pid, wait_flags)
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/wandb_manager.py", line 176, in _teardown
    result = self._service.join()
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/service/service.py", line 263, in join
    ret = self._internal_proc.wait()
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1092, in wait
    self._wait(timeout=sigint_timeout)
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1798, in _wait
    time.sleep(delay)
KeyboardInterrupt
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
INFO:root:Results will be dumped in results/afa/mnist_afa
DEBUG:root:And the dataset's root directory is /home/xty20/data
[rank: 0] Global seed set to 42
DEBUG:root:		Updated concept group map (with 8 groups):
DEBUG:root:			0 -> [0, 1, 2]
DEBUG:root:			1 -> [3, 4, 5]
DEBUG:root:			2 -> [6, 7, 8]
DEBUG:root:			5 -> [9, 10, 11, 12, 13]
DEBUG:root:			8 -> [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
DEBUG:root:			9 -> [24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
DEBUG:root:			10 -> [34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
DEBUG:root:			11 -> [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]
/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/seed.py:47: LightningDeprecationWarning: `pytorch_lightning.utilities.seed.seed_everything` has been deprecated in v1.8.0 and will be removed in v2.0.0. Please use `lightning_fabric.utilities.seed.seed_everything` instead.
  rank_zero_deprecation(
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "c2y_layers": [
        128,
        128
    ],
    "c_extractor_arch": "Function: c_extractor_arch",
    "check_val_every_n_epoch": 2,
    "dataset": "mnist_add",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "intcem_policy",
        "optimal_greedy_no_prior"
    ],
    "max_epochs": 83,
    "noise_level": 0.0,
    "num_operands": 12,
    "num_workers": 8,
    "results_dir": "results/afa/mnist_afa",
    "root_dir": "/home/xty20/data",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.625,
    "selected_digits": [
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ]
    ],
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 512,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 100,
            "n_components": 40,
            "num_samples": 10,
            "optimizer": "adam",
            "prior": "autoreg",
            "prior_hids": [
                256,
                256
            ],
            "prior_layers": 2,
            "prior_units": 256,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "save_path": "/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt",
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "TL",
                "AF"
            ]
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": false,
            "ent_coef": 0.0,
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "bool": false,
        "c_extractor_arch": "resnet18",
        "cbm_aneal_rate": 0.99999,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_loss",
        "emb_size": 16,
        "extra_dims": 0,
        "learning_rate": 0.001,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "sgd",
        "patience": 5,
        "save_model": true,
        "separate_ac_model_training": true,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_afa_model": false,
        "training_intervention_prob": 0.25,
        "weight_decay": 4e-06
    },
    "skip_repr_evaluation": true,
    "test_dataset_size": 1024,
    "test_subsampling": 1,
    "threshold_labels": 30,
    "train_dataset_size": 5000,
    "trials": 1,
    "use_task_class_weights": true,
    "weight_loss": true
}
INFO:root:Training sample shape is: torch.Size([64, 12, 28, 28]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.FloatTensor
INFO:root:	Number of output classes: 1
INFO:root:Training concept shape is: torch.Size([64, 54]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 54
INFO:root:Computing task class weights in the training dataset with size 79...
INFO:root:Setting log level to: "DEBUG"
WARNING:root:We will rerun model IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_split_0 as requested by the config
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240427_003452-bu864uky
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run ac_flow_model_split_0
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/bu864uky
Class distribution is: [0.471 0.529]
[TRIAL 1/1 BEGINS AT 27/04/2024 at 00:34:50
Testing: 0it [00:00, ?it/s]Testing:   0%|          | 0/2 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]Testing DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  1.78it/s]Testing DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  2.77it/s]Testing DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  2.76it/s]DEBUG:root:AC Model test results before training:

DEBUG:root:	test_accuracy: 0.509765625
DEBUG:root:	test_nll: 0.9262028932571411
DEBUG:root:AC Model input shape:	x:torch.Size([54])	b:torch.Size([54])	m:torch.Size([54])	y:torch.Size([])AC Data loader batch size: 512
WARNING:root:We will rerun model ac_flow_split_0 as requested by the config
DEBUG:root:Starting AC flow Model training...
	Save path: results/afa/mnist_afa/acflow_model_trial_0.pt

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       Test metric             DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
      test_accuracy             0.509765625
        test_nll            0.9262028932571411
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Sanity Checking: 0it [00:00, ?it/s]Sanity Checking:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.04it/s]Sanity Checking DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.39it/s]                                                                           Training: 0it [00:00, ?it/s]Training:   0%|          | 0/12 [00:00<?, ?it/s]Epoch 0:   0%|          | 0/12 [00:00<?, ?it/s] Epoch 0:   8%|▊         | 1/12 [00:01<00:21,  1.92s/it]Epoch 0:   8%|▊         | 1/12 [00:01<00:21,  1.92s/it, loss=1.62, v_num=4uky, accuracy=0.561]Epoch 0:  17%|█▋        | 2/12 [00:02<00:11,  1.11s/it, loss=1.62, v_num=4uky, accuracy=0.561]Epoch 0:  17%|█▋        | 2/12 [00:02<00:11,  1.11s/it, loss=1.61, v_num=4uky, accuracy=0.498]Epoch 0:  25%|██▌       | 3/12 [00:02<00:07,  1.20it/s, loss=1.61, v_num=4uky, accuracy=0.498]Epoch 0:  25%|██▌       | 3/12 [00:02<00:07,  1.20it/s, loss=1.61, v_num=4uky, accuracy=0.527]Epoch 0:  33%|███▎      | 4/12 [00:02<00:05,  1.44it/s, loss=1.61, v_num=4uky, accuracy=0.527]Epoch 0:  33%|███▎      | 4/12 [00:02<00:05,  1.44it/s, loss=1.6, v_num=4uky, accuracy=0.561] Epoch 0:  42%|████▏     | 5/12 [00:03<00:04,  1.63it/s, loss=1.6, v_num=4uky, accuracy=0.561]Epoch 0:  42%|████▏     | 5/12 [00:03<00:04,  1.63it/s, loss=1.59, v_num=4uky, accuracy=0.555]Epoch 0:  50%|█████     | 6/12 [00:03<00:03,  1.79it/s, loss=1.59, v_num=4uky, accuracy=0.555]Epoch 0:  50%|█████     | 6/12 [00:03<00:03,  1.79it/s, loss=1.59, v_num=4uky, accuracy=0.518]Epoch 0:  58%|█████▊    | 7/12 [00:03<00:02,  1.92it/s, loss=1.59, v_num=4uky, accuracy=0.518]Epoch 0:  58%|█████▊    | 7/12 [00:03<00:02,  1.92it/s, loss=1.58, v_num=4uky, accuracy=0.543]Epoch 0:  67%|██████▋   | 8/12 [00:03<00:01,  2.04it/s, loss=1.58, v_num=4uky, accuracy=0.543]Epoch 0:  67%|██████▋   | 8/12 [00:03<00:01,  2.04it/s, loss=1.58, v_num=4uky, accuracy=0.525]Epoch 0:  75%|███████▌  | 9/12 [00:04<00:01,  2.14it/s, loss=1.58, v_num=4uky, accuracy=0.525]Epoch 0:  75%|███████▌  | 9/12 [00:04<00:01,  2.14it/s, loss=1.57, v_num=4uky, accuracy=0.543]Epoch 0:  83%|████████▎ | 10/12 [00:04<00:00,  2.23it/s, loss=1.57, v_num=4uky, accuracy=0.543]Epoch 0:  83%|████████▎ | 10/12 [00:04<00:00,  2.23it/s, loss=1.57, v_num=4uky, accuracy=0.523]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.29it/s][AEpoch 0:  92%|█████████▏| 11/12 [00:05<00:00,  2.16it/s, loss=1.57, v_num=4uky, accuracy=0.523]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.40it/s][AEpoch 0: 100%|██████████| 12/12 [00:05<00:00,  2.28it/s, loss=1.57, v_num=4uky, accuracy=0.523]Epoch 0: 100%|██████████| 12/12 [00:05<00:00,  2.28it/s, loss=1.57, v_num=4uky, accuracy=0.523, val_accuracy=0.586]
                                                                      [AEpoch 0: 100%|██████████| 12/12 [00:05<00:00,  2.28it/s, loss=1.57, v_num=4uky, accuracy=0.523, val_accuracy=0.586]Epoch 0:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.57, v_num=4uky, accuracy=0.523, val_accuracy=0.586]         Epoch 1:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.57, v_num=4uky, accuracy=0.523, val_accuracy=0.586]Epoch 1:   8%|▊         | 1/12 [00:00<00:07,  1.51it/s, loss=1.57, v_num=4uky, accuracy=0.523, val_accuracy=0.586]Epoch 1:   8%|▊         | 1/12 [00:00<00:07,  1.51it/s, loss=1.56, v_num=4uky, accuracy=0.594, val_accuracy=0.586]Epoch 1:  17%|█▋        | 2/12 [00:00<00:04,  2.13it/s, loss=1.56, v_num=4uky, accuracy=0.594, val_accuracy=0.586]Epoch 1:  17%|█▋        | 2/12 [00:00<00:04,  2.13it/s, loss=1.55, v_num=4uky, accuracy=0.572, val_accuracy=0.586]Epoch 1:  25%|██▌       | 3/12 [00:01<00:03,  2.47it/s, loss=1.55, v_num=4uky, accuracy=0.572, val_accuracy=0.586]Epoch 1:  25%|██▌       | 3/12 [00:01<00:03,  2.47it/s, loss=1.55, v_num=4uky, accuracy=0.613, val_accuracy=0.586]Epoch 1:  33%|███▎      | 4/12 [00:01<00:02,  2.68it/s, loss=1.55, v_num=4uky, accuracy=0.613, val_accuracy=0.586]Epoch 1:  33%|███▎      | 4/12 [00:01<00:02,  2.68it/s, loss=1.54, v_num=4uky, accuracy=0.615, val_accuracy=0.586]Epoch 1:  42%|████▏     | 5/12 [00:01<00:02,  2.83it/s, loss=1.54, v_num=4uky, accuracy=0.615, val_accuracy=0.586]Epoch 1:  42%|████▏     | 5/12 [00:01<00:02,  2.83it/s, loss=1.54, v_num=4uky, accuracy=0.623, val_accuracy=0.586]Epoch 1:  50%|█████     | 6/12 [00:02<00:02,  2.69it/s, loss=1.54, v_num=4uky, accuracy=0.623, val_accuracy=0.586]Epoch 1:  50%|█████     | 6/12 [00:02<00:02,  2.69it/s, loss=1.53, v_num=4uky, accuracy=0.623, val_accuracy=0.586]Epoch 1:  58%|█████▊    | 7/12 [00:02<00:01,  2.79it/s, loss=1.53, v_num=4uky, accuracy=0.623, val_accuracy=0.586]Epoch 1:  58%|█████▊    | 7/12 [00:02<00:01,  2.79it/s, loss=1.52, v_num=4uky, accuracy=0.689, val_accuracy=0.586]Epoch 1:  67%|██████▋   | 8/12 [00:02<00:01,  2.87it/s, loss=1.52, v_num=4uky, accuracy=0.689, val_accuracy=0.586]Epoch 1:  67%|██████▋   | 8/12 [00:02<00:01,  2.87it/s, loss=1.52, v_num=4uky, accuracy=0.645, val_accuracy=0.586]Epoch 1:  75%|███████▌  | 9/12 [00:03<00:01,  2.94it/s, loss=1.52, v_num=4uky, accuracy=0.645, val_accuracy=0.586]Epoch 1:  75%|███████▌  | 9/12 [00:03<00:01,  2.94it/s, loss=1.51, v_num=4uky, accuracy=0.648, val_accuracy=0.586]Epoch 1:  83%|████████▎ | 10/12 [00:03<00:00,  3.00it/s, loss=1.51, v_num=4uky, accuracy=0.648, val_accuracy=0.586]Epoch 1:  83%|████████▎ | 10/12 [00:03<00:00,  3.00it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.586]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.30it/s][AEpoch 1:  92%|█████████▏| 11/12 [00:03<00:00,  2.80it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.586]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.37it/s][AEpoch 1: 100%|██████████| 12/12 [00:04<00:00,  2.92it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.586]Epoch 1: 100%|██████████| 12/12 [00:04<00:00,  2.92it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.646]
                                                                      [AEpoch 1: 100%|██████████| 12/12 [00:04<00:00,  2.92it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.646]Epoch 1:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.646]         Epoch 2:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.646]Epoch 2:   8%|▊         | 1/12 [00:00<00:07,  1.47it/s, loss=1.51, v_num=4uky, accuracy=0.679, val_accuracy=0.646]Epoch 2:   8%|▊         | 1/12 [00:00<00:07,  1.47it/s, loss=1.5, v_num=4uky, accuracy=0.672, val_accuracy=0.646] Epoch 2:  17%|█▋        | 2/12 [00:00<00:04,  2.07it/s, loss=1.5, v_num=4uky, accuracy=0.672, val_accuracy=0.646]Epoch 2:  17%|█▋        | 2/12 [00:00<00:04,  2.06it/s, loss=1.49, v_num=4uky, accuracy=0.641, val_accuracy=0.646]Epoch 2:  25%|██▌       | 3/12 [00:01<00:03,  2.39it/s, loss=1.49, v_num=4uky, accuracy=0.641, val_accuracy=0.646]Epoch 2:  25%|██▌       | 3/12 [00:01<00:03,  2.39it/s, loss=1.48, v_num=4uky, accuracy=0.658, val_accuracy=0.646]Epoch 2:  33%|███▎      | 4/12 [00:01<00:03,  2.60it/s, loss=1.48, v_num=4uky, accuracy=0.658, val_accuracy=0.646]Epoch 2:  33%|███▎      | 4/12 [00:01<00:03,  2.60it/s, loss=1.47, v_num=4uky, accuracy=0.699, val_accuracy=0.646]Epoch 2:  42%|████▏     | 5/12 [00:01<00:02,  2.74it/s, loss=1.47, v_num=4uky, accuracy=0.699, val_accuracy=0.646]Epoch 2:  42%|████▏     | 5/12 [00:01<00:02,  2.74it/s, loss=1.46, v_num=4uky, accuracy=0.664, val_accuracy=0.646]Epoch 2:  50%|█████     | 6/12 [00:02<00:02,  2.84it/s, loss=1.46, v_num=4uky, accuracy=0.664, val_accuracy=0.646]Epoch 2:  50%|█████     | 6/12 [00:02<00:02,  2.84it/s, loss=1.45, v_num=4uky, accuracy=0.686, val_accuracy=0.646]Epoch 2:  58%|█████▊    | 7/12 [00:02<00:01,  2.92it/s, loss=1.45, v_num=4uky, accuracy=0.686, val_accuracy=0.646]Epoch 2:  58%|█████▊    | 7/12 [00:02<00:01,  2.92it/s, loss=1.44, v_num=4uky, accuracy=0.676, val_accuracy=0.646]Epoch 2:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.44, v_num=4uky, accuracy=0.676, val_accuracy=0.646]Epoch 2:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.43, v_num=4uky, accuracy=0.648, val_accuracy=0.646]Epoch 2:  75%|███████▌  | 9/12 [00:02<00:00,  3.03it/s, loss=1.43, v_num=4uky, accuracy=0.648, val_accuracy=0.646]Epoch 2:  75%|███████▌  | 9/12 [00:02<00:00,  3.03it/s, loss=1.42, v_num=4uky, accuracy=0.662, val_accuracy=0.646]Epoch 2:  83%|████████▎ | 10/12 [00:03<00:00,  3.07it/s, loss=1.42, v_num=4uky, accuracy=0.662, val_accuracy=0.646]Epoch 2:  83%|████████▎ | 10/12 [00:03<00:00,  3.07it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.646]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.31it/s][AEpoch 2:  92%|█████████▏| 11/12 [00:03<00:00,  2.90it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.646]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.40it/s][AEpoch 2: 100%|██████████| 12/12 [00:03<00:00,  3.01it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.646]Epoch 2: 100%|██████████| 12/12 [00:03<00:00,  3.01it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.685]
                                                                      [AEpoch 2: 100%|██████████| 12/12 [00:03<00:00,  3.01it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.685]Epoch 2:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.685]         Epoch 3:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.685]Epoch 3:   8%|▊         | 1/12 [00:00<00:07,  1.39it/s, loss=1.41, v_num=4uky, accuracy=0.696, val_accuracy=0.685]Epoch 3:   8%|▊         | 1/12 [00:00<00:07,  1.39it/s, loss=1.4, v_num=4uky, accuracy=0.695, val_accuracy=0.685] Epoch 3:  17%|█▋        | 2/12 [00:01<00:05,  1.99it/s, loss=1.4, v_num=4uky, accuracy=0.695, val_accuracy=0.685]Epoch 3:  17%|█▋        | 2/12 [00:01<00:05,  1.99it/s, loss=1.4, v_num=4uky, accuracy=0.678, val_accuracy=0.685]Epoch 3:  25%|██▌       | 3/12 [00:01<00:03,  2.33it/s, loss=1.4, v_num=4uky, accuracy=0.678, val_accuracy=0.685]Epoch 3:  25%|██▌       | 3/12 [00:01<00:03,  2.33it/s, loss=1.39, v_num=4uky, accuracy=0.674, val_accuracy=0.685]Epoch 3:  33%|███▎      | 4/12 [00:01<00:03,  2.54it/s, loss=1.39, v_num=4uky, accuracy=0.674, val_accuracy=0.685]Epoch 3:  33%|███▎      | 4/12 [00:01<00:03,  2.53it/s, loss=1.38, v_num=4uky, accuracy=0.695, val_accuracy=0.685]Epoch 3:  42%|████▏     | 5/12 [00:01<00:02,  2.69it/s, loss=1.38, v_num=4uky, accuracy=0.695, val_accuracy=0.685]Epoch 3:  42%|████▏     | 5/12 [00:04<00:06,  1.13it/s, loss=1.38, v_num=4uky, accuracy=0.711, val_accuracy=0.685]Epoch 3:  50%|█████     | 6/12 [00:04<00:04,  1.27it/s, loss=1.38, v_num=4uky, accuracy=0.711, val_accuracy=0.685]Epoch 3:  50%|█████     | 6/12 [00:04<00:04,  1.27it/s, loss=1.37, v_num=4uky, accuracy=0.676, val_accuracy=0.685]Epoch 3:  58%|█████▊    | 7/12 [00:04<00:03,  1.40it/s, loss=1.37, v_num=4uky, accuracy=0.676, val_accuracy=0.685]Epoch 3:  58%|█████▊    | 7/12 [00:04<00:03,  1.40it/s, loss=1.37, v_num=4uky, accuracy=0.688, val_accuracy=0.685]Epoch 3:  67%|██████▋   | 8/12 [00:05<00:02,  1.51it/s, loss=1.37, v_num=4uky, accuracy=0.688, val_accuracy=0.685]Epoch 3:  67%|██████▋   | 8/12 [00:05<00:02,  1.51it/s, loss=1.36, v_num=4uky, accuracy=0.648, val_accuracy=0.685]Epoch 3:  75%|███████▌  | 9/12 [00:05<00:01,  1.62it/s, loss=1.36, v_num=4uky, accuracy=0.648, val_accuracy=0.685]Epoch 3:  75%|███████▌  | 9/12 [00:05<00:01,  1.62it/s, loss=1.36, v_num=4uky, accuracy=0.688, val_accuracy=0.685]Epoch 3:  83%|████████▎ | 10/12 [00:05<00:01,  1.71it/s, loss=1.36, v_num=4uky, accuracy=0.688, val_accuracy=0.685]Epoch 3:  83%|████████▎ | 10/12 [00:05<00:01,  1.71it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.685]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.28it/s][AEpoch 3:  92%|█████████▏| 11/12 [00:06<00:00,  1.70it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.685]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.38it/s][AEpoch 3: 100%|██████████| 12/12 [00:06<00:00,  1.81it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.685]Epoch 3: 100%|██████████| 12/12 [00:06<00:00,  1.81it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.669]
                                                                      [AEpoch 3: 100%|██████████| 12/12 [00:06<00:00,  1.81it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.669]Epoch 3:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.669]         Epoch 4:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.669]Epoch 4:   8%|▊         | 1/12 [00:00<00:08,  1.31it/s, loss=1.35, v_num=4uky, accuracy=0.648, val_accuracy=0.669]Epoch 4:   8%|▊         | 1/12 [00:00<00:08,  1.30it/s, loss=1.35, v_num=4uky, accuracy=0.662, val_accuracy=0.669]Epoch 4:  17%|█▋        | 2/12 [00:01<00:05,  1.92it/s, loss=1.35, v_num=4uky, accuracy=0.662, val_accuracy=0.669]Epoch 4:  17%|█▋        | 2/12 [00:01<00:05,  1.92it/s, loss=1.34, v_num=4uky, accuracy=0.662, val_accuracy=0.669]Epoch 4:  25%|██▌       | 3/12 [00:01<00:03,  2.28it/s, loss=1.34, v_num=4uky, accuracy=0.662, val_accuracy=0.669]Epoch 4:  25%|██▌       | 3/12 [00:01<00:03,  2.28it/s, loss=1.33, v_num=4uky, accuracy=0.699, val_accuracy=0.669]Epoch 4:  33%|███▎      | 4/12 [00:01<00:03,  2.49it/s, loss=1.33, v_num=4uky, accuracy=0.699, val_accuracy=0.669]Epoch 4:  33%|███▎      | 4/12 [00:01<00:03,  2.49it/s, loss=1.33, v_num=4uky, accuracy=0.699, val_accuracy=0.669]Epoch 4:  42%|████▏     | 5/12 [00:01<00:02,  2.65it/s, loss=1.33, v_num=4uky, accuracy=0.699, val_accuracy=0.669]Epoch 4:  42%|████▏     | 5/12 [00:01<00:02,  2.65it/s, loss=1.32, v_num=4uky, accuracy=0.729, val_accuracy=0.669]Epoch 4:  50%|█████     | 6/12 [00:02<00:02,  2.76it/s, loss=1.32, v_num=4uky, accuracy=0.729, val_accuracy=0.669]Epoch 4:  50%|█████     | 6/12 [00:02<00:02,  2.76it/s, loss=1.32, v_num=4uky, accuracy=0.695, val_accuracy=0.669]Epoch 4:  58%|█████▊    | 7/12 [00:02<00:01,  2.86it/s, loss=1.32, v_num=4uky, accuracy=0.695, val_accuracy=0.669]Epoch 4:  58%|█████▊    | 7/12 [00:02<00:01,  2.85it/s, loss=1.32, v_num=4uky, accuracy=0.707, val_accuracy=0.669]Epoch 4:  67%|██████▋   | 8/12 [00:02<00:01,  2.93it/s, loss=1.32, v_num=4uky, accuracy=0.707, val_accuracy=0.669]Epoch 4:  67%|██████▋   | 8/12 [00:02<00:01,  2.93it/s, loss=1.31, v_num=4uky, accuracy=0.697, val_accuracy=0.669]Epoch 4:  75%|███████▌  | 9/12 [00:03<00:01,  2.98it/s, loss=1.31, v_num=4uky, accuracy=0.697, val_accuracy=0.669]Epoch 4:  75%|███████▌  | 9/12 [00:03<00:01,  2.98it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.669]Epoch 4:  83%|████████▎ | 10/12 [00:03<00:00,  3.03it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.669]Epoch 4:  83%|████████▎ | 10/12 [00:03<00:00,  3.03it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.669]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.33it/s][AEpoch 4:  92%|█████████▏| 11/12 [00:03<00:00,  2.79it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.669]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.42it/s][AEpoch 4: 100%|██████████| 12/12 [00:04<00:00,  2.91it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.669]Epoch 4: 100%|██████████| 12/12 [00:04<00:00,  2.90it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.685]
                                                                      [AEpoch 4: 100%|██████████| 12/12 [00:04<00:00,  2.90it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.685]Epoch 4:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.685]         Epoch 5:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.685]Epoch 5:   8%|▊         | 1/12 [00:00<00:07,  1.39it/s, loss=1.31, v_num=4uky, accuracy=0.691, val_accuracy=0.685]Epoch 5:   8%|▊         | 1/12 [00:00<00:07,  1.39it/s, loss=1.3, v_num=4uky, accuracy=0.725, val_accuracy=0.685] Epoch 5:  17%|█▋        | 2/12 [00:00<00:04,  2.01it/s, loss=1.3, v_num=4uky, accuracy=0.725, val_accuracy=0.685]Epoch 5:  17%|█▋        | 2/12 [00:00<00:04,  2.01it/s, loss=1.3, v_num=4uky, accuracy=0.691, val_accuracy=0.685]Epoch 5:  25%|██▌       | 3/12 [00:01<00:03,  2.37it/s, loss=1.3, v_num=4uky, accuracy=0.691, val_accuracy=0.685]Epoch 5:  25%|██▌       | 3/12 [00:01<00:03,  2.37it/s, loss=1.29, v_num=4uky, accuracy=0.676, val_accuracy=0.685]Epoch 5:  33%|███▎      | 4/12 [00:01<00:03,  2.60it/s, loss=1.29, v_num=4uky, accuracy=0.676, val_accuracy=0.685]Epoch 5:  33%|███▎      | 4/12 [00:01<00:03,  2.60it/s, loss=1.29, v_num=4uky, accuracy=0.688, val_accuracy=0.685]Epoch 5:  42%|████▏     | 5/12 [00:01<00:02,  2.75it/s, loss=1.29, v_num=4uky, accuracy=0.688, val_accuracy=0.685]Epoch 5:  42%|████▏     | 5/12 [00:01<00:02,  2.75it/s, loss=1.29, v_num=4uky, accuracy=0.719, val_accuracy=0.685]Epoch 5:  50%|█████     | 6/12 [00:02<00:02,  2.87it/s, loss=1.29, v_num=4uky, accuracy=0.719, val_accuracy=0.685]Epoch 5:  50%|█████     | 6/12 [00:02<00:02,  2.87it/s, loss=1.28, v_num=4uky, accuracy=0.699, val_accuracy=0.685]Epoch 5:  58%|█████▊    | 7/12 [00:02<00:01,  2.96it/s, loss=1.28, v_num=4uky, accuracy=0.699, val_accuracy=0.685]Epoch 5:  58%|█████▊    | 7/12 [00:02<00:01,  2.96it/s, loss=1.28, v_num=4uky, accuracy=0.684, val_accuracy=0.685]Epoch 5:  67%|██████▋   | 8/12 [00:02<00:01,  3.03it/s, loss=1.28, v_num=4uky, accuracy=0.684, val_accuracy=0.685]Epoch 5:  67%|██████▋   | 8/12 [00:02<00:01,  3.03it/s, loss=1.28, v_num=4uky, accuracy=0.656, val_accuracy=0.685]Epoch 5:  75%|███████▌  | 9/12 [00:02<00:00,  3.09it/s, loss=1.28, v_num=4uky, accuracy=0.656, val_accuracy=0.685]Epoch 5:  75%|███████▌  | 9/12 [00:02<00:00,  3.09it/s, loss=1.28, v_num=4uky, accuracy=0.703, val_accuracy=0.685]Epoch 5:  83%|████████▎ | 10/12 [00:03<00:00,  3.14it/s, loss=1.28, v_num=4uky, accuracy=0.703, val_accuracy=0.685]Epoch 5:  83%|████████▎ | 10/12 [00:03<00:00,  3.14it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.685]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.40it/s][AEpoch 5:  92%|█████████▏| 11/12 [00:03<00:00,  2.88it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.685]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.49it/s][AEpoch 5: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.685]Epoch 5: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.704]
                                                                      [AEpoch 5: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.704]Epoch 5:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.704]         Epoch 6:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.704]Epoch 6:   8%|▊         | 1/12 [00:00<00:07,  1.56it/s, loss=1.27, v_num=4uky, accuracy=0.673, val_accuracy=0.704]Epoch 6:   8%|▊         | 1/12 [00:00<00:07,  1.56it/s, loss=1.27, v_num=4uky, accuracy=0.723, val_accuracy=0.704]Epoch 6:  17%|█▋        | 2/12 [00:00<00:04,  2.16it/s, loss=1.27, v_num=4uky, accuracy=0.723, val_accuracy=0.704]Epoch 6:  17%|█▋        | 2/12 [00:00<00:04,  2.16it/s, loss=1.27, v_num=4uky, accuracy=0.695, val_accuracy=0.704]Epoch 6:  25%|██▌       | 3/12 [00:01<00:03,  2.47it/s, loss=1.27, v_num=4uky, accuracy=0.695, val_accuracy=0.704]Epoch 6:  25%|██▌       | 3/12 [00:01<00:03,  2.47it/s, loss=1.27, v_num=4uky, accuracy=0.646, val_accuracy=0.704]Epoch 6:  33%|███▎      | 4/12 [00:01<00:02,  2.67it/s, loss=1.27, v_num=4uky, accuracy=0.646, val_accuracy=0.704]Epoch 6:  33%|███▎      | 4/12 [00:01<00:02,  2.67it/s, loss=1.27, v_num=4uky, accuracy=0.734, val_accuracy=0.704]Epoch 6:  42%|████▏     | 5/12 [00:01<00:02,  2.81it/s, loss=1.27, v_num=4uky, accuracy=0.734, val_accuracy=0.704]Epoch 6:  42%|████▏     | 5/12 [00:01<00:02,  2.81it/s, loss=1.27, v_num=4uky, accuracy=0.711, val_accuracy=0.704]Epoch 6:  50%|█████     | 6/12 [00:02<00:02,  2.91it/s, loss=1.27, v_num=4uky, accuracy=0.711, val_accuracy=0.704]Epoch 6:  50%|█████     | 6/12 [00:02<00:02,  2.91it/s, loss=1.27, v_num=4uky, accuracy=0.670, val_accuracy=0.704]Epoch 6:  58%|█████▊    | 7/12 [00:02<00:01,  2.98it/s, loss=1.27, v_num=4uky, accuracy=0.670, val_accuracy=0.704]Epoch 6:  58%|█████▊    | 7/12 [00:02<00:01,  2.98it/s, loss=1.27, v_num=4uky, accuracy=0.701, val_accuracy=0.704]Epoch 6:  67%|██████▋   | 8/12 [00:02<00:01,  3.04it/s, loss=1.27, v_num=4uky, accuracy=0.701, val_accuracy=0.704]Epoch 6:  67%|██████▋   | 8/12 [00:02<00:01,  3.04it/s, loss=1.26, v_num=4uky, accuracy=0.660, val_accuracy=0.704]Epoch 6:  75%|███████▌  | 9/12 [00:02<00:00,  3.09it/s, loss=1.26, v_num=4uky, accuracy=0.660, val_accuracy=0.704]Epoch 6:  75%|███████▌  | 9/12 [00:02<00:00,  3.09it/s, loss=1.26, v_num=4uky, accuracy=0.697, val_accuracy=0.704]Epoch 6:  83%|████████▎ | 10/12 [00:03<00:00,  3.13it/s, loss=1.26, v_num=4uky, accuracy=0.697, val_accuracy=0.704]Epoch 6:  83%|████████▎ | 10/12 [00:03<00:00,  3.13it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.704]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.34it/s][AEpoch 6:  92%|█████████▏| 11/12 [00:03<00:00,  2.87it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.704]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.44it/s][AEpoch 6: 100%|██████████| 12/12 [00:04<00:00,  2.99it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.704]Epoch 6: 100%|██████████| 12/12 [00:04<00:00,  2.99it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.666]
                                                                      [AEpoch 6: 100%|██████████| 12/12 [00:04<00:00,  2.99it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.666]Epoch 6:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.666]         Epoch 7:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.666]Epoch 7:   8%|▊         | 1/12 [00:00<00:07,  1.39it/s, loss=1.26, v_num=4uky, accuracy=0.719, val_accuracy=0.666]Epoch 7:   8%|▊         | 1/12 [00:00<00:07,  1.39it/s, loss=1.26, v_num=4uky, accuracy=0.709, val_accuracy=0.666]Epoch 7:  17%|█▋        | 2/12 [00:01<00:05,  1.99it/s, loss=1.26, v_num=4uky, accuracy=0.709, val_accuracy=0.666]Epoch 7:  17%|█▋        | 2/12 [00:01<00:05,  1.99it/s, loss=1.26, v_num=4uky, accuracy=0.684, val_accuracy=0.666]Epoch 7:  25%|██▌       | 3/12 [00:01<00:03,  2.34it/s, loss=1.26, v_num=4uky, accuracy=0.684, val_accuracy=0.666]Epoch 7:  25%|██▌       | 3/12 [00:01<00:03,  2.34it/s, loss=1.26, v_num=4uky, accuracy=0.705, val_accuracy=0.666]Epoch 7:  33%|███▎      | 4/12 [00:01<00:03,  2.57it/s, loss=1.26, v_num=4uky, accuracy=0.705, val_accuracy=0.666]Epoch 7:  33%|███▎      | 4/12 [00:01<00:03,  2.57it/s, loss=1.26, v_num=4uky, accuracy=0.688, val_accuracy=0.666]Epoch 7:  42%|████▏     | 5/12 [00:01<00:02,  2.73it/s, loss=1.26, v_num=4uky, accuracy=0.688, val_accuracy=0.666]Epoch 7:  42%|████▏     | 5/12 [00:01<00:02,  2.72it/s, loss=1.26, v_num=4uky, accuracy=0.730, val_accuracy=0.666]Epoch 7:  50%|█████     | 6/12 [00:02<00:02,  2.84it/s, loss=1.26, v_num=4uky, accuracy=0.730, val_accuracy=0.666]Epoch 7:  50%|█████     | 6/12 [00:02<00:02,  2.84it/s, loss=1.26, v_num=4uky, accuracy=0.656, val_accuracy=0.666]Epoch 7:  58%|█████▊    | 7/12 [00:02<00:01,  2.91it/s, loss=1.26, v_num=4uky, accuracy=0.656, val_accuracy=0.666]Epoch 7:  58%|█████▊    | 7/12 [00:02<00:01,  2.91it/s, loss=1.26, v_num=4uky, accuracy=0.709, val_accuracy=0.666]Epoch 7:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.26, v_num=4uky, accuracy=0.709, val_accuracy=0.666]Epoch 7:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.26, v_num=4uky, accuracy=0.646, val_accuracy=0.666]Epoch 7:  75%|███████▌  | 9/12 [00:02<00:00,  3.03it/s, loss=1.26, v_num=4uky, accuracy=0.646, val_accuracy=0.666]Epoch 7:  75%|███████▌  | 9/12 [00:02<00:00,  3.03it/s, loss=1.26, v_num=4uky, accuracy=0.666, val_accuracy=0.666]Epoch 7:  83%|████████▎ | 10/12 [00:03<00:00,  3.07it/s, loss=1.26, v_num=4uky, accuracy=0.666, val_accuracy=0.666]Epoch 7:  83%|████████▎ | 10/12 [00:03<00:00,  3.07it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.666]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.30it/s][AEpoch 7:  92%|█████████▏| 11/12 [00:03<00:00,  2.86it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.666]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.39it/s][AEpoch 7: 100%|██████████| 12/12 [00:04<00:00,  2.98it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.666]Epoch 7: 100%|██████████| 12/12 [00:04<00:00,  2.98it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.664]
                                                                      [AEpoch 7: 100%|██████████| 12/12 [00:04<00:00,  2.98it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.664]Epoch 7:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.664]         Epoch 8:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.664]Epoch 8:   8%|▊         | 1/12 [00:00<00:08,  1.37it/s, loss=1.26, v_num=4uky, accuracy=0.679, val_accuracy=0.664]Epoch 8:   8%|▊         | 1/12 [00:00<00:08,  1.37it/s, loss=1.26, v_num=4uky, accuracy=0.699, val_accuracy=0.664]Epoch 8:  17%|█▋        | 2/12 [00:01<00:05,  1.97it/s, loss=1.26, v_num=4uky, accuracy=0.699, val_accuracy=0.664]Epoch 8:  17%|█▋        | 2/12 [00:01<00:05,  1.97it/s, loss=1.26, v_num=4uky, accuracy=0.680, val_accuracy=0.664]Epoch 8:  25%|██▌       | 3/12 [00:01<00:03,  2.31it/s, loss=1.26, v_num=4uky, accuracy=0.680, val_accuracy=0.664]Epoch 8:  25%|██▌       | 3/12 [00:01<00:03,  2.30it/s, loss=1.27, v_num=4uky, accuracy=0.660, val_accuracy=0.664]Epoch 8:  33%|███▎      | 4/12 [00:01<00:03,  2.53it/s, loss=1.27, v_num=4uky, accuracy=0.660, val_accuracy=0.664]Epoch 8:  33%|███▎      | 4/12 [00:01<00:03,  2.53it/s, loss=1.26, v_num=4uky, accuracy=0.684, val_accuracy=0.664]Epoch 8:  42%|████▏     | 5/12 [00:01<00:02,  2.68it/s, loss=1.26, v_num=4uky, accuracy=0.684, val_accuracy=0.664]Epoch 8:  42%|████▏     | 5/12 [00:01<00:02,  2.68it/s, loss=1.26, v_num=4uky, accuracy=0.689, val_accuracy=0.664]Epoch 8:  50%|█████     | 6/12 [00:02<00:02,  2.79it/s, loss=1.26, v_num=4uky, accuracy=0.689, val_accuracy=0.664]Epoch 8:  50%|█████     | 6/12 [00:02<00:02,  2.79it/s, loss=1.27, v_num=4uky, accuracy=0.680, val_accuracy=0.664]Epoch 8:  58%|█████▊    | 7/12 [00:02<00:01,  2.88it/s, loss=1.27, v_num=4uky, accuracy=0.680, val_accuracy=0.664]Epoch 8:  58%|█████▊    | 7/12 [00:02<00:01,  2.88it/s, loss=1.27, v_num=4uky, accuracy=0.668, val_accuracy=0.664]Epoch 8:  67%|██████▋   | 8/12 [00:02<00:01,  2.95it/s, loss=1.27, v_num=4uky, accuracy=0.668, val_accuracy=0.664]Epoch 8:  67%|██████▋   | 8/12 [00:02<00:01,  2.95it/s, loss=1.27, v_num=4uky, accuracy=0.680, val_accuracy=0.664]Epoch 8:  75%|███████▌  | 9/12 [00:02<00:00,  3.01it/s, loss=1.27, v_num=4uky, accuracy=0.680, val_accuracy=0.664]Epoch 8:  75%|███████▌  | 9/12 [00:02<00:00,  3.01it/s, loss=1.27, v_num=4uky, accuracy=0.664, val_accuracy=0.664]Epoch 8:  83%|████████▎ | 10/12 [00:03<00:00,  3.05it/s, loss=1.27, v_num=4uky, accuracy=0.664, val_accuracy=0.664]Epoch 8:  83%|████████▎ | 10/12 [00:03<00:00,  3.05it/s, loss=1.27, v_num=4uky, accuracy=0.689, val_accuracy=0.664]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.35it/s][AEpoch 8:  92%|█████████▏| 11/12 [00:03<00:00,  2.86it/s, loss=1.27, v_num=4uky, accuracy=0.689, val_accuracy=0.664]DEBUG:root:<class 'cem.models.acflow.ACFlow'>
False
DEBUG:root:Restarting run because we could not find test_accuracy_ACFlowModel in old results.
Traceback (most recent call last):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 1552, in train_ac_model
    values, _ = utils.load_call(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 90, in load_call
    return function(**kwargs), False
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 1529, in _inner_call
    [test_results] = trainer.test(model, test_dl)
TypeError: cannot unpack non-iterable NoneType object
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.025 MB uploadedwandb: / 0.014 MB of 0.025 MB uploadedwandb: - 0.026 MB of 0.026 MB uploadedwandb:                                                                                
wandb: 
wandb: Run history:
wandb:            accuracy ▁
wandb:               epoch ▁▁▂▃▄▅▅▆▇█
wandb:                loss ▁
wandb:                 nll ▁
wandb:       test_accuracy ▁
wandb:            test_nll ▁
wandb: trainer/global_step ▁▂▃▄▄▅▅▆▇█
wandb:        val_accuracy ▁▅▇▆▇█▆▆
wandb:            val_loss █▆▄▃▂▁▂▂
wandb:             val_nll █▆▄▃▂▁▂▂
wandb: 
wandb: Run summary:
wandb:            accuracy 0.69133
wandb:               epoch 7
wandb:                loss 1.27504
wandb:                 nll 0.62769
wandb:       test_accuracy 0.50977
wandb:            test_nll 0.9262
wandb: trainer/global_step 79
wandb:        val_accuracy 0.664
wandb:            val_loss 1.28328
wandb:             val_nll 0.63721
wandb: 
wandb: 🚀 View run ac_flow_model_split_0 at: https://wandb.ai/thomasyuan/afa/runs/bu864uky
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/afa
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240427_003452-bu864uky/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 901, in <module>
    main(
  File "experiments/run_experiments_rl.py", line 255, in main
    _, _, ac_model_saved_path = training.train_ac_model(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 1552, in train_ac_model
    values, _ = utils.load_call(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 90, in load_call
    return function(**kwargs), False
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 1529, in _inner_call
    [test_results] = trainer.test(model, test_dl)
TypeError: cannot unpack non-iterable NoneType object
INFO:root:Results will be dumped in results/afa/mnist_afa
DEBUG:root:And the dataset's root directory is /home/xty20/data
[rank: 0] Global seed set to 42
DEBUG:root:		Updated concept group map (with 8 groups):
DEBUG:root:			0 -> [0, 1, 2]
DEBUG:root:			1 -> [3, 4, 5]
DEBUG:root:			2 -> [6, 7, 8]
DEBUG:root:			5 -> [9, 10, 11, 12, 13]
DEBUG:root:			8 -> [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
DEBUG:root:			9 -> [24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
DEBUG:root:			10 -> [34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
DEBUG:root:			11 -> [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]
/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/seed.py:47: LightningDeprecationWarning: `pytorch_lightning.utilities.seed.seed_everything` has been deprecated in v1.8.0 and will be removed in v2.0.0. Please use `lightning_fabric.utilities.seed.seed_everything` instead.
  rank_zero_deprecation(
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "c2y_layers": [
        128,
        128
    ],
    "c_extractor_arch": "Function: c_extractor_arch",
    "check_val_every_n_epoch": 2,
    "dataset": "mnist_add",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "intcem_policy",
        "optimal_greedy_no_prior"
    ],
    "max_epochs": 83,
    "noise_level": 0.0,
    "num_operands": 12,
    "num_workers": 8,
    "results_dir": "results/afa/mnist_afa",
    "root_dir": "/home/xty20/data",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.625,
    "selected_digits": [
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ]
    ],
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 512,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 100,
            "n_components": 40,
            "num_samples": 10,
            "optimizer": "adam",
            "prior": "autoreg",
            "prior_hids": [
                256,
                256
            ],
            "prior_layers": 2,
            "prior_units": 256,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "save_path": "/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt",
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "TL",
                "AF"
            ]
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": false,
            "ent_coef": 0.0,
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "bool": false,
        "c_extractor_arch": "resnet18",
        "cbm_aneal_rate": 0.99999,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_loss",
        "emb_size": 16,
        "extra_dims": 0,
        "learning_rate": 0.001,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "sgd",
        "patience": 5,
        "save_model": true,
        "separate_ac_model_training": true,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_afa_model": false,
        "training_intervention_prob": 0.25,
        "weight_decay": 4e-06
    },
    "skip_repr_evaluation": true,
    "test_dataset_size": 1024,
    "test_subsampling": 1,
    "threshold_labels": 30,
    "train_dataset_size": 5000,
    "trials": 1,
    "use_task_class_weights": true,
    "weight_loss": true
}
INFO:root:Training sample shape is: torch.Size([64, 12, 28, 28]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.FloatTensor
INFO:root:	Number of output classes: 1
INFO:root:Training concept shape is: torch.Size([64, 54]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 54
INFO:root:Computing task class weights in the training dataset with size 79...
INFO:root:Setting log level to: "DEBUG"
WARNING:root:We will rerun model IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_split_0 as requested by the config
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240427_003610-ueddw3bp
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run ac_flow_model_split_0
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/ueddw3bp
Class distribution is: [0.471 0.529]
[TRIAL 1/1 BEGINS AT 27/04/2024 at 00:36:09
Testing: 0it [00:00, ?it/s]Testing:   0%|          | 0/2 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]Testing DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  1.74it/s]Testing DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  2.72it/s]Testing DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  2.71it/s]DEBUG:root:AC Model test results before training:

DEBUG:root:	test_accuracy: 0.509765625
DEBUG:root:	test_nll: 0.9262028932571411
DEBUG:root:AC Model input shape:	x:torch.Size([54])	b:torch.Size([54])	m:torch.Size([54])	y:torch.Size([])AC Data loader batch size: 512
WARNING:root:We will rerun model ac_flow_split_0 as requested by the config
DEBUG:root:Starting AC flow Model training...
	Save path: results/afa/mnist_afa/acflow_model_trial_0.pt

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       Test metric             DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
      test_accuracy             0.509765625
        test_nll            0.9262028932571411
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Sanity Checking: 0it [00:00, ?it/s]Sanity Checking:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  4.99it/s]Sanity Checking DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.33it/s]                                                                           Training: 0it [00:00, ?it/s]Training:   0%|          | 0/12 [00:00<?, ?it/s]Epoch 0:   0%|          | 0/12 [00:00<?, ?it/s] Epoch 0:   8%|▊         | 1/12 [00:00<00:09,  1.18it/s]Epoch 0:   8%|▊         | 1/12 [00:00<00:09,  1.18it/s, loss=1.62, v_num=w3bp, accuracy=0.561]Epoch 0:  17%|█▋        | 2/12 [00:01<00:05,  1.77it/s, loss=1.62, v_num=w3bp, accuracy=0.561]Epoch 0:  17%|█▋        | 2/12 [00:01<00:05,  1.77it/s, loss=1.61, v_num=w3bp, accuracy=0.498]Epoch 0:  25%|██▌       | 3/12 [00:01<00:04,  2.12it/s, loss=1.61, v_num=w3bp, accuracy=0.498]Epoch 0:  25%|██▌       | 3/12 [00:01<00:04,  2.12it/s, loss=1.61, v_num=w3bp, accuracy=0.527]Epoch 0:  33%|███▎      | 4/12 [00:01<00:03,  2.35it/s, loss=1.61, v_num=w3bp, accuracy=0.527]Epoch 0:  33%|███▎      | 4/12 [00:01<00:03,  2.35it/s, loss=1.6, v_num=w3bp, accuracy=0.561] Epoch 0:  42%|████▏     | 5/12 [00:01<00:02,  2.52it/s, loss=1.6, v_num=w3bp, accuracy=0.561]Epoch 0:  42%|████▏     | 5/12 [00:01<00:02,  2.52it/s, loss=1.59, v_num=w3bp, accuracy=0.555]Epoch 0:  50%|█████     | 6/12 [00:02<00:02,  2.65it/s, loss=1.59, v_num=w3bp, accuracy=0.555]Epoch 0:  50%|█████     | 6/12 [00:02<00:02,  2.65it/s, loss=1.59, v_num=w3bp, accuracy=0.518]Epoch 0:  58%|█████▊    | 7/12 [00:02<00:01,  2.75it/s, loss=1.59, v_num=w3bp, accuracy=0.518]Epoch 0:  58%|█████▊    | 7/12 [00:02<00:01,  2.75it/s, loss=1.58, v_num=w3bp, accuracy=0.543]Epoch 0:  67%|██████▋   | 8/12 [00:02<00:01,  2.83it/s, loss=1.58, v_num=w3bp, accuracy=0.543]Epoch 0:  67%|██████▋   | 8/12 [00:02<00:01,  2.83it/s, loss=1.58, v_num=w3bp, accuracy=0.525]Epoch 0:  75%|███████▌  | 9/12 [00:03<00:01,  2.89it/s, loss=1.58, v_num=w3bp, accuracy=0.525]Epoch 0:  75%|███████▌  | 9/12 [00:03<00:01,  2.89it/s, loss=1.57, v_num=w3bp, accuracy=0.543]Epoch 0:  83%|████████▎ | 10/12 [00:03<00:00,  2.95it/s, loss=1.57, v_num=w3bp, accuracy=0.543]Epoch 0:  83%|████████▎ | 10/12 [00:03<00:00,  2.95it/s, loss=1.57, v_num=w3bp, accuracy=0.523]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.41it/s][AEpoch 0:  92%|█████████▏| 11/12 [00:03<00:00,  2.81it/s, loss=1.57, v_num=w3bp, accuracy=0.523]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.49it/s][AEpoch 0: 100%|██████████| 12/12 [00:04<00:00,  2.93it/s, loss=1.57, v_num=w3bp, accuracy=0.523]Epoch 0: 100%|██████████| 12/12 [00:04<00:00,  2.93it/s, loss=1.57, v_num=w3bp, accuracy=0.523, val_accuracy=0.586]
                                                                      [AEpoch 0: 100%|██████████| 12/12 [00:04<00:00,  2.93it/s, loss=1.57, v_num=w3bp, accuracy=0.523, val_accuracy=0.586]Epoch 0:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.57, v_num=w3bp, accuracy=0.523, val_accuracy=0.586]         Epoch 1:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.57, v_num=w3bp, accuracy=0.523, val_accuracy=0.586]Epoch 1:   8%|▊         | 1/12 [00:00<00:07,  1.54it/s, loss=1.57, v_num=w3bp, accuracy=0.523, val_accuracy=0.586]Epoch 1:   8%|▊         | 1/12 [00:00<00:07,  1.54it/s, loss=1.56, v_num=w3bp, accuracy=0.594, val_accuracy=0.586]Epoch 1:  17%|█▋        | 2/12 [00:00<00:04,  2.16it/s, loss=1.56, v_num=w3bp, accuracy=0.594, val_accuracy=0.586]Epoch 1:  17%|█▋        | 2/12 [00:00<00:04,  2.16it/s, loss=1.55, v_num=w3bp, accuracy=0.572, val_accuracy=0.586]Epoch 1:  25%|██▌       | 3/12 [00:01<00:03,  2.49it/s, loss=1.55, v_num=w3bp, accuracy=0.572, val_accuracy=0.586]Epoch 1:  25%|██▌       | 3/12 [00:01<00:03,  2.49it/s, loss=1.55, v_num=w3bp, accuracy=0.613, val_accuracy=0.586]Epoch 1:  33%|███▎      | 4/12 [00:01<00:02,  2.70it/s, loss=1.55, v_num=w3bp, accuracy=0.613, val_accuracy=0.586]Epoch 1:  33%|███▎      | 4/12 [00:01<00:02,  2.70it/s, loss=1.54, v_num=w3bp, accuracy=0.615, val_accuracy=0.586]Epoch 1:  42%|████▏     | 5/12 [00:01<00:02,  2.85it/s, loss=1.54, v_num=w3bp, accuracy=0.615, val_accuracy=0.586]Epoch 1:  42%|████▏     | 5/12 [00:01<00:02,  2.85it/s, loss=1.54, v_num=w3bp, accuracy=0.623, val_accuracy=0.586]Epoch 1:  50%|█████     | 6/12 [00:02<00:02,  2.70it/s, loss=1.54, v_num=w3bp, accuracy=0.623, val_accuracy=0.586]Epoch 1:  50%|█████     | 6/12 [00:02<00:02,  2.70it/s, loss=1.53, v_num=w3bp, accuracy=0.623, val_accuracy=0.586]Epoch 1:  58%|█████▊    | 7/12 [00:02<00:01,  2.81it/s, loss=1.53, v_num=w3bp, accuracy=0.623, val_accuracy=0.586]Epoch 1:  58%|█████▊    | 7/12 [00:02<00:01,  2.81it/s, loss=1.52, v_num=w3bp, accuracy=0.689, val_accuracy=0.586]Epoch 1:  67%|██████▋   | 8/12 [00:02<00:01,  2.89it/s, loss=1.52, v_num=w3bp, accuracy=0.689, val_accuracy=0.586]Epoch 1:  67%|██████▋   | 8/12 [00:02<00:01,  2.89it/s, loss=1.52, v_num=w3bp, accuracy=0.645, val_accuracy=0.586]Epoch 1:  75%|███████▌  | 9/12 [00:03<00:01,  2.96it/s, loss=1.52, v_num=w3bp, accuracy=0.645, val_accuracy=0.586]Epoch 1:  75%|███████▌  | 9/12 [00:03<00:01,  2.96it/s, loss=1.51, v_num=w3bp, accuracy=0.648, val_accuracy=0.586]Epoch 1:  83%|████████▎ | 10/12 [00:03<00:00,  3.02it/s, loss=1.51, v_num=w3bp, accuracy=0.648, val_accuracy=0.586]Epoch 1:  83%|████████▎ | 10/12 [00:03<00:00,  3.02it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.586]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.39it/s][AEpoch 1:  92%|█████████▏| 11/12 [00:03<00:00,  2.82it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.586]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.46it/s][AEpoch 1: 100%|██████████| 12/12 [00:04<00:00,  2.94it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.586]Epoch 1: 100%|██████████| 12/12 [00:04<00:00,  2.94it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.646]
                                                                      [AEpoch 1: 100%|██████████| 12/12 [00:04<00:00,  2.94it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.646]Epoch 1:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.646]         Epoch 2:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.646]Epoch 2:   8%|▊         | 1/12 [00:00<00:07,  1.41it/s, loss=1.51, v_num=w3bp, accuracy=0.679, val_accuracy=0.646]Epoch 2:   8%|▊         | 1/12 [00:00<00:07,  1.41it/s, loss=1.5, v_num=w3bp, accuracy=0.672, val_accuracy=0.646] Epoch 2:  17%|█▋        | 2/12 [00:00<00:04,  2.01it/s, loss=1.5, v_num=w3bp, accuracy=0.672, val_accuracy=0.646]Epoch 2:  17%|█▋        | 2/12 [00:00<00:04,  2.01it/s, loss=1.49, v_num=w3bp, accuracy=0.641, val_accuracy=0.646]Epoch 2:  25%|██▌       | 3/12 [00:01<00:03,  2.35it/s, loss=1.49, v_num=w3bp, accuracy=0.641, val_accuracy=0.646]Epoch 2:  25%|██▌       | 3/12 [00:01<00:03,  2.35it/s, loss=1.48, v_num=w3bp, accuracy=0.658, val_accuracy=0.646]Epoch 2:  33%|███▎      | 4/12 [00:01<00:03,  2.57it/s, loss=1.48, v_num=w3bp, accuracy=0.658, val_accuracy=0.646]Epoch 2:  33%|███▎      | 4/12 [00:01<00:03,  2.57it/s, loss=1.47, v_num=w3bp, accuracy=0.699, val_accuracy=0.646]Epoch 2:  42%|████▏     | 5/12 [00:01<00:02,  2.72it/s, loss=1.47, v_num=w3bp, accuracy=0.699, val_accuracy=0.646]Epoch 2:  42%|████▏     | 5/12 [00:01<00:02,  2.72it/s, loss=1.46, v_num=w3bp, accuracy=0.664, val_accuracy=0.646]Epoch 2:  50%|█████     | 6/12 [00:02<00:02,  2.82it/s, loss=1.46, v_num=w3bp, accuracy=0.664, val_accuracy=0.646]Epoch 2:  50%|█████     | 6/12 [00:02<00:02,  2.82it/s, loss=1.45, v_num=w3bp, accuracy=0.686, val_accuracy=0.646]Epoch 2:  58%|█████▊    | 7/12 [00:02<00:01,  2.91it/s, loss=1.45, v_num=w3bp, accuracy=0.686, val_accuracy=0.646]Epoch 2:  58%|█████▊    | 7/12 [00:02<00:01,  2.91it/s, loss=1.44, v_num=w3bp, accuracy=0.676, val_accuracy=0.646]Epoch 2:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.44, v_num=w3bp, accuracy=0.676, val_accuracy=0.646]Epoch 2:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.43, v_num=w3bp, accuracy=0.648, val_accuracy=0.646]Epoch 2:  75%|███████▌  | 9/12 [00:02<00:00,  3.03it/s, loss=1.43, v_num=w3bp, accuracy=0.648, val_accuracy=0.646]Epoch 2:  75%|███████▌  | 9/12 [00:02<00:00,  3.03it/s, loss=1.42, v_num=w3bp, accuracy=0.662, val_accuracy=0.646]Epoch 2:  83%|████████▎ | 10/12 [00:03<00:00,  3.08it/s, loss=1.42, v_num=w3bp, accuracy=0.662, val_accuracy=0.646]Epoch 2:  83%|████████▎ | 10/12 [00:03<00:00,  3.08it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.646]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.39it/s][AEpoch 2:  92%|█████████▏| 11/12 [00:03<00:00,  2.95it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.646]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.47it/s][AEpoch 2: 100%|██████████| 12/12 [00:03<00:00,  3.07it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.646]Epoch 2: 100%|██████████| 12/12 [00:03<00:00,  3.07it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.685]
                                                                      [AEpoch 2: 100%|██████████| 12/12 [00:03<00:00,  3.07it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.685]Epoch 2:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.685]         Epoch 3:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.685]Epoch 3:   8%|▊         | 1/12 [00:00<00:07,  1.44it/s, loss=1.41, v_num=w3bp, accuracy=0.696, val_accuracy=0.685]Epoch 3:   8%|▊         | 1/12 [00:00<00:07,  1.44it/s, loss=1.4, v_num=w3bp, accuracy=0.695, val_accuracy=0.685] Epoch 3:  17%|█▋        | 2/12 [00:00<00:04,  2.06it/s, loss=1.4, v_num=w3bp, accuracy=0.695, val_accuracy=0.685]Epoch 3:  17%|█▋        | 2/12 [00:00<00:04,  2.06it/s, loss=1.4, v_num=w3bp, accuracy=0.678, val_accuracy=0.685]Epoch 3:  25%|██▌       | 3/12 [00:01<00:03,  2.41it/s, loss=1.4, v_num=w3bp, accuracy=0.678, val_accuracy=0.685]Epoch 3:  25%|██▌       | 3/12 [00:01<00:03,  2.40it/s, loss=1.39, v_num=w3bp, accuracy=0.674, val_accuracy=0.685]Epoch 3:  33%|███▎      | 4/12 [00:01<00:03,  2.62it/s, loss=1.39, v_num=w3bp, accuracy=0.674, val_accuracy=0.685]Epoch 3:  33%|███▎      | 4/12 [00:01<00:03,  2.62it/s, loss=1.38, v_num=w3bp, accuracy=0.695, val_accuracy=0.685]Epoch 3:  42%|████▏     | 5/12 [00:01<00:02,  2.77it/s, loss=1.38, v_num=w3bp, accuracy=0.695, val_accuracy=0.685]Epoch 3:  42%|████▏     | 5/12 [00:01<00:02,  2.77it/s, loss=1.38, v_num=w3bp, accuracy=0.711, val_accuracy=0.685]Epoch 3:  50%|█████     | 6/12 [00:02<00:02,  2.88it/s, loss=1.38, v_num=w3bp, accuracy=0.711, val_accuracy=0.685]Epoch 3:  50%|█████     | 6/12 [00:02<00:02,  2.88it/s, loss=1.37, v_num=w3bp, accuracy=0.676, val_accuracy=0.685]Epoch 3:  58%|█████▊    | 7/12 [00:02<00:01,  2.96it/s, loss=1.37, v_num=w3bp, accuracy=0.676, val_accuracy=0.685]Epoch 3:  58%|█████▊    | 7/12 [00:02<00:01,  2.96it/s, loss=1.37, v_num=w3bp, accuracy=0.688, val_accuracy=0.685]Epoch 3:  67%|██████▋   | 8/12 [00:02<00:01,  3.03it/s, loss=1.37, v_num=w3bp, accuracy=0.688, val_accuracy=0.685]Epoch 3:  67%|██████▋   | 8/12 [00:02<00:01,  3.03it/s, loss=1.36, v_num=w3bp, accuracy=0.648, val_accuracy=0.685]Epoch 3:  75%|███████▌  | 9/12 [00:02<00:00,  3.09it/s, loss=1.36, v_num=w3bp, accuracy=0.648, val_accuracy=0.685]Epoch 3:  75%|███████▌  | 9/12 [00:02<00:00,  3.09it/s, loss=1.36, v_num=w3bp, accuracy=0.688, val_accuracy=0.685]Epoch 3:  83%|████████▎ | 10/12 [00:03<00:00,  3.14it/s, loss=1.36, v_num=w3bp, accuracy=0.688, val_accuracy=0.685]Epoch 3:  83%|████████▎ | 10/12 [00:03<00:00,  3.13it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.685]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.42it/s][AEpoch 3:  92%|█████████▏| 11/12 [00:03<00:00,  2.90it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.685]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.51it/s][AEpoch 3: 100%|██████████| 12/12 [00:03<00:00,  3.02it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.685]Epoch 3: 100%|██████████| 12/12 [00:03<00:00,  3.02it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.669]
                                                                      [AEpoch 3: 100%|██████████| 12/12 [00:03<00:00,  3.02it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.669]Epoch 3:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.669]         Epoch 4:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.669]Epoch 4:   8%|▊         | 1/12 [00:00<00:08,  1.33it/s, loss=1.35, v_num=w3bp, accuracy=0.648, val_accuracy=0.669]Epoch 4:   8%|▊         | 1/12 [00:00<00:08,  1.32it/s, loss=1.35, v_num=w3bp, accuracy=0.662, val_accuracy=0.669]Epoch 4:  17%|█▋        | 2/12 [00:01<00:05,  1.94it/s, loss=1.35, v_num=w3bp, accuracy=0.662, val_accuracy=0.669]Epoch 4:  17%|█▋        | 2/12 [00:01<00:05,  1.94it/s, loss=1.34, v_num=w3bp, accuracy=0.662, val_accuracy=0.669]Epoch 4:  25%|██▌       | 3/12 [00:01<00:03,  2.29it/s, loss=1.34, v_num=w3bp, accuracy=0.662, val_accuracy=0.669]Epoch 4:  25%|██▌       | 3/12 [00:01<00:03,  2.29it/s, loss=1.33, v_num=w3bp, accuracy=0.699, val_accuracy=0.669]Epoch 4:  33%|███▎      | 4/12 [00:01<00:03,  2.53it/s, loss=1.33, v_num=w3bp, accuracy=0.699, val_accuracy=0.669]Epoch 4:  33%|███▎      | 4/12 [00:01<00:03,  2.52it/s, loss=1.33, v_num=w3bp, accuracy=0.699, val_accuracy=0.669]Epoch 4:  42%|████▏     | 5/12 [00:01<00:02,  2.69it/s, loss=1.33, v_num=w3bp, accuracy=0.699, val_accuracy=0.669]Epoch 4:  42%|████▏     | 5/12 [00:01<00:02,  2.69it/s, loss=1.32, v_num=w3bp, accuracy=0.729, val_accuracy=0.669]Epoch 4:  50%|█████     | 6/12 [00:02<00:02,  2.81it/s, loss=1.32, v_num=w3bp, accuracy=0.729, val_accuracy=0.669]Epoch 4:  50%|█████     | 6/12 [00:02<00:02,  2.81it/s, loss=1.32, v_num=w3bp, accuracy=0.695, val_accuracy=0.669]Epoch 4:  58%|█████▊    | 7/12 [00:02<00:01,  2.91it/s, loss=1.32, v_num=w3bp, accuracy=0.695, val_accuracy=0.669]Epoch 4:  58%|█████▊    | 7/12 [00:02<00:01,  2.91it/s, loss=1.32, v_num=w3bp, accuracy=0.707, val_accuracy=0.669]Epoch 4:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.32, v_num=w3bp, accuracy=0.707, val_accuracy=0.669]Epoch 4:  67%|██████▋   | 8/12 [00:02<00:01,  2.98it/s, loss=1.31, v_num=w3bp, accuracy=0.697, val_accuracy=0.669]Epoch 4:  75%|███████▌  | 9/12 [00:02<00:00,  3.04it/s, loss=1.31, v_num=w3bp, accuracy=0.697, val_accuracy=0.669]Epoch 4:  75%|███████▌  | 9/12 [00:02<00:00,  3.04it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.669]Epoch 4:  83%|████████▎ | 10/12 [00:03<00:00,  3.09it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.669]Epoch 4:  83%|████████▎ | 10/12 [00:03<00:00,  3.09it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.669]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.39it/s][AEpoch 4:  92%|█████████▏| 11/12 [00:03<00:00,  2.88it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.669]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.47it/s][AEpoch 4: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.669]Epoch 4: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.685]
                                                                      [AEpoch 4: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.685]Epoch 4:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.685]         Epoch 5:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.685]Epoch 5:   8%|▊         | 1/12 [00:00<00:07,  1.38it/s, loss=1.31, v_num=w3bp, accuracy=0.691, val_accuracy=0.685]Epoch 5:   8%|▊         | 1/12 [00:00<00:08,  1.37it/s, loss=1.3, v_num=w3bp, accuracy=0.725, val_accuracy=0.685] Epoch 5:  17%|█▋        | 2/12 [00:01<00:05,  1.98it/s, loss=1.3, v_num=w3bp, accuracy=0.725, val_accuracy=0.685]Epoch 5:  17%|█▋        | 2/12 [00:01<00:05,  1.97it/s, loss=1.3, v_num=w3bp, accuracy=0.691, val_accuracy=0.685]Epoch 5:  25%|██▌       | 3/12 [00:01<00:03,  2.32it/s, loss=1.3, v_num=w3bp, accuracy=0.691, val_accuracy=0.685]Epoch 5:  25%|██▌       | 3/12 [00:01<00:03,  2.32it/s, loss=1.29, v_num=w3bp, accuracy=0.676, val_accuracy=0.685]Epoch 5:  33%|███▎      | 4/12 [00:01<00:03,  2.54it/s, loss=1.29, v_num=w3bp, accuracy=0.676, val_accuracy=0.685]Epoch 5:  33%|███▎      | 4/12 [00:01<00:03,  2.54it/s, loss=1.29, v_num=w3bp, accuracy=0.688, val_accuracy=0.685]Epoch 5:  42%|████▏     | 5/12 [00:01<00:02,  2.69it/s, loss=1.29, v_num=w3bp, accuracy=0.688, val_accuracy=0.685]Epoch 5:  42%|████▏     | 5/12 [00:01<00:02,  2.69it/s, loss=1.29, v_num=w3bp, accuracy=0.719, val_accuracy=0.685]Epoch 5:  50%|█████     | 6/12 [00:02<00:02,  2.80it/s, loss=1.29, v_num=w3bp, accuracy=0.719, val_accuracy=0.685]Epoch 5:  50%|█████     | 6/12 [00:02<00:02,  2.80it/s, loss=1.28, v_num=w3bp, accuracy=0.699, val_accuracy=0.685]Epoch 5:  58%|█████▊    | 7/12 [00:02<00:01,  2.89it/s, loss=1.28, v_num=w3bp, accuracy=0.699, val_accuracy=0.685]Epoch 5:  58%|█████▊    | 7/12 [00:02<00:01,  2.88it/s, loss=1.28, v_num=w3bp, accuracy=0.684, val_accuracy=0.685]Epoch 5:  67%|██████▋   | 8/12 [00:02<00:01,  2.95it/s, loss=1.28, v_num=w3bp, accuracy=0.684, val_accuracy=0.685]Epoch 5:  67%|██████▋   | 8/12 [00:02<00:01,  2.95it/s, loss=1.28, v_num=w3bp, accuracy=0.656, val_accuracy=0.685]Epoch 5:  75%|███████▌  | 9/12 [00:02<00:00,  3.01it/s, loss=1.28, v_num=w3bp, accuracy=0.656, val_accuracy=0.685]Epoch 5:  75%|███████▌  | 9/12 [00:02<00:00,  3.01it/s, loss=1.28, v_num=w3bp, accuracy=0.703, val_accuracy=0.685]Epoch 5:  83%|████████▎ | 10/12 [00:03<00:00,  3.06it/s, loss=1.28, v_num=w3bp, accuracy=0.703, val_accuracy=0.685]Epoch 5:  83%|████████▎ | 10/12 [00:03<00:00,  3.06it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.685]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.41it/s][AEpoch 5:  92%|█████████▏| 11/12 [00:03<00:00,  2.87it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.685]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.48it/s][AEpoch 5: 100%|██████████| 12/12 [00:04<00:00,  2.99it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.685]Epoch 5: 100%|██████████| 12/12 [00:04<00:00,  2.98it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.704]
                                                                      [AEpoch 5: 100%|██████████| 12/12 [00:04<00:00,  2.98it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.704]Epoch 5:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.704]         Epoch 6:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.704]Epoch 6:   8%|▊         | 1/12 [00:00<00:07,  1.38it/s, loss=1.27, v_num=w3bp, accuracy=0.673, val_accuracy=0.704]Epoch 6:   8%|▊         | 1/12 [00:00<00:08,  1.37it/s, loss=1.27, v_num=w3bp, accuracy=0.723, val_accuracy=0.704]Epoch 6:  17%|█▋        | 2/12 [00:01<00:05,  1.97it/s, loss=1.27, v_num=w3bp, accuracy=0.723, val_accuracy=0.704]Epoch 6:  17%|█▋        | 2/12 [00:01<00:05,  1.97it/s, loss=1.27, v_num=w3bp, accuracy=0.695, val_accuracy=0.704]Epoch 6:  25%|██▌       | 3/12 [00:01<00:03,  2.31it/s, loss=1.27, v_num=w3bp, accuracy=0.695, val_accuracy=0.704]Epoch 6:  25%|██▌       | 3/12 [00:01<00:03,  2.31it/s, loss=1.27, v_num=w3bp, accuracy=0.646, val_accuracy=0.704]Epoch 6:  33%|███▎      | 4/12 [00:01<00:03,  2.53it/s, loss=1.27, v_num=w3bp, accuracy=0.646, val_accuracy=0.704]Epoch 6:  33%|███▎      | 4/12 [00:01<00:03,  2.53it/s, loss=1.27, v_num=w3bp, accuracy=0.734, val_accuracy=0.704]Epoch 6:  42%|████▏     | 5/12 [00:01<00:02,  2.69it/s, loss=1.27, v_num=w3bp, accuracy=0.734, val_accuracy=0.704]Epoch 6:  42%|████▏     | 5/12 [00:01<00:02,  2.68it/s, loss=1.27, v_num=w3bp, accuracy=0.711, val_accuracy=0.704]Epoch 6:  50%|█████     | 6/12 [00:02<00:02,  2.80it/s, loss=1.27, v_num=w3bp, accuracy=0.711, val_accuracy=0.704]Epoch 6:  50%|█████     | 6/12 [00:02<00:02,  2.80it/s, loss=1.27, v_num=w3bp, accuracy=0.670, val_accuracy=0.704]Epoch 6:  58%|█████▊    | 7/12 [00:02<00:01,  2.89it/s, loss=1.27, v_num=w3bp, accuracy=0.670, val_accuracy=0.704]Epoch 6:  58%|█████▊    | 7/12 [00:02<00:01,  2.89it/s, loss=1.27, v_num=w3bp, accuracy=0.701, val_accuracy=0.704]Epoch 6:  67%|██████▋   | 8/12 [00:02<00:01,  2.96it/s, loss=1.27, v_num=w3bp, accuracy=0.701, val_accuracy=0.704]Epoch 6:  67%|██████▋   | 8/12 [00:02<00:01,  2.96it/s, loss=1.26, v_num=w3bp, accuracy=0.660, val_accuracy=0.704]Epoch 6:  75%|███████▌  | 9/12 [00:02<00:00,  3.01it/s, loss=1.26, v_num=w3bp, accuracy=0.660, val_accuracy=0.704]Epoch 6:  75%|███████▌  | 9/12 [00:02<00:00,  3.01it/s, loss=1.26, v_num=w3bp, accuracy=0.697, val_accuracy=0.704]Epoch 6:  83%|████████▎ | 10/12 [00:03<00:00,  3.06it/s, loss=1.26, v_num=w3bp, accuracy=0.697, val_accuracy=0.704]Epoch 6:  83%|████████▎ | 10/12 [00:03<00:00,  3.06it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.704]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  4.80it/s][AEpoch 6:  92%|█████████▏| 11/12 [00:03<00:00,  2.89it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.704]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.14it/s][AEpoch 6: 100%|██████████| 12/12 [00:03<00:00,  3.01it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.704]Epoch 6: 100%|██████████| 12/12 [00:03<00:00,  3.01it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.666]
                                                                      [AEpoch 6: 100%|██████████| 12/12 [00:03<00:00,  3.01it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.666]Epoch 6:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.666]         Epoch 7:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.666]Epoch 7:   8%|▊         | 1/12 [00:00<00:06,  1.60it/s, loss=1.26, v_num=w3bp, accuracy=0.719, val_accuracy=0.666]Epoch 7:   8%|▊         | 1/12 [00:00<00:06,  1.60it/s, loss=1.26, v_num=w3bp, accuracy=0.709, val_accuracy=0.666]Epoch 7:  17%|█▋        | 2/12 [00:00<00:04,  2.21it/s, loss=1.26, v_num=w3bp, accuracy=0.709, val_accuracy=0.666]Epoch 7:  17%|█▋        | 2/12 [00:00<00:04,  2.21it/s, loss=1.26, v_num=w3bp, accuracy=0.684, val_accuracy=0.666]Epoch 7:  25%|██▌       | 3/12 [00:01<00:03,  2.54it/s, loss=1.26, v_num=w3bp, accuracy=0.684, val_accuracy=0.666]Epoch 7:  25%|██▌       | 3/12 [00:01<00:03,  2.53it/s, loss=1.26, v_num=w3bp, accuracy=0.705, val_accuracy=0.666]Epoch 7:  33%|███▎      | 4/12 [00:01<00:02,  2.74it/s, loss=1.26, v_num=w3bp, accuracy=0.705, val_accuracy=0.666]Epoch 7:  33%|███▎      | 4/12 [00:01<00:02,  2.74it/s, loss=1.26, v_num=w3bp, accuracy=0.688, val_accuracy=0.666]Epoch 7:  42%|████▏     | 5/12 [00:01<00:02,  2.88it/s, loss=1.26, v_num=w3bp, accuracy=0.688, val_accuracy=0.666]Epoch 7:  42%|████▏     | 5/12 [00:01<00:02,  2.88it/s, loss=1.26, v_num=w3bp, accuracy=0.730, val_accuracy=0.666]Epoch 7:  50%|█████     | 6/12 [00:02<00:02,  2.96it/s, loss=1.26, v_num=w3bp, accuracy=0.730, val_accuracy=0.666]Epoch 7:  50%|█████     | 6/12 [00:02<00:02,  2.96it/s, loss=1.26, v_num=w3bp, accuracy=0.656, val_accuracy=0.666]Epoch 7:  58%|█████▊    | 7/12 [00:02<00:01,  3.03it/s, loss=1.26, v_num=w3bp, accuracy=0.656, val_accuracy=0.666]Epoch 7:  58%|█████▊    | 7/12 [00:02<00:01,  3.03it/s, loss=1.26, v_num=w3bp, accuracy=0.709, val_accuracy=0.666]Epoch 7:  67%|██████▋   | 8/12 [00:02<00:01,  3.09it/s, loss=1.26, v_num=w3bp, accuracy=0.709, val_accuracy=0.666]Epoch 7:  67%|██████▋   | 8/12 [00:02<00:01,  3.09it/s, loss=1.26, v_num=w3bp, accuracy=0.646, val_accuracy=0.666]Epoch 7:  75%|███████▌  | 9/12 [00:02<00:00,  3.14it/s, loss=1.26, v_num=w3bp, accuracy=0.646, val_accuracy=0.666]Epoch 7:  75%|███████▌  | 9/12 [00:02<00:00,  3.13it/s, loss=1.26, v_num=w3bp, accuracy=0.666, val_accuracy=0.666]Epoch 7:  83%|████████▎ | 10/12 [00:03<00:00,  3.17it/s, loss=1.26, v_num=w3bp, accuracy=0.666, val_accuracy=0.666]Epoch 7:  83%|████████▎ | 10/12 [00:03<00:00,  3.17it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.666]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.37it/s][AEpoch 7:  92%|█████████▏| 11/12 [00:03<00:00,  2.95it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.666]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.46it/s][AEpoch 7: 100%|██████████| 12/12 [00:03<00:00,  3.07it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.666]Epoch 7: 100%|██████████| 12/12 [00:03<00:00,  3.07it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.664]
                                                                      [AEpoch 7: 100%|██████████| 12/12 [00:03<00:00,  3.06it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.664]Epoch 7:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.664]         Epoch 8:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.664]Epoch 8:   8%|▊         | 1/12 [00:00<00:07,  1.43it/s, loss=1.26, v_num=w3bp, accuracy=0.679, val_accuracy=0.664]Epoch 8:   8%|▊         | 1/12 [00:00<00:07,  1.42it/s, loss=1.26, v_num=w3bp, accuracy=0.699, val_accuracy=0.664]Epoch 8:  17%|█▋        | 2/12 [00:00<00:04,  2.05it/s, loss=1.26, v_num=w3bp, accuracy=0.699, val_accuracy=0.664]Epoch 8:  17%|█▋        | 2/12 [00:00<00:04,  2.05it/s, loss=1.26, v_num=w3bp, accuracy=0.680, val_accuracy=0.664]Epoch 8:  25%|██▌       | 3/12 [00:01<00:03,  2.39it/s, loss=1.26, v_num=w3bp, accuracy=0.680, val_accuracy=0.664]Epoch 8:  25%|██▌       | 3/12 [00:01<00:03,  2.39it/s, loss=1.27, v_num=w3bp, accuracy=0.660, val_accuracy=0.664]Epoch 8:  33%|███▎      | 4/12 [00:01<00:03,  2.62it/s, loss=1.27, v_num=w3bp, accuracy=0.660, val_accuracy=0.664]Epoch 8:  33%|███▎      | 4/12 [00:01<00:03,  2.62it/s, loss=1.26, v_num=w3bp, accuracy=0.684, val_accuracy=0.664]Epoch 8:  42%|████▏     | 5/12 [00:01<00:02,  2.79it/s, loss=1.26, v_num=w3bp, accuracy=0.684, val_accuracy=0.664]Epoch 8:  42%|████▏     | 5/12 [00:01<00:02,  2.78it/s, loss=1.26, v_num=w3bp, accuracy=0.689, val_accuracy=0.664]Epoch 8:  50%|█████     | 6/12 [00:02<00:02,  2.90it/s, loss=1.26, v_num=w3bp, accuracy=0.689, val_accuracy=0.664]Epoch 8:  50%|█████     | 6/12 [00:02<00:02,  2.90it/s, loss=1.27, v_num=w3bp, accuracy=0.680, val_accuracy=0.664]Epoch 8:  58%|█████▊    | 7/12 [00:02<00:01,  2.99it/s, loss=1.27, v_num=w3bp, accuracy=0.680, val_accuracy=0.664]Epoch 8:  58%|█████▊    | 7/12 [00:02<00:01,  2.99it/s, loss=1.27, v_num=w3bp, accuracy=0.668, val_accuracy=0.664]Epoch 8:  67%|██████▋   | 8/12 [00:02<00:01,  3.06it/s, loss=1.27, v_num=w3bp, accuracy=0.668, val_accuracy=0.664]Epoch 8:  67%|██████▋   | 8/12 [00:02<00:01,  3.06it/s, loss=1.27, v_num=w3bp, accuracy=0.680, val_accuracy=0.664]Epoch 8:  75%|███████▌  | 9/12 [00:02<00:00,  3.12it/s, loss=1.27, v_num=w3bp, accuracy=0.680, val_accuracy=0.664]Epoch 8:  75%|███████▌  | 9/12 [00:02<00:00,  3.11it/s, loss=1.27, v_num=w3bp, accuracy=0.664, val_accuracy=0.664]Epoch 8:  83%|████████▎ | 10/12 [00:03<00:00,  3.16it/s, loss=1.27, v_num=w3bp, accuracy=0.664, val_accuracy=0.664]Epoch 8:  83%|████████▎ | 10/12 [00:03<00:00,  3.16it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.664]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.32it/s][AEpoch 8:  92%|█████████▏| 11/12 [00:03<00:00,  2.92it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.664]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.40it/s][AEpoch 8: 100%|██████████| 12/12 [00:03<00:00,  3.04it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.664]Epoch 8: 100%|██████████| 12/12 [00:03<00:00,  3.04it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]
                                                                      [AEpoch 8: 100%|██████████| 12/12 [00:03<00:00,  3.04it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]Epoch 8:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]         Epoch 9:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]Epoch 9:   8%|▊         | 1/12 [00:00<00:07,  1.46it/s, loss=1.27, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]Epoch 9:   8%|▊         | 1/12 [00:00<00:07,  1.46it/s, loss=1.27, v_num=w3bp, accuracy=0.682, val_accuracy=0.711]Epoch 9:  17%|█▋        | 2/12 [00:00<00:04,  2.07it/s, loss=1.27, v_num=w3bp, accuracy=0.682, val_accuracy=0.711]Epoch 9:  17%|█▋        | 2/12 [00:00<00:04,  2.07it/s, loss=1.27, v_num=w3bp, accuracy=0.697, val_accuracy=0.711]Epoch 9:  25%|██▌       | 3/12 [00:01<00:03,  2.40it/s, loss=1.27, v_num=w3bp, accuracy=0.697, val_accuracy=0.711]Epoch 9:  25%|██▌       | 3/12 [00:01<00:03,  2.40it/s, loss=1.27, v_num=w3bp, accuracy=0.664, val_accuracy=0.711]Epoch 9:  33%|███▎      | 4/12 [00:01<00:03,  2.61it/s, loss=1.27, v_num=w3bp, accuracy=0.664, val_accuracy=0.711]Epoch 9:  33%|███▎      | 4/12 [00:01<00:03,  2.61it/s, loss=1.28, v_num=w3bp, accuracy=0.678, val_accuracy=0.711]Epoch 9:  42%|████▏     | 5/12 [00:01<00:02,  2.75it/s, loss=1.28, v_num=w3bp, accuracy=0.678, val_accuracy=0.711]Epoch 9:  42%|████▏     | 5/12 [00:01<00:02,  2.74it/s, loss=1.28, v_num=w3bp, accuracy=0.695, val_accuracy=0.711]Epoch 9:  50%|█████     | 6/12 [00:02<00:02,  2.85it/s, loss=1.28, v_num=w3bp, accuracy=0.695, val_accuracy=0.711]Epoch 9:  50%|█████     | 6/12 [00:02<00:02,  2.85it/s, loss=1.28, v_num=w3bp, accuracy=0.686, val_accuracy=0.711]Epoch 9:  58%|█████▊    | 7/12 [00:02<00:01,  2.94it/s, loss=1.28, v_num=w3bp, accuracy=0.686, val_accuracy=0.711]Epoch 9:  58%|█████▊    | 7/12 [00:02<00:01,  2.94it/s, loss=1.28, v_num=w3bp, accuracy=0.723, val_accuracy=0.711]Epoch 9:  67%|██████▋   | 8/12 [00:02<00:01,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.723, val_accuracy=0.711]Epoch 9:  67%|██████▋   | 8/12 [00:02<00:01,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.701, val_accuracy=0.711]Epoch 9:  75%|███████▌  | 9/12 [00:02<00:00,  3.05it/s, loss=1.28, v_num=w3bp, accuracy=0.701, val_accuracy=0.711]Epoch 9:  75%|███████▌  | 9/12 [00:02<00:00,  3.05it/s, loss=1.28, v_num=w3bp, accuracy=0.717, val_accuracy=0.711]Epoch 9:  83%|████████▎ | 10/12 [00:03<00:00,  3.10it/s, loss=1.28, v_num=w3bp, accuracy=0.717, val_accuracy=0.711]Epoch 9:  83%|████████▎ | 10/12 [00:03<00:00,  3.10it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.711]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.34it/s][AEpoch 9:  92%|█████████▏| 11/12 [00:03<00:00,  2.88it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.711]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.42it/s][AEpoch 9: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.711]Epoch 9: 100%|██████████| 12/12 [00:04<00:00,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.695]
                                                                      [AEpoch 9: 100%|██████████| 12/12 [00:04<00:00,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.695]Epoch 9:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.695]         Epoch 10:   0%|          | 0/12 [00:00<?, ?it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.695]Epoch 10:   8%|▊         | 1/12 [00:00<00:08,  1.37it/s, loss=1.28, v_num=w3bp, accuracy=0.666, val_accuracy=0.695]Epoch 10:   8%|▊         | 1/12 [00:00<00:08,  1.37it/s, loss=1.28, v_num=w3bp, accuracy=0.695, val_accuracy=0.695]Epoch 10:  17%|█▋        | 2/12 [00:01<00:05,  1.99it/s, loss=1.28, v_num=w3bp, accuracy=0.695, val_accuracy=0.695]Epoch 10:  17%|█▋        | 2/12 [00:01<00:05,  1.98it/s, loss=1.28, v_num=w3bp, accuracy=0.717, val_accuracy=0.695]Epoch 10:  25%|██▌       | 3/12 [00:01<00:03,  2.34it/s, loss=1.28, v_num=w3bp, accuracy=0.717, val_accuracy=0.695]Epoch 10:  25%|██▌       | 3/12 [00:01<00:03,  2.34it/s, loss=1.28, v_num=w3bp, accuracy=0.660, val_accuracy=0.695]Epoch 10:  33%|███▎      | 4/12 [00:01<00:03,  2.57it/s, loss=1.28, v_num=w3bp, accuracy=0.660, val_accuracy=0.695]Epoch 10:  33%|███▎      | 4/12 [00:01<00:03,  2.57it/s, loss=1.28, v_num=w3bp, accuracy=0.680, val_accuracy=0.695]Epoch 10:  42%|████▏     | 5/12 [00:01<00:02,  2.73it/s, loss=1.28, v_num=w3bp, accuracy=0.680, val_accuracy=0.695]Epoch 10:  42%|████▏     | 5/12 [00:01<00:02,  2.73it/s, loss=1.28, v_num=w3bp, accuracy=0.701, val_accuracy=0.695]Epoch 10:  50%|█████     | 6/12 [00:02<00:02,  2.85it/s, loss=1.28, v_num=w3bp, accuracy=0.701, val_accuracy=0.695]Epoch 10:  50%|█████     | 6/12 [00:02<00:02,  2.85it/s, loss=1.28, v_num=w3bp, accuracy=0.688, val_accuracy=0.695]Epoch 10:  58%|█████▊    | 7/12 [00:02<00:01,  2.94it/s, loss=1.28, v_num=w3bp, accuracy=0.688, val_accuracy=0.695]Epoch 10:  58%|█████▊    | 7/12 [00:02<00:01,  2.94it/s, loss=1.28, v_num=w3bp, accuracy=0.674, val_accuracy=0.695]Epoch 10:  67%|██████▋   | 8/12 [00:02<00:01,  3.01it/s, loss=1.28, v_num=w3bp, accuracy=0.674, val_accuracy=0.695]Epoch 10:  67%|██████▋   | 8/12 [00:02<00:01,  3.01it/s, loss=1.28, v_num=w3bp, accuracy=0.668, val_accuracy=0.695]Epoch 10:  75%|███████▌  | 9/12 [00:02<00:00,  3.07it/s, loss=1.28, v_num=w3bp, accuracy=0.668, val_accuracy=0.695]Epoch 10:  75%|███████▌  | 9/12 [00:02<00:00,  3.07it/s, loss=1.28, v_num=w3bp, accuracy=0.734, val_accuracy=0.695]Epoch 10:  83%|████████▎ | 10/12 [00:03<00:00,  3.12it/s, loss=1.28, v_num=w3bp, accuracy=0.734, val_accuracy=0.695]Epoch 10:  83%|████████▎ | 10/12 [00:03<00:00,  3.12it/s, loss=1.28, v_num=w3bp, accuracy=0.689, val_accuracy=0.695]
Validation: 0it [00:00, ?it/s][A
Validation:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.39it/s][AEpoch 10:  92%|█████████▏| 11/12 [00:03<00:00,  2.88it/s, loss=1.28, v_num=w3bp, accuracy=0.689, val_accuracy=0.695]
Validation DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.48it/s][AEpoch 10: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.689, val_accuracy=0.695]Epoch 10: 100%|██████████| 12/12 [00:03<00:00,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]
                                                                      [AEpoch 10: 100%|██████████| 12/12 [00:04<00:00,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]Epoch 10: 100%|██████████| 12/12 [00:04<00:00,  3.00it/s, loss=1.28, v_num=w3bp, accuracy=0.689, val_accuracy=0.711]DEBUG:root:<class 'cem.models.acflow.ACFlow'>
False
DEBUG:root:Restarting run because we could not find test_accuracy_ACFlowModel in old results.

Testing: 0it [00:00, ?it/s]Testing:   0%|          | 0/2 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]Testing DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  5.63it/s]Testing DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.87it/s]Testing DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  5.84it/s]wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.027 MB of 0.027 MB uploadedwandb:                                                                                
wandb: 
wandb: Run history:
wandb:            accuracy █▁
wandb:               epoch ▁▁▂▂▃▄▄▄▅▅▆▇▇▇█
wandb:                loss █▁
wandb:                 nll █▁
wandb:       test_accuracy ▁█
wandb:            test_nll █▁
wandb: trainer/global_step ▁▂▂▃▃▄▄▅▅▆▇▇▇██
wandb:        val_accuracy ▁▄▇▆▇█▅▅█▇█
wandb:            val_loss █▆▄▃▂▁▂▂▁▁▂
wandb:             val_nll █▆▄▃▂▁▂▂▁▁▂
wandb: 
wandb: Run summary:
wandb:            accuracy 0.66582
wandb:               epoch 11
wandb:                loss 1.2742
wandb:                 nll 0.62171
wandb:       test_accuracy 0.69336
wandb:            test_nll 0.6592
wandb: trainer/global_step 110
wandb:        val_accuracy 0.711
wandb:            val_loss 1.28287
wandb:             val_nll 0.63268
wandb: 
wandb: 🚀 View run ac_flow_model_split_0 at: https://wandb.ai/thomasyuan/afa/runs/ueddw3bp
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/afa
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240427_003610-ueddw3bp/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
DEBUG:root:Setting ac model save path to be results/afa/mnist_afa/acflow_model_trial_0.pt
[rank: 0] Global seed set to 42
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: - Waiting for wandb.init()...wandb: \ Waiting for wandb.init()...wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240427_003704-fq4l734y
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/fq4l734y

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       Test metric             DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
      test_accuracy             0.693359375
        test_nll            0.6591975688934326
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
AC Model test_accuracy: 69.34%, 
AC Model test_nll: 65.92%, 
AC Model training_time: 4484.11%, 
AC Model num_epochs: 1100.00%, 
with 11 epochs in 44.84 seconds
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.001
	weight_decay -> 4e-06
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7f67b91cf670>
	optimizer -> sgd
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	separate_ac_model_training -> True
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	ac_model_config -> {'save_path': 'results/afa/mnist_afa/acflow_model_trial_0.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 1
	results_dir -> results/afa/mnist_afa
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 64
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 83
	train_dataset_size -> 5000
	test_dataset_size -> 1024
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/04/27 at 00:35:59
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2116331 ]
[Number of non-trainable parameters in model 2 ]
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8334444444444443
      test_c_accuracy          0.9298888888888889
        test_c_auc             0.8523313883594865
         test_c_f1              0.852739053653331
     test_concept_loss         5.6754584312438965
    test_current_steps         1924.3199462890625
    test_horizon_limit          9.019448280334473
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss             5.6754584312438965
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                 0.737
        test_y_auc             0.8411884735090976
         test_y_f1              0.709276362063934
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
val_c_acc: 92.99%, val_y_acc: 73.70%, val_c_auc: 85.23%, val_y_auc: 84.12% with 22 epochs in 478.88 seconds
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.027 MB uploadedwandb: | 0.014 MB of 0.033 MB uploadedwandb: / 0.014 MB of 0.033 MB uploadedwandb: - 0.033 MB of 0.033 MB uploadedwandb:                                                                                
wandb: 
wandb: Run history:
wandb:                 avg_c_y_acc ▂▁▂▁▂▃▄▅▆▅▆▅▅▅▆▅▅▆▇▇▆█▇██▇▇██▇███▇
wandb:                  c_accuracy ▁▁▁▁▂▃▃▄▄▄▅▅▅▅▅▅▆▆▆▇▆▇▇▇▇▇▇▇▇▇████
wandb:                       c_auc ▁▁▁▁▂▃▄▄▅▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇▇▇▇███████
wandb:                        c_f1 ▁▁▁▂▂▃▄▅▅▆▆▆▆▇▇▆▇▇▇▇▇▇▇███████████
wandb:                concept_loss ██▇▇▆▅▄▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁
wandb:               current_steps ▁▁▁▂▂▂▂▂▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▇▇▇▇▇███
wandb:                       epoch ▁▁▁▁▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇███
wandb:               horizon_limit ▁▂▃▄▆█████████████████████████████
wandb:           intervention_loss ██▆▆▆▆▇▅▆▃▄▃▇▆▂▄▆▁▃▄▂▁▄▂▃▂▃▄▄▁▃▄▄▄
wandb:      intervention_task_loss ████▇▇▆▅▄▄▄▅▅▅▄▅▅▄▃▂▃▂▂▂▂▂▂▂▂▃▁▂▁▃
wandb:                        loss ██▇▇▆▅▅▄▄▃▃▃▃▃▂▂▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁
wandb:               mask_accuracy ▁▁▃▃▄▄▂▄▃▇▅▇▃▃█▅▃█▆▅▇▇▆▄▅▅▆▅▆▇▆▅▄▅
wandb:                   task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:            test_avg_c_y_acc ▁█
wandb:             test_c_accuracy █▁
wandb:                  test_c_auc ▁█
wandb:                   test_c_f1 ▁█
wandb:           test_concept_loss █▁
wandb:          test_current_steps ▁█
wandb:          test_horizon_limit ▁▁
wandb:      test_intervention_loss ▁▁
wandb: test_intervention_task_loss ▁▁
wandb:                   test_loss █▁
wandb:          test_mask_accuracy ▁▁
wandb:              test_task_loss ▁▁
wandb:             test_y_accuracy ▁█
wandb:                  test_y_auc ▁█
wandb:                   test_y_f1 █▁
wandb:         trainer/global_step ▁▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇████
wandb:             val_avg_c_y_acc ▁▆▅▇█▇▇▇█▆█
wandb:              val_c_accuracy ▁▃▅▆▇▇▇████
wandb:                   val_c_auc ▁▃▅▇▇▇█████
wandb:                    val_c_f1 ▁▄▆▇▇██████
wandb:            val_concept_loss █▅▃▂▁▁▁▁▂▂▂
wandb:           val_current_steps ▁▂▂▃▄▄▅▆▇▇█
wandb:           val_horizon_limit ▁██████████
wandb:       val_intervention_loss ▁▁▁▁▁▁▁▁▁▁▁
wandb:  val_intervention_task_loss ▁▁▁▁▁▁▁▁▁▁▁
wandb:                    val_loss █▅▃▂▁▁▁▁▂▂▂
wandb:           val_mask_accuracy ▁▁▁▁▁▁▁▁▁▁▁
wandb:               val_task_loss ▁▁▁▁▁▁▁▁▁▁▁
wandb:              val_y_accuracy ▁▆▆▇██▇▇█▆█
wandb:                   val_y_auc ▁▅▇█████▇▇▇
wandb:                    val_y_f1 ▁▇▆▇██▇▇█▆█
wandb:                  y_accuracy ▂▁▃▁▃▃▅▆▆▆▆▆▆▅▆▅▄▆▇▇▆█▇██▇▇██▆███▇
wandb:                       y_auc ▃▄▃▁▅▄▆▆█▇▇▆▆▆▇▆▆▆▇█▇█████▇██▇████
wandb:                        y_f1 ▁▁▁▂▄▅▆▇▇▆▇▇▇▆▇▆▆▇█▇▇█▇██████▇████
wandb: 
wandb: Run summary:
wandb:                 avg_c_y_acc 0.92694
wandb:                  c_accuracy 0.96325
wandb:                       c_auc 0.92821
wandb:                        c_f1 0.92829
wandb:                concept_loss 1.59845
wandb:               current_steps 1862.0
wandb:                       epoch 22
wandb:               horizon_limit 9.01945
wandb:           intervention_loss 1.80208
wandb:      intervention_task_loss 0.25828
wandb:                        loss 3.65881
wandb:               mask_accuracy 0.30859
wandb:                   task_loss 0.0
wandb:            test_avg_c_y_acc 0.83807
wandb:             test_c_accuracy 0.92907
wandb:                  test_c_auc 0.85527
wandb:                   test_c_f1 0.85451
wandb:           test_concept_loss 5.66607
wandb:          test_current_steps 1940.5
wandb:          test_horizon_limit 9.01945
wandb:      test_intervention_loss 0.0
wandb: test_intervention_task_loss 0.0
wandb:                   test_loss 5.66607
wandb:          test_mask_accuracy -1.0
wandb:              test_task_loss 0.0
wandb:             test_y_accuracy 0.74707
wandb:                  test_y_auc 0.85361
wandb:                   test_y_f1 0.7066
wandb:         trainer/global_step 1738
wandb:             val_avg_c_y_acc 0.83344
wandb:              val_c_accuracy 0.92989
wandb:                   val_c_auc 0.85233
wandb:                    val_c_f1 0.85274
wandb:            val_concept_loss 5.67546
wandb:           val_current_steps 1908.31995
wandb:           val_horizon_limit 9.01945
wandb:       val_intervention_loss 0.0
wandb:  val_intervention_task_loss 0.0
wandb:                    val_loss 5.67546
wandb:           val_mask_accuracy -1.0
wandb:               val_task_loss 0.0
wandb:              val_y_accuracy 0.737
wandb:                   val_y_auc 0.84119
wandb:                    val_y_f1 0.70928
wandb:                  y_accuracy 0.89062
wandb:                       y_auc 0.99706
wandb:                        y_f1 0.89552
wandb: 
wandb: 🚀 View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1 at: https://wandb.ai/thomasyuan/afa/runs/fq4l734y
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/afa
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240427_003704-fq4l734y/logs
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
DEBUG:root:Restarting run because we could not find test_acc_y_intcem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
[rank: 0] Global seed set to 42
DEBUG:root:Loading trained model from results/afa/mnist_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1.pt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'abc.ABCMeta'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 0 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 85.48% (accuracy is 76.07%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 0 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 87.87% (accuracy is 78.32%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 0 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 88.94% (accuracy is 79.98%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 0 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 89.26% (accuracy is 81.05%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 0 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 89.86% (accuracy is 82.03%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 0 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 90.26% (accuracy is 82.13%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 0 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 91.12% (accuracy is 82.23%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 0 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 91.90% (accuracy is 82.32%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 0 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 93.39% (accuracy is 83.59%).
DEBUG:root:	Average intervention took 0.00056 seconds and construction took 0.00008 seconds.
	In total interventions took 5.20582 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 85.48% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 87.87% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 88.94% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 89.26% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 89.86% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 90.26% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 91.12% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 91.90% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 93.39% (avg int time is 0.00056s and construction time is 0.00008s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
[rank: 0] Global seed set to 42
DEBUG:root:Loading trained model from results/afa/mnist_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1.pt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'abc.ABCMeta'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 0 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 85.48% (accuracy is 76.07%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 0 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 95.10% (accuracy is 86.33%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 0 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 97.25% (accuracy is 89.65%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 0 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 97.91% (accuracy is 90.62%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 0 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 98.12% (accuracy is 91.41%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 0 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 98.14% (accuracy is 91.41%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 0 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 97.90% (accuracy is 90.72%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 0 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 97.00% (accuracy is 89.16%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 0 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 93.39% (accuracy is 83.59%).
DEBUG:root:	Average intervention took 0.00060 seconds and construction took 0.00005 seconds.
	In total interventions took 5.56258 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 85.48% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 95.10% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 97.25% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 97.91% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 98.12% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 98.14% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 97.90% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 97.00% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 93.39% (avg int time is 0.00060s and construction time is 0.00005s).
DEBUG:root:	Results for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in split 0:
DEBUG:root:		test_acc_y -> 0.7470703125
DEBUG:root:		test_auc_y -> 0.8536080712411097
DEBUG:root:		test_f1_y -> 0.7066045991817775
DEBUG:root:		test_acc_c -> 0.9290726273148148
DEBUG:root:		test_auc_c -> 0.8552653575336491
DEBUG:root:		test_f1_c -> 0.8545068756527969
DEBUG:root:		training_epochs -> 22
DEBUG:root:		training_time -> 478.88453221321106
DEBUG:root:		num_trainable_params -> 0
DEBUG:root:		num_non_trainable_params -> 2116333
DEBUG:root:		test_acc_y_intcem_policy_ints -> [0.8548103022174971, 0.8787293990427408, 0.8894390570264175, 0.8925531910208464, 0.8985506783065824, 0.9025525456355492, 0.9112290231189766, 0.9189592319066633, 0.9339252376405869]
DEBUG:root:		avg_int_time_intcem_policy_ints -> 0.0005648678116914299
DEBUG:root:		construction_time_intcem_policy_ints -> 7.939338684082031e-05
DEBUG:root:		test_acc_y_optimal_greedy_no_prior_ints -> [0.8548103022174971, 0.9510422831197556, 0.9724918667895823, 0.9790846391001669, 0.9812167005668883, 0.9814457952334842, 0.9790391760416951, 0.970002552838966, 0.9339252376405869]
DEBUG:root:		avg_int_time_optimal_greedy_no_prior_ints -> 0.0006035783638556799
DEBUG:root:		construction_time_optimal_greedy_no_prior_ints -> 5.173683166503906e-05
DEBUG:root:	Trial 1 COMPLETED for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 ending at 27/04/2024 at 00:45:48 (9.6442 minutes):	Time Breakdown:		Initialization: 0.9112 minutes		Training: 8.2561 minutes		Test Interventions: 0.4767 minutes		Evaluate Representation Metric: 0.0002 minutes
DEBUG:root:		Done with trial 1
DEBUG:root:		Done with trial 1
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8380714699074073
      test_c_accuracy          0.9290726273148148
        test_c_auc             0.8552653575336491
         test_c_f1             0.8545068756527969
     test_concept_loss          5.666073799133301
    test_current_steps               1940.5
    test_horizon_limit          9.019448280334473
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss              5.666073799133301
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy             0.7470703125
        test_y_auc             0.8536080712411097
         test_y_f1             0.7066045991817775
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
c_acc: 92.91%, y_acc: 74.71%, c_auc: 85.53%, y_auc: 85.36% with 22 epochs in 478.88 seconds
********** Results in between trial 1 **********
	 ******************************
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
|                                                                    Method                                                                   |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   | 25% Int Acc | 50% Int Acc | 75% Int Acc | 100% Int Acc |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 | 0.7471 ± 0.0000 | 0.8536 ± 0.0000 | 0.9291 ± 0.0000  | 0.8553 ± 0.0000 |     N/A     |     N/A     |     N/A     |     N/A      |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+



********** Results after trial 1 **********
	 ******************************
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
|                                                                    Method                                                                   |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   | 25% Int Acc | 50% Int Acc | 75% Int Acc | 100% Int Acc |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 | 0.7471 ± 0.0000 | 0.8536 ± 0.0000 | 0.9291 ± 0.0000  | 0.8553 ± 0.0000 |     N/A     |     N/A     |     N/A     |     N/A      |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+



INFO:root:Results will be dumped in results/mnist_intcem
DEBUG:root:And the dataset's root directory is /home/xty20/data
[rank: 0] Global seed set to 42
DEBUG:root:		Updated concept group map (with 8 groups):
DEBUG:root:			0 -> [0, 1, 2]
DEBUG:root:			1 -> [3, 4, 5]
DEBUG:root:			2 -> [6, 7, 8]
DEBUG:root:			5 -> [9, 10, 11, 12, 13]
DEBUG:root:			8 -> [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
DEBUG:root:			9 -> [24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
DEBUG:root:			10 -> [34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
DEBUG:root:			11 -> [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]
/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/seed.py:47: LightningDeprecationWarning: `pytorch_lightning.utilities.seed.seed_everything` has been deprecated in v1.8.0 and will be removed in v2.0.0. Please use `lightning_fabric.utilities.seed.seed_everything` instead.
  rank_zero_deprecation(
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "c2y_layers": [
        128,
        128
    ],
    "c_extractor_arch": "Function: c_extractor_arch",
    "check_val_every_n_epoch": 2,
    "dataset": "mnist_add",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "intcem_policy",
        "optimal_greedy_no_prior"
    ],
    "max_epochs": 83,
    "noise_level": 0.0,
    "num_operands": 12,
    "num_workers": 8,
    "results_dir": "results/mnist_intcem",
    "root_dir": "/home/xty20/data",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.625,
    "selected_digits": [
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ]
    ],
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 512,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 100,
            "n_components": 40,
            "num_samples": 10,
            "optimizer": "adam",
            "prior": "autoreg",
            "prior_hids": [
                256,
                256
            ],
            "prior_layers": 2,
            "prior_units": 256,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "save_path": "/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt",
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "TL",
                "AF"
            ]
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": false,
            "ent_coef": 0.0,
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "bool": false,
        "c_extractor_arch": "resnet18",
        "cbm_aneal_rate": 0.99999,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_loss",
        "emb_size": 16,
        "extra_dims": 0,
        "learning_rate": 0.001,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "sgd",
        "patience": 5,
        "save_model": true,
        "separate_ac_model_training": false,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_afa_model": false,
        "training_intervention_prob": 0.25,
        "weight_decay": 4e-06
    },
    "skip_repr_evaluation": true,
    "test_subsampling": 1,
    "threshold_labels": 30,
    "train_dataset_size": 5000,
    "trials": 1,
    "use_task_class_weights": true,
    "weight_loss": true
}
INFO:root:Training sample shape is: torch.Size([64, 12, 28, 28]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.FloatTensor
INFO:root:	Number of output classes: 1
INFO:root:Training concept shape is: torch.Size([64, 54]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 54
INFO:root:Computing task class weights in the training dataset with size 79...
INFO:root:Setting log level to: "DEBUG"
[rank: 0] Global seed set to 42
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240427_210013-0xu8b2q6
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/0xu8b2q6
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
Class distribution is: [0.4808 0.5192]
[TRIAL 1/1 BEGINS AT 27/04/2024 at 21:00:12
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.001
	weight_decay -> 4e-06
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7f0efca76a60>
	optimizer -> sgd
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	separate_ac_model_training -> False
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	ac_model_config -> {'save_path': '/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 1
	results_dir -> results/mnist_intcem
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 64
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 83
	train_dataset_size -> 5000
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/04/27 at 20:59:55
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2116331 ]
[Number of non-trainable parameters in model 2 ]
	Found cached model... loading it
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8286944444444446
      test_c_accuracy          0.9293888888888889
        test_c_auc             0.8539603235728352
         test_c_f1             0.8530831897742592
     test_concept_loss          5.708014965057373
    test_current_steps         1924.3199462890625
    test_horizon_limit          9.019448280334473
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss              5.708014965057373
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                 0.728
        test_y_auc             0.8472416700475005
         test_y_f1             0.7136961712274954
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
val_c_acc: 92.94%, val_y_acc: 72.80%, val_c_auc: 85.40%, val_y_auc: 84.72% with 22.0 epochs in 478.88 seconds
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.014 MB uploadedwandb: / 0.039 MB of 0.052 MB uploaded (0.007 MB deduped)wandb: - 0.039 MB of 0.052 MB uploaded (0.007 MB deduped)wandb: \ 0.056 MB of 0.056 MB uploaded (0.007 MB deduped)wandb:                                                                                
wandb: W&B sync reduced upload amount by 12.4%             
wandb: 🚀 View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1 at: https://wandb.ai/thomasyuan/afa/runs/0xu8b2q6
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/afa
wandb: Synced 5 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240427_210013-0xu8b2q6/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
DEBUG:root:Restarting run because we could not find test_acc_y_intcem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
[rank: 0] Global seed set to 42
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1.pt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'abc.ABCMeta'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 0 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 85.08% (accuracy is 75.34%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 0 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 87.65% (accuracy is 78.25%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 0 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 88.85% (accuracy is 79.76%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 0 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 89.44% (accuracy is 80.56%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 0 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 89.78% (accuracy is 80.99%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 0 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 90.17% (accuracy is 81.34%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 0 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 90.70% (accuracy is 81.59%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 0 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 91.57% (accuracy is 82.24%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 0 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 92.87% (accuracy is 83.01%).
DEBUG:root:	Average intervention took 0.00026 seconds and construction took 0.00008 seconds.
	In total interventions took 23.42995 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 85.08% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 87.65% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 88.85% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 89.44% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 89.78% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 90.17% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 90.70% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 91.57% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 92.87% (avg int time is 0.00026s and construction time is 0.00008s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in old results.
[rank: 0] Global seed set to 42
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_lambda_fold_1.pt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'abc.ABCMeta'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 0 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 85.08% (accuracy is 75.34%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 0 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 94.62% (accuracy is 85.44%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 0 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 96.84% (accuracy is 88.83%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 0 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 97.51% (accuracy is 90.02%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 0 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 97.71% (accuracy is 90.37%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 0 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 97.70% (accuracy is 90.37%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 0 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 97.48% (accuracy is 89.83%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 0 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 96.69% (accuracy is 88.33%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 0 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 92.87% (accuracy is 83.01%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00006 seconds.
	In total interventions took 22.11394 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 85.08% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 94.62% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 96.84% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 97.51% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 97.71% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 97.70% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 97.48% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 96.69% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 92.87% (avg int time is 0.00025s and construction time is 0.00006s).
DEBUG:root:	Results for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 in split 0:
DEBUG:root:		test_acc_y -> 0.7448
DEBUG:root:		test_auc_y -> 0.850470461875751
DEBUG:root:		test_f1_y -> 0.703361672473462
DEBUG:root:		test_acc_c -> 0.9294018518518519
DEBUG:root:		test_auc_c -> 0.8556231023271297
DEBUG:root:		test_f1_c -> 0.8543310507785127
DEBUG:root:		training_epochs -> 22.0
DEBUG:root:		training_time -> 478.88453221321106
DEBUG:root:		num_trainable_params -> 0
DEBUG:root:		num_non_trainable_params -> 2116333
DEBUG:root:		test_acc_y_intcem_policy_ints -> [0.8508472739571549, 0.8764679314517991, 0.8884712403865653, 0.8943792336087029, 0.8977740392886748, 0.901699775005727, 0.9070250533923269, 0.9157002514522603, 0.9286860573878003]
DEBUG:root:		avg_int_time_intcem_policy_ints -> 0.0002603327910105388
DEBUG:root:		construction_time_intcem_policy_ints -> 8.368492126464844e-05
DEBUG:root:		test_acc_y_optimal_greedy_no_prior_ints -> [0.8508472739571549, 0.9461860271315998, 0.9684223706181532, 0.9751245124167918, 0.977101144784943, 0.977040817284695, 0.9747605893212982, 0.9668970791136382, 0.9286860573878003]
DEBUG:root:		avg_int_time_optimal_greedy_no_prior_ints -> 0.00024571044974856907
DEBUG:root:		construction_time_optimal_greedy_no_prior_ints -> 6.031990051269531e-05
DEBUG:root:	Trial 1 COMPLETED for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 ending at 27/04/2024 at 21:03:24 (3.2125 minutes):	Time Breakdown:		Initialization: 0.0000 minutes		Training: 0.7047 minutes		Test Interventions: 2.5077 minutes		Evaluate Representation Metric: 0.0001 minutes
DEBUG:root:		Done with trial 1
DEBUG:root:		Done with trial 1
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8371009259259256
      test_c_accuracy          0.9294018518518519
        test_c_auc             0.8556231023271297
         test_c_f1             0.8543310507785127
     test_concept_loss          5.570677280426025
    test_current_steps         2010.6256103515625
    test_horizon_limit          9.019444465637207
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss              5.570677280426025
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                0.7448
        test_y_auc              0.850470461875751
         test_y_f1              0.703361672473462
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
c_acc: 92.94%, y_acc: 74.48%, c_auc: 85.56%, y_auc: 85.05% with 22.0 epochs in 478.88 seconds
********** Results in between trial 1 **********
	 ******************************
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
|                                                                    Method                                                                   |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   | 25% Int Acc | 50% Int Acc | 75% Int Acc | 100% Int Acc |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 | 0.7448 ± 0.0000 | 0.8505 ± 0.0000 | 0.9294 ± 0.0000  | 0.8556 ± 0.0000 |     N/A     |     N/A     |     N/A     |     N/A      |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+



********** Results after trial 1 **********
	 ******************************
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
|                                                                    Method                                                                   |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   | 25% Int Acc | 50% Int Acc | 75% Int Acc | 100% Int Acc |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1 | 0.7448 ± 0.0000 | 0.8505 ± 0.0000 | 0.9294 ± 0.0000  | 0.8556 ± 0.0000 |     N/A     |     N/A     |     N/A     |     N/A      |
+---------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+



Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 10, in <module>
    import torch
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torch/__init__.py", line 235, in <module>
    from torch._C import *  # noqa: F403
KeyboardInterrupt
INFO:root:Results will be dumped in results/mnist_intcem
DEBUG:root:And the dataset's root directory is /home/xty20/data
[rank: 0] Global seed set to 42
DEBUG:root:		Updated concept group map (with 8 groups):
DEBUG:root:			0 -> [0, 1, 2]
DEBUG:root:			1 -> [3, 4, 5]
DEBUG:root:			2 -> [6, 7, 8]
DEBUG:root:			5 -> [9, 10, 11, 12, 13]
DEBUG:root:			8 -> [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
DEBUG:root:			9 -> [24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
DEBUG:root:			10 -> [34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
DEBUG:root:			11 -> [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]
/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/seed.py:47: LightningDeprecationWarning: `pytorch_lightning.utilities.seed.seed_everything` has been deprecated in v1.8.0 and will be removed in v2.0.0. Please use `lightning_fabric.utilities.seed.seed_everything` instead.
  rank_zero_deprecation(
[rank: 0] Global seed set to 42
{
    "batch_size": 512,
    "c2y_layers": [
        128,
        128
    ],
    "c_extractor_arch": "Function: c_extractor_arch",
    "check_val_every_n_epoch": 2,
    "dataset": "mnist_add",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "intcem_policy",
        "optimal_greedy_no_prior"
    ],
    "max_epochs": 300,
    "noise_level": 0.0,
    "num_operands": 12,
    "num_workers": 8,
    "results_dir": "results/mnist_intcem",
    "root_dir": "/home/xty20/data",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                512,
                512,
                256,
                256
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.625,
    "selected_digits": [
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ]
    ],
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 512,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 100,
            "n_components": 40,
            "num_samples": 10,
            "optimizer": "adam",
            "prior": "autoreg",
            "prior_hids": [
                256,
                256
            ],
            "prior_layers": 2,
            "prior_units": 256,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "save_path": "/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt",
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "TL",
                "AF"
            ]
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": false,
            "ent_coef": 0.0,
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "bool": false,
        "c_extractor_arch": "resnet18",
        "cbm_aneal_rate": 0.99999,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_loss",
        "emb_size": 16,
        "enable_checkpointing": true,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_ac_model": false,
        "train_afa_model": false,
        "training_intervention_prob": 0.25,
        "weight_decay": 0.001
    },
    "skip_repr_evaluation": true,
    "test_subsampling": 1,
    "threshold_labels": 30,
    "train_dataset_size": 10000,
    "trials": 3,
    "use_task_class_weights": true,
    "weight_loss": true
}
INFO:root:Training sample shape is: torch.Size([512, 12, 28, 28]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([512]) with type torch.FloatTensor
INFO:root:	Number of output classes: 1
INFO:root:Training concept shape is: torch.Size([512, 54]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 54
INFO:root:Computing task class weights in the training dataset with size 20...
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/mnist_intcem/acflow_sampling_0.625_model_trial_0.pt
[rank: 0] Global seed set to 42
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240508_224313-ry43cat5
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/ry43cat5
Class distribution is: [0.4847 0.5153]
[TRIAL 1/3 BEGINS AT 08/05/2024 at 22:43:11
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7fa8bc446af0>
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> False
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'save_path': 'results/mnist_intcem/acflow_sampling_0.625_model_trial_0.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 3
	results_dir -> results/mnist_intcem
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 512
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 300
	train_dataset_size -> 10000
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/05/08 at 22:42:51
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [512, 512, 256, 256]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2903915 ]
[Number of non-trainable parameters in model 2 ]
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting test results without interventions
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.6569259259259259
      test_c_accuracy          0.8518518518518517
        test_c_auc                     0.5
         test_c_f1             0.45863519824378374
     test_concept_loss         12.419517517089844
    test_current_steps         112.46399688720703
    test_horizon_limit           3.2933349609375
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss             12.419517517089844
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                 0.462
        test_y_auc             0.6088138054597981
         test_y_f1                     0.0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
val_c_acc: 85.19%, val_y_acc: 46.20%, val_c_auc: 50.00%, val_y_auc: 60.88% with 5 epochs in 53.21 seconds
Traceback (most recent call last):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 435, in train_model
    values, _ = utils.load_call(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 90, in load_call
    return function(**kwargs), False
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 397, in _inner_call
    [test_results] = trainer.test(model, test_dl)
TypeError: cannot unpack non-iterable NoneType object
wandb: ERROR Control-C detected -- Run data was not synced
INFO:root:Results will be dumped in results/mnist_intcem_copy
DEBUG:root:And the dataset's root directory is /home/xty20/data
[rank: 0] Global seed set to 42
DEBUG:root:		Updated concept group map (with 8 groups):
DEBUG:root:			0 -> [0, 1, 2]
DEBUG:root:			1 -> [3, 4, 5]
DEBUG:root:			2 -> [6, 7, 8]
DEBUG:root:			5 -> [9, 10, 11, 12, 13]
DEBUG:root:			8 -> [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
DEBUG:root:			9 -> [24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
DEBUG:root:			10 -> [34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
DEBUG:root:			11 -> [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]
/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/seed.py:47: LightningDeprecationWarning: `pytorch_lightning.utilities.seed.seed_everything` has been deprecated in v1.8.0 and will be removed in v2.0.0. Please use `lightning_fabric.utilities.seed.seed_everything` instead.
  rank_zero_deprecation(
[rank: 0] Global seed set to 42
{
    "batch_size": 512,
    "c2y_layers": [
        128,
        128
    ],
    "c_extractor_arch": "Function: c_extractor_arch",
    "check_val_every_n_epoch": 2,
    "dataset": "mnist_add",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "intcem_policy",
        "optimal_greedy_no_prior"
    ],
    "max_epochs": 300,
    "noise_level": 0.0,
    "num_operands": 12,
    "num_workers": 8,
    "results_dir": "results/mnist_intcem_copy",
    "root_dir": "/home/xty20/data",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                512,
                512,
                256,
                256
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.625,
    "selected_digits": [
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ]
    ],
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 512,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 100,
            "n_components": 40,
            "num_samples": 10,
            "optimizer": "adam",
            "prior": "autoreg",
            "prior_hids": [
                256,
                256
            ],
            "prior_layers": 2,
            "prior_units": 256,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "save_path": "/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt",
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "TL",
                "AF"
            ]
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": false,
            "ent_coef": 0.0,
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "bool": false,
        "c_extractor_arch": "resnet18",
        "cbm_aneal_rate": 0.99999,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_loss",
        "emb_size": 16,
        "enable_checkpointing": true,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "top_k_accuracy": null,
        "train_ac_model": false,
        "train_afa_model": false,
        "training_intervention_prob": 0.25,
        "weight_decay": 0.001
    },
    "skip_repr_evaluation": true,
    "test_subsampling": 1,
    "threshold_labels": 30,
    "train_dataset_size": 10000,
    "trials": 3,
    "use_task_class_weights": true,
    "weight_loss": true
}
INFO:root:Training sample shape is: torch.Size([512, 12, 28, 28]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([512]) with type torch.FloatTensor
INFO:root:	Number of output classes: 1
INFO:root:Training concept shape is: torch.Size([512, 54]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 54
INFO:root:Computing task class weights in the training dataset with size 20...
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/mnist_intcem_copy/acflow_sampling_0.625_model_trial_0.pt
[rank: 0] Global seed set to 42
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240508_224520-9yy50vto
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/9yy50vto
Class distribution is: [0.4847 0.5153]
[TRIAL 1/3 BEGINS AT 08/05/2024 at 22:45:19
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7fbaf1378af0>
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> False
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'save_path': 'results/mnist_intcem_copy/acflow_sampling_0.625_model_trial_0.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 3
	results_dir -> results/mnist_intcem_copy
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 512
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 300
	train_dataset_size -> 10000
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/05/08 at 22:44:59
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [512, 512, 256, 256]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2903915 ]
[Number of non-trainable parameters in model 2 ]
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting test results without interventions
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8821805555555556
      test_c_accuracy           0.957861111111111
        test_c_auc             0.8964618914620084
         test_c_f1             0.9082852035401664
     test_concept_loss         3.6389577388763428
    test_current_steps         1764.4639892578125
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss             3.6389577388763428
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                0.8065
        test_y_auc             0.8898944399433798
         test_y_f1             0.8258307306759642
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
val_c_acc: 95.79%, val_y_acc: 80.65%, val_c_auc: 89.65%, val_y_auc: 88.99% with 80 epochs in 1122.89 seconds
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.014 MB uploadedwandb: / 0.043 MB of 0.069 MB uploaded (0.007 MB deduped)wandb: - 0.043 MB of 0.069 MB uploaded (0.007 MB deduped)wandb: \ 0.071 MB of 0.071 MB uploaded (0.007 MB deduped)wandb:                                                                                
wandb: W&B sync reduced upload amount by 9.9%             
wandb: 
wandb: Run history:
wandb:                 avg_c_y_acc ▁▁▃▅▅▄▄▅▅▅▆▆▆▆▆▇▆▇▆▇▇█▇▇▇█▇███▇█
wandb:                  c_accuracy ▁▁▁▁▂▂▃▄▄▅▄▅▅▆▅▆▆▆▆▇▇▇▇▇▇█▇█▇█▇█
wandb:                       c_auc ▁▁▁▁▂▃▄▄▅▅▅▆▆▆▆▇▇▇▇▇▇▇▇█▇█▇█████
wandb:                        c_f1 ▁▁▁▂▂▃▄▅▅▆▆▆▆▇▇▇▇▇▇▇▇█▇█▇███████
wandb:                concept_loss ██▇▇▆▅▅▄▄▃▃▃▃▂▃▂▂▂▂▂▂▂▂▁▂▁▂▁▁▁▁▁
wandb:               current_steps ▁▁▁▂▂▂▂▃▃▃▃▃▄▄▄▄▅▅▅▅▆▆▆▆▆▇▇▇▇███
wandb:                       epoch ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇████
wandb:               horizon_limit ▁▂▃▄▆███████████████████████████
wandb:           intervention_loss █▆▆▇▅▅▅▄▅▄▄▂▃▂▃▃▃▁▄▃▂▃▂▁▄▂▃▄▃▂▂▁
wandb:      intervention_task_loss ██▇▅▅▅▅▅▅▄▄▄▄▄▄▃▄▃▃▂▃▂▂▃▂▁▂▁▁▁▁▁
wandb:                        loss ██▇▇▆▅▅▄▄▃▃▃▃▂▃▂▂▂▂▂▂▂▂▁▂▁▂▁▂▁▁▁
wandb:               mask_accuracy ▁▄▄▂▅▄▄▅▄▅▆▆▆▆▅▆▆▇▆▆▆▆▇█▅▇▆▅▆▆▇▇
wandb:                   task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:            test_avg_c_y_acc █▁
wandb:             test_c_accuracy ▁█
wandb:                  test_c_auc ▁█
wandb:                   test_c_f1 ▁█
wandb:           test_concept_loss █▁
wandb:          test_current_steps ▁█
wandb:          test_horizon_limit ▁▁
wandb:      test_intervention_loss ▁▁
wandb: test_intervention_task_loss ▁▁
wandb:                   test_loss █▁
wandb:          test_mask_accuracy ▁▁
wandb:              test_task_loss ▁▁
wandb:             test_y_accuracy █▁
wandb:                  test_y_auc █▁
wandb:                   test_y_f1 █▁
wandb:         trainer/global_step ▁▁▁▁▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇████
wandb:             val_avg_c_y_acc ▁▁▂▄▄▄▅▅▅▆▆▆▇▇▇▇▇▇▇█▇██▇████████████████
wandb:              val_c_accuracy ▁▁▁▁▁▂▂▃▃▄▄▅▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇█████████████
wandb:                   val_c_auc ▁▁▁▁▁▂▃▃▄▅▅▆▆▆▆▇▇▇▇▇▇▇▇▇████████████████
wandb:                    val_c_f1 ▁▁▁▁▂▂▃▄▅▅▆▆▆▇▇▇▇▇▇▇▇███████████████████
wandb:            val_concept_loss █▇▇▇▆▅▅▄▄▃▃▃▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_current_steps ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇▇███
wandb:           val_horizon_limit ▁▂▂▃▄▅▇█████████████████████████████████
wandb:       val_intervention_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:  val_intervention_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:                    val_loss █▇▇▇▆▅▅▄▄▃▃▃▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_mask_accuracy ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:               val_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:              val_y_accuracy ▁▁▂▅▄▅▅▅▆▆▆▇▇▇▇▇▇▇██████████████████████
wandb:                   val_y_auc ▁▂▃▄▅▆▆▆▇▇▇▇▇▇██████████████████████████
wandb:                    val_y_f1 ▁▁▃▇▆▆▆▆▇▇▇▇▇█▇█████████████████████████
wandb:                  y_accuracy ▁▁▄▅▅▅▅▅▅▆▆▆▆▆▆▇▆▇▆▇▇█▇▇▇█▇███▇█
wandb:                       y_auc ▅▁▄▆▆▅▅▆▆▆▆▇▆▇▇▇▇▇▇█████████████
wandb:                        y_f1 ▁▁▅▇▇▆▆▇▇▇▇▇▇▇▇▇▇▇▇█▇███████████
wandb: 
wandb: Run summary:
wandb:                 avg_c_y_acc 0.99622
wandb:                  c_accuracy 0.99244
wandb:                       c_auc 0.98562
wandb:                        c_f1 0.98892
wandb:                concept_loss 0.84851
wandb:               current_steps 1758.0
wandb:                       epoch 80
wandb:               horizon_limit 9.01945
wandb:           intervention_loss 0.95499
wandb:      intervention_task_loss 0.02504
wandb:                        loss 1.82854
wandb:               mask_accuracy 0.67647
wandb:                   task_loss 0.0
wandb:            test_avg_c_y_acc 0.87803
wandb:             test_c_accuracy 0.95896
wandb:                  test_c_auc 0.90032
wandb:                   test_c_f1 0.91143
wandb:           test_concept_loss 3.52422
wandb:          test_current_steps 1776.27197
wandb:          test_horizon_limit 9.01945
wandb:      test_intervention_loss 0.0
wandb: test_intervention_task_loss 0.0
wandb:                   test_loss 3.52422
wandb:          test_mask_accuracy -1.0
wandb:              test_task_loss 0.0
wandb:             test_y_accuracy 0.7971
wandb:                  test_y_auc 0.88315
wandb:                   test_y_f1 0.80876
wandb:         trainer/global_step 1600
wandb:             val_avg_c_y_acc 0.88218
wandb:              val_c_accuracy 0.95786
wandb:                   val_c_auc 0.89646
wandb:                    val_c_f1 0.90829
wandb:            val_concept_loss 3.63896
wandb:           val_current_steps 1760.46399
wandb:           val_horizon_limit 9.01945
wandb:       val_intervention_loss 0.0
wandb:  val_intervention_task_loss 0.0
wandb:                    val_loss 3.63896
wandb:           val_mask_accuracy -1.0
wandb:               val_task_loss 0.0
wandb:              val_y_accuracy 0.8065
wandb:                   val_y_auc 0.88989
wandb:                    val_y_f1 0.82583
wandb:                  y_accuracy 1.0
wandb:                       y_auc 1.0
wandb:                        y_f1 1.0
wandb: 
wandb: 🚀 View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1 at: https://wandb.ai/thomasyuan/afa/runs/9yy50vto
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/afa
wandb: Synced 5 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240508_224520-9yy50vto/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
DEBUG:root:Restarting run because we could not find test_acc_y_intcem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 42
DEBUG:root:Loading trained model from results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.intcem_policy.IntCemInterventionPolicy'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 0 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 88.51% (accuracy is 79.24%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 0 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 90.60% (accuracy is 82.57%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 0 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 91.24% (accuracy is 83.33%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 0 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 91.52% (accuracy is 83.78%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 0 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 91.71% (accuracy is 83.93%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 0 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 91.96% (accuracy is 84.15%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 0 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 92.36% (accuracy is 84.37%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 0 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 93.04% (accuracy is 84.75%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 0 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.20% (accuracy is 85.49%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00008 seconds.
	In total interventions took 22.38399 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 88.51% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 90.60% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 91.24% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 91.52% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 91.71% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 91.96% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 92.36% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 93.04% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.20% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 42
DEBUG:root:Loading trained model from results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_1.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.optimal.GreedyOptimal'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 0 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 88.51% (accuracy is 79.24%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 0 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 96.37% (accuracy is 88.90%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 0 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 98.01% (accuracy is 91.69%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 0 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 98.47% (accuracy is 92.72%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 0 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 98.59% (accuracy is 93.04%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 0 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 98.56% (accuracy is 92.93%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 0 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 98.34% (accuracy is 92.55%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 0 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 97.65% (accuracy is 91.20%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 0 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.20% (accuracy is 85.49%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00008 seconds.
	In total interventions took 22.80916 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 88.51% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 96.37% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 98.01% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 98.47% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 98.59% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 98.56% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 98.34% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 97.65% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.20% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:	Results for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in split 0:
DEBUG:root:		test_acc_y -> 0.7971
DEBUG:root:		test_auc_y -> 0.8831488045997037
DEBUG:root:		test_f1_y -> 0.8087584038775353
DEBUG:root:		test_acc_c -> 0.9589611111111109
DEBUG:root:		test_auc_c -> 0.9003174013036852
DEBUG:root:		test_f1_c -> 0.9114277416988494
DEBUG:root:		training_epochs -> 80
DEBUG:root:		training_time -> 1122.891351222992
DEBUG:root:		num_trainable_params -> 0
DEBUG:root:		num_non_trainable_params -> 2903917
DEBUG:root:		test_acc_y_intcem_policy_ints -> [0.8850581693643755, 0.9059797174179987, 0.9123884532712025, 0.9152496291534129, 0.9171326232625086, 0.9195929339110408, 0.9235767744700277, 0.930397087505378, 0.9420398232932815]
DEBUG:root:		avg_int_time_intcem_policy_ints -> 0.00024871098730299204
DEBUG:root:		construction_time_intcem_policy_ints -> 8.225440979003906e-05
DEBUG:root:		test_acc_y_optimal_greedy_no_prior_ints -> [0.8850581693643755, 0.9637306599222993, 0.9800830845631131, 0.9846621389711204, 0.9859412456482778, 0.9856118915747122, 0.9834389334379923, 0.9764650066329943, 0.9420398232932815]
DEBUG:root:		avg_int_time_optimal_greedy_no_prior_ints -> 0.0002534351004494561
DEBUG:root:		construction_time_optimal_greedy_no_prior_ints -> 7.748603820800781e-05
DEBUG:root:	Trial 1 COMPLETED for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 ending at 08/05/2024 at 23:06:51 (21.5289 minutes):	Time Breakdown:		Initialization: 0.0000 minutes		Training: 18.9905 minutes		Test Interventions: 2.5382 minutes		Evaluate Representation Metric: 0.0001 minutes
DEBUG:root:		Done with trial 1
DEBUG:root:Setting ac model save path to be results/mnist_intcem_copy/acflow_sampling_0.625_model_trial_1.pt
[rank: 0] Global seed set to 43
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240508_230651-8ee7ujyu
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/8ee7ujyu
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8780305555555556
      test_c_accuracy          0.9589611111111109
        test_c_auc             0.9003174013036852
         test_c_f1             0.9114277416988494
     test_concept_loss         3.5242159366607666
    test_current_steps          1776.27197265625
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss             3.5242159366607666
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                0.7971
        test_y_auc             0.8831488045997037
         test_y_f1             0.8087584038775353
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
c_acc: 95.90%, y_acc: 79.71%, c_auc: 90.03%, y_auc: 88.31% with 80 epochs in 1122.89 seconds
********** Results in between trial 1 **********
	 ******************************
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
|                                                                               Method                                                                               |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   | 25% Int Acc | 50% Int Acc | 75% Int Acc | 100% Int Acc |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 | 0.7971 ± 0.0000 | 0.8831 ± 0.0000 | 0.9590 ± 0.0000  | 0.9003 ± 0.0000 |     N/A     |     N/A     |     N/A     |     N/A      |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+



[TRIAL 2/3 BEGINS AT 08/05/2024 at 23:06:51
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7fbaf1378af0>
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> False
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'save_path': 'results/mnist_intcem_copy/acflow_sampling_0.625_model_trial_1.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 3
	results_dir -> results/mnist_intcem_copy
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 512
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 300
	train_dataset_size -> 10000
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/05/08 at 22:44:59
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [512, 512, 256, 256]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2903915 ]
[Number of non-trainable parameters in model 2 ]
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting test results without interventions
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8777407407407407
      test_c_accuracy          0.9544814814814815
        test_c_auc             0.8882372426995658
         test_c_f1              0.901907314080334
     test_concept_loss          3.77929425239563
    test_current_steps         1676.4639892578125
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss              3.77929425239563
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                 0.801
        test_y_auc              0.881905421547788
         test_y_f1             0.8174361335922097
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
val_c_acc: 95.45%, val_y_acc: 80.10%, val_c_auc: 88.82%, val_y_auc: 88.19% with 76 epochs in 1072.38 seconds
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.027 MB uploadedwandb: | 0.014 MB of 0.027 MB uploadedwandb: / 0.040 MB of 0.040 MB uploadedwandb:                                                                                
wandb: 
wandb: Run history:
wandb:                 avg_c_y_acc ▁▄▃▃▄▄▅▅▅▅▆▆▆▆▆▇▆▇▇▇▇█▇███▆███
wandb:                  c_accuracy ▁▁▁▁▂▂▃▄▄▅▅▅▅▆▆▆▆▇▆▇▇▇▇█▇█▇█▇█
wandb:                       c_auc ▁▁▁▁▂▃▄▄▅▅▅▆▆▇▆▇▇▇▇▇▇█▇█▇█▇███
wandb:                        c_f1 ▁▁▁▂▂▃▄▅▅▆▆▆▆▇▇▇▇▇▇█▇█▇███████
wandb:                concept_loss ██▇▇▆▅▅▄▄▃▃▃▃▂▃▂▂▂▂▂▂▁▂▁▂▁▁▁▁▁
wandb:               current_steps ▁▁▁▂▂▂▂▃▃▃▃▄▄▄▄▅▅▅▅▆▆▆▆▇▇▇▇███
wandb:                       epoch ▁▁▁▂▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇████
wandb:               horizon_limit ▁▂▃▄▆█████████████████████████
wandb:           intervention_loss █▇▆▄▅▅▄▄▅▄▆▄▃▄▅▃▄▃▃▅▂▄▃▄▅▂▃▁▃▃
wandb:      intervention_task_loss █▇▆▆▅▅▅▄▄▄▄▄▄▃▃▃▃▂▃▂▂▁▂▁▂▁▃▁▁▁
wandb:                        loss ██▇▆▆▅▅▄▄▃▃▃▃▃▃▂▂▂▂▂▂▂▂▂▂▁▂▁▁▁
wandb:               mask_accuracy ▁▃▄▅▄▄▆▅▄▅▄▅▆▆▄▆▅▇▆▅▇▆▆▅▄█▆█▆▇
wandb:                   task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:            test_avg_c_y_acc █▁
wandb:             test_c_accuracy █▁
wandb:                  test_c_auc ▁█
wandb:                   test_c_f1 ▁█
wandb:           test_concept_loss █▁
wandb:          test_current_steps ▁█
wandb:          test_horizon_limit ▁▁
wandb:      test_intervention_loss ▁▁
wandb: test_intervention_task_loss ▁▁
wandb:                   test_loss █▁
wandb:          test_mask_accuracy ▁▁
wandb:              test_task_loss ▁▁
wandb:             test_y_accuracy █▁
wandb:                  test_y_auc ▁█
wandb:                   test_y_f1 █▁
wandb:         trainer/global_step ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇████
wandb:             val_avg_c_y_acc ▁▁▃▄▄▅▅▅▆▆▇▆▇▇▇▇▇█████████████████████
wandb:              val_c_accuracy ▁▁▁▁▂▂▂▃▄▄▅▅▅▆▆▆▆▇▇▇▇▇▇▇▇▇████████████
wandb:                   val_c_auc ▁▁▁▁▁▂▃▃▄▅▅▆▆▆▇▇▇▇▇▇▇▇████████████████
wandb:                    val_c_f1 ▁▁▁▁▂▂▃▄▅▆▆▆▇▇▇▇▇▇▇███████████████████
wandb:            val_concept_loss █▇▇▇▆▅▅▄▃▃▃▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_current_steps ▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇███
wandb:           val_horizon_limit ▁▂▂▃▄▅▇███████████████████████████████
wandb:       val_intervention_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:  val_intervention_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:                    val_loss █▇▇▇▆▅▅▄▃▃▃▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_mask_accuracy ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:               val_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:              val_y_accuracy ▁▁▄▄▅▆▆▆▆▇▇▇█████████████████▇████████
wandb:                   val_y_auc ▁▃▃▄▅▆▆▆▇▇▇▇██████████████████████████
wandb:                    val_y_f1 ▁▁▆▆▆▆▆▇▇▇▇▇██████████████████████████
wandb:                  y_accuracy ▁▄▄▄▄▅▅▅▅▆▆▆▆▆▆▇▆▇▇▇▇█▇███▆███
wandb:                       y_auc ▁▅▅▄▄▅▆▆▆▇▇▇▇▇▇▇▇█▇███████████
wandb:                        y_f1 ▁▆▆▆▆▆▇▆▆▇▇▇▇▇▇▇▇█▇███████▇███
wandb: 
wandb: Run summary:
wandb:                 avg_c_y_acc 0.99493
wandb:                  c_accuracy 0.98986
wandb:                       c_auc 0.98252
wandb:                        c_f1 0.98561
wandb:                concept_loss 0.98916
wandb:               current_steps 1650.0
wandb:                       epoch 76
wandb:               horizon_limit 9.01945
wandb:           intervention_loss 1.12128
wandb:      intervention_task_loss 0.0175
wandb:                        loss 2.12794
wandb:               mask_accuracy 0.62316
wandb:                   task_loss 0.0
wandb:            test_avg_c_y_acc 0.87575
wandb:             test_c_accuracy 0.95411
wandb:                  test_c_auc 0.89097
wandb:                   test_c_f1 0.9032
wandb:           test_concept_loss 3.72588
wandb:          test_current_steps 1688.27197
wandb:          test_horizon_limit 9.01945
wandb:      test_intervention_loss 0.0
wandb: test_intervention_task_loss 0.0
wandb:                   test_loss 3.72588
wandb:          test_mask_accuracy -1.0
wandb:              test_task_loss 0.0
wandb:             test_y_accuracy 0.7974
wandb:                  test_y_auc 0.88214
wandb:                   test_y_f1 0.80584
wandb:         trainer/global_step 1520
wandb:             val_avg_c_y_acc 0.87774
wandb:              val_c_accuracy 0.95448
wandb:                   val_c_auc 0.88824
wandb:                    val_c_f1 0.90191
wandb:            val_concept_loss 3.77929
wandb:           val_current_steps 1672.46399
wandb:           val_horizon_limit 9.01945
wandb:       val_intervention_loss 0.0
wandb:  val_intervention_task_loss 0.0
wandb:                    val_loss 3.77929
wandb:           val_mask_accuracy -1.0
wandb:               val_task_loss 0.0
wandb:              val_y_accuracy 0.801
wandb:                   val_y_auc 0.88191
wandb:                    val_y_f1 0.81744
wandb:                  y_accuracy 1.0
wandb:                       y_auc 1.0
wandb:                        y_f1 1.0
wandb: 
wandb: 🚀 View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2 at: https://wandb.ai/thomasyuan/afa/runs/8ee7ujyu
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/afa
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240508_230651-8ee7ujyu/logs
DEBUG:urllib3.connectionpool:Resetting dropped connection: o151352.ingest.sentry.io
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
DEBUG:root:Restarting run because we could not find test_acc_y_intcem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 43
DEBUG:root:Loading trained model from results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.intcem_policy.IntCemInterventionPolicy'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 1 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 88.23% (accuracy is 78.22%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 1 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 90.01% (accuracy is 80.85%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 1 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 90.67% (accuracy is 82.21%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 1 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 90.96% (accuracy is 82.54%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 1 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 91.14% (accuracy is 82.73%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 1 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 91.33% (accuracy is 82.81%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 1 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 91.71% (accuracy is 83.17%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 1 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 92.57% (accuracy is 83.61%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 1 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.32% (accuracy is 84.72%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00007 seconds.
	In total interventions took 22.36434 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 88.23% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 90.01% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 90.67% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 90.96% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 91.14% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 91.33% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 91.71% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 92.57% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.32% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 43
DEBUG:root:Loading trained model from results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.optimal.GreedyOptimal'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 1 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 88.23% (accuracy is 78.22%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 1 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 96.28% (accuracy is 88.02%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 1 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 97.96% (accuracy is 91.19%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 1 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 98.44% (accuracy is 92.28%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 1 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 98.58% (accuracy is 92.68%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 1 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 98.55% (accuracy is 92.59%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 1 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 98.34% (accuracy is 92.16%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 1 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 97.61% (accuracy is 90.57%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 1 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.32% (accuracy is 84.72%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00008 seconds.
	In total interventions took 22.79888 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 88.23% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 96.28% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 97.96% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 98.44% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 98.58% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 98.55% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 98.34% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 97.61% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.32% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:	Results for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in split 1:
DEBUG:root:		test_acc_y -> 0.7974
DEBUG:root:		test_auc_y -> 0.8821392036293179
DEBUG:root:		test_f1_y -> 0.8058418583328572
DEBUG:root:		test_acc_c -> 0.9541074074074075
DEBUG:root:		test_auc_c -> 0.890970095604829
DEBUG:root:		test_f1_c -> 0.9032005472737956
DEBUG:root:		training_epochs -> 76
DEBUG:root:		training_time -> 1072.3799529075623
DEBUG:root:		num_trainable_params -> 0
DEBUG:root:		num_non_trainable_params -> 2903917
DEBUG:root:		test_acc_y_intcem_policy_ints -> [0.8822652269116423, 0.9001468111093877, 0.9067248567287476, 0.909643852443229, 0.9113729101339917, 0.9133452217359057, 0.9171348632962112, 0.9256827422007468, 0.9432425208158156]
DEBUG:root:		avg_int_time_intcem_policy_ints -> 0.0002484926250245836
DEBUG:root:		construction_time_intcem_policy_ints -> 6.723403930664062e-05
DEBUG:root:		test_acc_y_optimal_greedy_no_prior_ints -> [0.8822652269116423, 0.9627523345898417, 0.9795641153568923, 0.9844087917819897, 0.985807526295135, 0.9855367289126232, 0.9833625383083727, 0.9761099259822417, 0.9432425208158156]
DEBUG:root:		avg_int_time_optimal_greedy_no_prior_ints -> 0.0002533209244410197
DEBUG:root:		construction_time_optimal_greedy_no_prior_ints -> 7.700920104980469e-05
DEBUG:root:	Trial 2 COMPLETED for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 ending at 08/05/2024 at 23:27:27 (20.6108 minutes):	Time Breakdown:		Initialization: 0.0000 minutes		Training: 18.0672 minutes		Test Interventions: 2.5435 minutes		Evaluate Representation Metric: 0.0001 minutes
DEBUG:root:		Done with trial 2
DEBUG:root:Setting ac model save path to be results/mnist_intcem_copy/acflow_sampling_0.625_model_trial_2.pt
[rank: 0] Global seed set to 44
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240508_232727-f27tcb47
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/afa
wandb: 🚀 View run at https://wandb.ai/thomasyuan/afa/runs/f27tcb47
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8757537037037036
      test_c_accuracy          0.9541074074074075
        test_c_auc              0.890970095604829
         test_c_f1             0.9032005472737956
     test_concept_loss          3.725881576538086
    test_current_steps          1688.27197265625
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss              3.725881576538086
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                0.7974
        test_y_auc             0.8821392036293179
         test_y_f1             0.8058418583328572
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
c_acc: 95.41%, y_acc: 79.74%, c_auc: 89.10%, y_auc: 88.21% with 76 epochs in 1072.38 seconds
********** Results in between trial 2 **********
	 ******************************
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
|                                                                               Method                                                                               |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   | 25% Int Acc | 50% Int Acc | 75% Int Acc | 100% Int Acc |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 | 0.7973 ± 0.0001 | 0.8826 ± 0.0005 | 0.9565 ± 0.0024  | 0.8956 ± 0.0047 |     N/A     |     N/A     |     N/A     |     N/A      |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-------------+-------------+-------------+--------------+



[TRIAL 3/3 BEGINS AT 08/05/2024 at 23:27:27
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3]
config:
<built-in function localtime>
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7fbaf1378af0>
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> False
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'save_path': 'results/mnist_intcem_copy/acflow_sampling_0.625_model_trial_2.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 3
	results_dir -> results/mnist_intcem_copy
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 512
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 300
	train_dataset_size -> 10000
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/05/08 at 22:44:59
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [512, 512, 256, 256]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2903915 ]
[Number of non-trainable parameters in model 2 ]
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem_copy/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 10, in <module>
    import torch
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/torch/__init__.py", line 235, in <module>
    from torch._C import *  # noqa: F403
KeyboardInterrupt
INFO:root:Results will be dumped in results/mnist_intcem
DEBUG:root:And the dataset's root directory is /home/xty20/data
[rank: 0] Global seed set to 42
DEBUG:root:		Updated concept group map (with 8 groups):
DEBUG:root:			0 -> [0, 1, 2]
DEBUG:root:			1 -> [3, 4, 5]
DEBUG:root:			2 -> [6, 7, 8]
DEBUG:root:			5 -> [9, 10, 11, 12, 13]
DEBUG:root:			8 -> [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
DEBUG:root:			9 -> [24, 25, 26, 27, 28, 29, 30, 31, 32, 33]
DEBUG:root:			10 -> [34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
DEBUG:root:			11 -> [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]
/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/utilities/seed.py:47: LightningDeprecationWarning: `pytorch_lightning.utilities.seed.seed_everything` has been deprecated in v1.8.0 and will be removed in v2.0.0. Please use `lightning_fabric.utilities.seed.seed_everything` instead.
  rank_zero_deprecation(
[rank: 0] Global seed set to 42
{
    "batch_size": 512,
    "c2y_layers": [
        128,
        128
    ],
    "c_extractor_arch": "Function: c_extractor_arch",
    "check_val_every_n_epoch": 2,
    "dataset": "mnist_add",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "intcem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "noise_level": 0.0,
    "num_operands": 12,
    "num_workers": 8,
    "results_dir": "results/mnist_intcem",
    "root_dir": "/home/xty20/data",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 0.625,
    "selected_digits": [
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ],
        [
            0,
            1,
            2,
            3,
            4,
            5,
            6,
            7,
            8,
            9
        ]
    ],
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 512,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "layer_cfg": [
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 100,
            "n_components": 40,
            "num_samples": 10,
            "optimizer": "adam",
            "prior": "autoreg",
            "prior_hids": [
                256,
                256
            ],
            "prior_layers": 2,
            "prior_units": 256,
            "rnncp_layers": 2,
            "rnncp_units": 256,
            "save_path": "/home/xty20/cem/results/afa/mnist_acflow_cem/acflow_model_trial_0.pt",
            "transformations": [
                "AF",
                "TL",
                "TL",
                "TL",
                "TL",
                "AF"
            ]
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": false,
            "ent_coef": 0.0,
            "normalize_advantages": false,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "bool": false,
        "c_extractor_arch": "resnet18",
        "cbm_aneal_rate": 0.99999,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_loss",
        "emb_size": 16,
        "enable_checkpointing": true,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "momentum": 0.9,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "start_split": 1,
        "top_k_accuracy": null,
        "train_ac_model": false,
        "train_afa_model": false,
        "training_intervention_prob": 0.25,
        "weight_decay": 0.001
    },
    "skip_repr_evaluation": true,
    "test_subsampling": 1,
    "threshold_labels": 30,
    "train_dataset_size": 10000,
    "trials": 3,
    "use_task_class_weights": true,
    "weight_loss": true
}
INFO:root:Training sample shape is: torch.Size([512, 12, 28, 28]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([512]) with type torch.FloatTensor
INFO:root:	Number of output classes: 1
INFO:root:Training concept shape is: torch.Size([512, 54]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 54
INFO:root:Computing task class weights in the training dataset with size 20...
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/mnist_intcem/acflow_sampling_0.625_model_trial_1.pt
[rank: 0] Global seed set to 43
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240510_092210-w8j1f5b8
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/intcem_test
wandb: 🚀 View run at https://wandb.ai/thomasyuan/intcem_test/runs/w8j1f5b8
Class distribution is: [0.4847 0.5153]
[TRIAL 2/3 BEGINS AT 10/05/2024 at 09:22:08
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2]
config:
<built-in function localtime>
	start_split -> 1
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7f7f3307baf0>
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> False
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'save_path': 'results/mnist_intcem/acflow_sampling_0.625_model_trial_1.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 3
	results_dir -> results/mnist_intcem
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 512
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 300
	train_dataset_size -> 10000
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/05/10 at 09:21:47
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2116331 ]
[Number of non-trainable parameters in model 2 ]
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting test results without interventions
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8792685185185185
      test_c_accuracy          0.9535370370370371
        test_c_auc             0.8849317657870658
         test_c_f1             0.8994084326559488
     test_concept_loss          3.84906005859375
    test_current_steps         1676.4639892578125
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss              3.84906005859375
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                 0.805
        test_y_auc             0.8823411504584033
         test_y_f1             0.8153966555246841
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
val_c_acc: 95.35%, val_y_acc: 80.50%, val_c_auc: 88.49%, val_y_auc: 88.23% with 76 epochs in 1062.48 seconds
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.014 MB uploadedwandb: / 0.043 MB of 0.057 MB uploadedwandb: - 0.043 MB of 0.057 MB uploadedwandb: \ 0.070 MB of 0.070 MB uploadedwandb:                                                                                
wandb: 
wandb: Run history:
wandb:                 avg_c_y_acc ▁▃▃▃▄▄▅▅▅▅▆▆▆▆▆▇▆▇▇▇▇█▇▇▇███▇▇
wandb:                  c_accuracy ▁▁▁▁▂▂▃▃▄▅▅▅▅▆▆▆▆▇▆▇▇▇▇█▇█▇█▇█
wandb:                       c_auc ▁▁▁▁▂▃▄▄▅▅▅▆▆▇▆▇▇▇▇▇▇▇▇█▇█████
wandb:                        c_f1 ▁▁▁▂▃▄▄▅▅▆▆▇▆▇▇▇▇▇▇█▇█▇███████
wandb:                concept_loss ██▇▇▆▅▅▄▄▃▃▃▃▂▃▂▂▂▂▂▂▁▂▁▂▁▁▁▁▁
wandb:               current_steps ▁▁▁▂▂▂▂▃▃▃▃▄▄▄▄▅▅▅▅▆▆▆▆▇▇▇▇███
wandb:                       epoch ▁▁▁▂▂▂▂▂▂▂▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇████
wandb:               horizon_limit ▁▂▃▄▆█████████████████████████
wandb:           intervention_loss █▇▆▅▅▅▅▃▄▄▆▃▃▄▅▃▅▃▂▅▂▄▄▃▅▃▃▁▃▂
wandb:      intervention_task_loss █▇▆▆▆▅▅▅▄▄▄▄▄▃▃▃▃▂▃▂▂▁▂▁▂▁▁▁▂▂
wandb:                        loss ██▇▆▆▅▅▄▄▃▃▃▃▃▃▂▂▂▂▂▂▂▂▁▂▁▂▁▁▁
wandb:               mask_accuracy ▁▃▃▅▅▅▅▆▅▆▃▆▆▅▄▆▄▇▆▅▇▅▅▅▅▆▆█▆▆
wandb:                   task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:            test_avg_c_y_acc █▁
wandb:             test_c_accuracy ▁█
wandb:                  test_c_auc ▁█
wandb:                   test_c_f1 ▁█
wandb:           test_concept_loss █▁
wandb:          test_current_steps ▁█
wandb:          test_horizon_limit ▁▁
wandb:      test_intervention_loss ▁▁
wandb: test_intervention_task_loss ▁▁
wandb:                   test_loss █▁
wandb:          test_mask_accuracy ▁▁
wandb:              test_task_loss ▁▁
wandb:             test_y_accuracy █▁
wandb:                  test_y_auc █▁
wandb:                   test_y_f1 █▁
wandb:         trainer/global_step ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇████
wandb:             val_avg_c_y_acc ▁▁▃▄▄▄▅▅▅▆▇▇▇▇▇▇▇█▇████████████████▇▇█
wandb:              val_c_accuracy ▁▁▁▁▂▂▃▃▄▄▅▅▅▆▆▆▆▇▇▇▇▇▇▇▇█████████████
wandb:                   val_c_auc ▁▁▁▁▁▂▃▄▄▅▅▆▆▆▇▇▇▇▇▇▇█████████████████
wandb:                    val_c_f1 ▁▁▁▁▂▂▃▄▅▆▆▆▇▇▇▇▇▇▇███████████████████
wandb:            val_concept_loss █▇▇▆▆▅▄▄▃▃▃▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_current_steps ▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇███
wandb:           val_horizon_limit ▁▂▂▃▄▅▇███████████████████████████████
wandb:       val_intervention_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:  val_intervention_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:                    val_loss █▇▇▆▆▅▄▄▃▃▃▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_mask_accuracy ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:               val_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:              val_y_accuracy ▁▁▄▄▅▅▅▆▆▇▇▇▇█▇██████████████▇███▇█▇▇█
wandb:                   val_y_auc ▁▃▃▄▅▆▆▇▇▇▇███████████████████████████
wandb:                    val_y_f1 ▁▁▆▆▆▆▆▆▆▇█▇██████████████████████████
wandb:                  y_accuracy ▁▄▄▄▄▅▅▅▅▆▆▆▆▆▆▇▆▇▇▇▇█▇▇▇███▇▇
wandb:                       y_auc ▁▅▅▄▄▅▆▆▆▇▇▇▇▇▇█▇█████████████
wandb:                        y_f1 ▁▆▆▆▆▆▇▇▆▇▇▇▇▇▇▇▇█▇█▇█▇█████▇▇
wandb: 
wandb: Run summary:
wandb:                 avg_c_y_acc 0.94356
wandb:                  c_accuracy 0.99006
wandb:                       c_auc 0.98258
wandb:                        c_f1 0.98604
wandb:                concept_loss 0.95579
wandb:               current_steps 1650.0
wandb:                       epoch 76
wandb:               horizon_limit 9.01945
wandb:           intervention_loss 1.35548
wandb:      intervention_task_loss 0.12965
wandb:                        loss 2.44093
wandb:               mask_accuracy 0.51287
wandb:                   task_loss 0.0
wandb:            test_avg_c_y_acc 0.87532
wandb:             test_c_accuracy 0.95364
wandb:                  test_c_auc 0.88884
wandb:                   test_c_f1 0.90158
wandb:           test_concept_loss 3.80078
wandb:          test_current_steps 1688.27197
wandb:          test_horizon_limit 9.01945
wandb:      test_intervention_loss 0.0
wandb: test_intervention_task_loss 0.0
wandb:                   test_loss 3.80078
wandb:          test_mask_accuracy -1.0
wandb:              test_task_loss 0.0
wandb:             test_y_accuracy 0.797
wandb:                  test_y_auc 0.88226
wandb:                   test_y_f1 0.79593
wandb:         trainer/global_step 1520
wandb:             val_avg_c_y_acc 0.87927
wandb:              val_c_accuracy 0.95354
wandb:                   val_c_auc 0.88493
wandb:                    val_c_f1 0.89941
wandb:            val_concept_loss 3.84906
wandb:           val_current_steps 1672.46399
wandb:           val_horizon_limit 9.01945
wandb:       val_intervention_loss 0.0
wandb:  val_intervention_task_loss 0.0
wandb:                    val_loss 3.84906
wandb:           val_mask_accuracy -1.0
wandb:               val_task_loss 0.0
wandb:              val_y_accuracy 0.805
wandb:                   val_y_auc 0.88234
wandb:                    val_y_f1 0.8154
wandb:                  y_accuracy 0.89706
wandb:                       y_auc 0.99995
wandb:                        y_f1 0.8963
wandb: 
wandb: 🚀 View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2 at: https://wandb.ai/thomasyuan/intcem_test/runs/w8j1f5b8
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/intcem_test
wandb: Synced 5 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240510_092210-w8j1f5b8/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
DEBUG:root:Restarting run because we could not find test_acc_y_intcem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 43
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.intcem_policy.IntCemInterventionPolicy'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 1 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 87.97% (accuracy is 79.13%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 1 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 89.85% (accuracy is 82.20%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 1 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 90.58% (accuracy is 83.05%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 1 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 90.88% (accuracy is 83.48%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 1 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 91.08% (accuracy is 83.68%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 1 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 91.43% (accuracy is 83.88%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 1 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 91.86% (accuracy is 84.06%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 1 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 92.65% (accuracy is 84.63%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 1 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.31% (accuracy is 85.32%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00007 seconds.
	In total interventions took 22.53728 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 87.97% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 89.85% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 90.58% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 90.88% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 91.08% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 91.43% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 91.86% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 92.65% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.31% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 43
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.optimal.GreedyOptimal'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 1 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 87.97% (accuracy is 79.13%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 1 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 96.17% (accuracy is 89.06%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 1 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 97.77% (accuracy is 91.83%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 1 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 98.26% (accuracy is 92.80%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 1 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 98.41% (accuracy is 93.07%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 1 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 98.40% (accuracy is 92.95%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 1 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 98.20% (accuracy is 92.51%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 1 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 97.54% (accuracy is 90.95%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 1 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.31% (accuracy is 85.32%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00008 seconds.
	In total interventions took 22.42905 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 87.97% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 96.17% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 97.77% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 98.26% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 98.41% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 98.40% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 98.20% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 97.54% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.31% (avg int time is 0.00025s and construction time is 0.00008s).
DEBUG:root:Restarting run because we could not find test_acc_y_group_random_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 43
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_2.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.random.IndependentRandomMaskIntPolicy'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 1 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 87.97% (accuracy is 79.13%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 1 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 88.74% (accuracy is 79.99%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 1 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 89.37% (accuracy is 80.60%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 1 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 90.38% (accuracy is 81.25%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 1 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 91.07% (accuracy is 81.56%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 1 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 91.88% (accuracy is 82.48%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 1 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 92.71% (accuracy is 83.50%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 1 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 93.48% (accuracy is 84.30%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 1 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.31% (accuracy is 85.32%).
DEBUG:root:	Average intervention took 0.00013 seconds and construction took 0.00004 seconds.
	In total interventions took 11.43120 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 87.97% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 88.74% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 89.37% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 90.38% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 91.07% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 91.88% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 92.71% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 93.48% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.31% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:	Results for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in split 1:
DEBUG:root:		test_acc_y -> 0.797
DEBUG:root:		test_auc_y -> 0.8822598719501326
DEBUG:root:		test_f1_y -> 0.7959276926772559
DEBUG:root:		test_acc_c -> 0.9536351851851852
DEBUG:root:		test_auc_c -> 0.888844891509667
DEBUG:root:		test_f1_c -> 0.9015834092199447
DEBUG:root:		training_epochs -> 76
DEBUG:root:		training_time -> 1062.476624250412
DEBUG:root:		num_trainable_params -> 0
DEBUG:root:		num_non_trainable_params -> 2116333
DEBUG:root:		test_acc_y_intcem_policy_ints -> [0.8797397900959839, 0.8985136065205183, 0.9058391385236501, 0.908834963065685, 0.9107536280216404, 0.9143498843960897, 0.9186478229955204, 0.926489461272337, 0.943071665555003]
DEBUG:root:		avg_int_time_intcem_policy_ints -> 0.00025041427612304686
DEBUG:root:		construction_time_intcem_policy_ints -> 7.486343383789062e-05
DEBUG:root:		test_acc_y_optimal_greedy_no_prior_ints -> [0.8797397900959839, 0.961689586989386, 0.9776551791935524, 0.9826339317412168, 0.9841225423047665, 0.9840137747930287, 0.9819969688033647, 0.9753841393011989, 0.943071665555003]
DEBUG:root:		avg_int_time_optimal_greedy_no_prior_ints -> 0.00024921169281005856
DEBUG:root:		construction_time_optimal_greedy_no_prior_ints -> 7.748603820800781e-05
DEBUG:root:		test_acc_y_group_random_no_prior_ints -> [0.8797397900959839, 0.8874114733139071, 0.8936972615458891, 0.9037876293318561, 0.9106675851147058, 0.9187641164989887, 0.9270913957681458, 0.9347667861195438, 0.943071665555003]
DEBUG:root:		avg_int_time_group_random_no_prior_ints -> 0.00012701328595479328
DEBUG:root:		construction_time_group_random_no_prior_ints -> 4.1961669921875e-05
DEBUG:root:	Trial 2 COMPLETED for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 ending at 10/05/2024 at 09:43:32 (21.3996 minutes):	Time Breakdown:		Initialization: 0.0000 minutes		Training: 17.9869 minutes		Test Interventions: 3.4127 minutes		Evaluate Representation Metric: 0.0000 minutes
DEBUG:root:		Done with trial 2
DEBUG:root:Setting ac model save path to be results/mnist_intcem/acflow_sampling_0.625_model_trial_2.pt
[rank: 0] Global seed set to 44
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240510_094332-pen4jofi
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3
wandb: ⭐️ View project at https://wandb.ai/thomasyuan/intcem_test
wandb: 🚀 View run at https://wandb.ai/thomasyuan/intcem_test/runs/pen4jofi
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8753175925925926
      test_c_accuracy          0.9536351851851852
        test_c_auc              0.888844891509667
         test_c_f1             0.9015834092199447
     test_concept_loss         3.8007829189300537
    test_current_steps          1688.27197265625
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss             3.8007829189300537
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                 0.797
        test_y_auc             0.8822598719501326
         test_y_f1             0.7959276926772559
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
c_acc: 95.36%, y_acc: 79.70%, c_auc: 88.88%, y_auc: 88.23% with 76 epochs in 1062.48 seconds
********** Results in between trial 2 **********
	 ******************************
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+
|                                                                               Method                                                                               |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   |   25% Int Acc   |   50% Int Acc   |   75% Int Acc   |   100% Int Acc  |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 | 0.7970 ± 0.0000 | 0.8823 ± 0.0000 | 0.9536 ± 0.0000  | 0.8888 ± 0.0000 | 0.8937 ± 0.0000 | 0.9107 ± 0.0000 | 0.9271 ± 0.0000 | 0.9431 ± 0.0000 |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+



[TRIAL 3/3 BEGINS AT 10/05/2024 at 09:43:32
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3]
config:
<built-in function localtime>
	start_split -> 1
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	c_extractor_arch -> <function get_mnist_extractor_arch.<locals>.c_extractor_arch at 0x7f7f3307baf0>
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> False
	only_train_ac_model -> False
	train_afa_model -> False
	continue_training -> False
	cbm_aneal_rate -> 0.99999
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'save_path': 'results/mnist_intcem/acflow_sampling_0.625_model_trial_2.pt', 'architecture': 'flow', 'max_epochs': 100, 'batch_size': 512, 'transformations': ['AF', 'TL', 'TL', 'TL', 'TL', 'AF'], 'layer_cfg': ['LR', 'CP2'], 'rnncp_units': 256, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 40, 'prior_units': 256, 'prior_layers': 2, 'prior_hids': [256, 256], 'optimizer': 'adam', 'learning_rate': 0.0001, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	afa_model_config -> {'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': False, 'normalize_advantages': False, 'num_envs': 1}
	trials -> 3
	results_dir -> results/mnist_intcem
	dataset -> mnist_add
	num_workers -> 8
	batch_size -> 512
	num_operands -> 12
	selected_digits -> [[0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]]
	threshold_labels -> 30
	noise_level -> 0.0
	max_epochs -> 300
	train_dataset_size -> 10000
	sampling_percent -> 0.625
	sampling_groups -> True
	c2y_layers -> [128, 128]
	skip_repr_evaluation -> True
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['intcem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	root_dir -> /home/xty20/data
	test_subsampling -> 1
	weight_loss -> True
	use_task_class_weights -> True
	check_val_every_n_epoch -> 2
	time_last_called -> 2024/05/10 at 09:21:47
	n_concepts -> 54
	n_tasks -> 1
	concept_map -> {0: [0, 1, 2], 1: [3, 4, 5], 2: [6, 7, 8], 5: [9, 10, 11, 12, 13], 8: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23], 9: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33], 10: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43], 11: [44, 45, 46, 47, 48, 49, 50, 51, 52, 53]}
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 2116331 ]
[Number of non-trainable parameters in model 2 ]
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:fsspec.local:open file: /home/xty20/cem/results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
DEBUG:root:Getting test results without interventions
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8651990740740741
      test_c_accuracy           0.955398148148148
        test_c_auc             0.8916680750727951
         test_c_f1             0.9047293460612864
     test_concept_loss          3.713636636734009
    test_current_steps         1808.4639892578125
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss              3.713636636734009
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                 0.775
        test_y_auc             0.8776372029920757
         test_y_f1             0.8149191768866533
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
val_c_acc: 95.54%, val_y_acc: 77.50%, val_c_auc: 89.17%, val_y_auc: 87.76% with 82 epochs in 1140.32 seconds
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.040 MB uploadedwandb: / 0.014 MB of 0.040 MB uploadedwandb: - 0.041 MB of 0.041 MB uploadedwandb:                                                                                
wandb: 
wandb: Run history:
wandb:                 avg_c_y_acc ▁▂▃▄▄▄▅▅▅▅▅▆▆▆▆▇▆▇▇▇▇▇▇█▇███▇███
wandb:                  c_accuracy ▁▁▁▁▂▂▃▄▄▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇█▇█▇█▇█
wandb:                       c_auc ▁▁▁▁▂▃▄▄▅▅▆▆▆▆▆▇▇▇▇▇▇▇▇█▇█▇█████
wandb:                        c_f1 ▁▁▁▁▂▃▄▅▅▆▆▆▆▇▇▇▇▇▇▇▇█▇█▇███████
wandb:                concept_loss ██▇▇▆▅▅▄▄▃▃▃▃▂▃▂▂▂▂▂▂▂▂▁▂▁▂▁▁▁▁▁
wandb:               current_steps ▁▁▁▂▂▂▂▃▃▃▃▃▄▄▄▄▅▅▅▅▆▆▆▆▆▇▇▇▇███
wandb:                       epoch ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▅▆▆▆▆▆▇▇▇▇▇████
wandb:               horizon_limit ▁▂▃▄▆███████████████████████████
wandb:           intervention_loss █▆▆▅▄▄▃▃▃▂▃▂▄▂▃▃▄▂▄▄▃▂▂▂▃▄▂▁▁▁▂▁
wandb:      intervention_task_loss █▇▆▆▆▅▅▄▅▄▄▄▄▃▃▃▃▂▃▂▂▂▂▁▂▁▂▁▂▁▁▂
wandb:                        loss ██▇▇▆▅▅▄▄▃▃▃▃▂▃▂▂▂▂▂▂▂▂▁▂▁▂▁▁▁▁▁
wandb:               mask_accuracy ▁▃▃▅▆▅▆▆▆▆▆█▅▇▅▆▄▇▆▅▇▇▆▆▆▅▆██▇▇█
wandb:                   task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:            test_avg_c_y_acc █▁
wandb:             test_c_accuracy ▁█
wandb:                  test_c_auc ▁█
wandb:                   test_c_f1 ▁█
wandb:           test_concept_loss █▁
wandb:          test_current_steps ▁█
wandb:          test_horizon_limit ▁▁
wandb:      test_intervention_loss ▁▁
wandb: test_intervention_task_loss ▁▁
wandb:                   test_loss █▁
wandb:          test_mask_accuracy ▁▁
wandb:              test_task_loss ▁▁
wandb:             test_y_accuracy █▁
wandb:                  test_y_auc ▁█
wandb:                   test_y_f1 █▁
wandb:         trainer/global_step ▁▁▁▁▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇████
wandb:             val_avg_c_y_acc ▁▁▃▄▄▄▅▅▆▆▇▇▇▇▇█████████████████████▆███
wandb:              val_c_accuracy ▁▁▁▁▁▂▂▃▃▄▄▅▅▅▆▆▆▆▇▇▇▇▇▇▇▇▇▇▇███████████
wandb:                   val_c_auc ▁▁▁▁▁▂▃▃▄▅▅▆▆▆▇▇▇▇▇▇▇▇▇█████████████████
wandb:                    val_c_f1 ▁▁▁▁▁▂▃▄▅▅▆▆▇▇▇▇▇▇▇▇▇███████████████████
wandb:            val_concept_loss ██▇▇▆▅▅▄▄▃▃▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_current_steps ▁▁▁▂▂▂▂▂▂▃▃▃▃▃▃▄▄▄▄▄▄▅▅▅▅▅▆▆▆▆▆▆▇▇▇▇▇▇██
wandb:           val_horizon_limit ▁▂▂▃▄▅▇█████████████████████████████████
wandb:       val_intervention_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:  val_intervention_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:                    val_loss ██▇▇▆▅▅▄▄▃▃▂▂▂▂▂▂▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:           val_mask_accuracy ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:               val_task_loss ▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁
wandb:              val_y_accuracy ▁▁▄▄▅▅▆▆▆▇▇▇▇▇██████████████████████▆▇█▇
wandb:                   val_y_auc ▁▃▃▄▅▆▆▇▇▇▇█████████████████████████████
wandb:                    val_y_f1 ▁▁▆▆▆▆▇▇▇▇▇▇▇▇██████████████████████▆███
wandb:                  y_accuracy ▁▂▃▄▄▄▅▅▅▅▆▆▆▇▆▇▆▇▇▇▇▇▇█▇███▇███
wandb:                       y_auc ▁▃▄▅▅▆▆▆▆▇▇▇▇▇▇▇▇█▇█████████████
wandb:                        y_f1 ▁▄▅▆▆▆▇▆▇▇▇▇▇▇▇▇▇▇▇█▇███████▇███
wandb: 
wandb: Run summary:
wandb:                 avg_c_y_acc 0.98938
wandb:                  c_accuracy 0.98979
wandb:                       c_auc 0.98462
wandb:                        c_f1 0.98681
wandb:                concept_loss 0.88205
wandb:               current_steps 1758.0
wandb:                       epoch 82
wandb:               horizon_limit 9.01945
wandb:           intervention_loss 1.29176
wandb:      intervention_task_loss 0.07089
wandb:                        loss 2.24471
wandb:               mask_accuracy 0.55882
wandb:                   task_loss 0.0
wandb:            test_avg_c_y_acc 0.86248
wandb:             test_c_accuracy 0.95616
wandb:                  test_c_auc 0.8946
wandb:                   test_c_f1 0.90682
wandb:           test_concept_loss 3.6467
wandb:          test_current_steps 1820.27197
wandb:          test_horizon_limit 9.01945
wandb:      test_intervention_loss 0.0
wandb: test_intervention_task_loss 0.0
wandb:                   test_loss 3.6467
wandb:          test_mask_accuracy -1.0
wandb:              test_task_loss 0.0
wandb:             test_y_accuracy 0.7688
wandb:                  test_y_auc 0.88103
wandb:                   test_y_f1 0.80232
wandb:         trainer/global_step 1640
wandb:             val_avg_c_y_acc 0.8652
wandb:              val_c_accuracy 0.9554
wandb:                   val_c_auc 0.89167
wandb:                    val_c_f1 0.90473
wandb:            val_concept_loss 3.71364
wandb:           val_current_steps 1804.46399
wandb:           val_horizon_limit 9.01945
wandb:       val_intervention_loss 0.0
wandb:  val_intervention_task_loss 0.0
wandb:                    val_loss 3.71364
wandb:           val_mask_accuracy -1.0
wandb:               val_task_loss 0.0
wandb:              val_y_accuracy 0.775
wandb:                   val_y_auc 0.87764
wandb:                    val_y_f1 0.81492
wandb:                  y_accuracy 0.98897
wandb:                       y_auc 1.0
wandb:                        y_f1 0.99003
wandb: 
wandb: 🚀 View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3 at: https://wandb.ai/thomasyuan/intcem_test/runs/pen4jofi
wandb: ⭐️ View project at: https://wandb.ai/thomasyuan/intcem_test
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240510_094332-pen4jofi/logs
DEBUG:urllib3.connectionpool:Resetting dropped connection: o151352.ingest.sentry.io
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
DEBUG:root:Restarting run because we could not find test_acc_y_intcem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 44
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.intcem_policy.IntCemInterventionPolicy'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 2 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 88.33% (accuracy is 79.56%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 2 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 90.24% (accuracy is 82.25%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 2 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 90.85% (accuracy is 83.14%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 2 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 91.01% (accuracy is 83.54%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 2 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 91.18% (accuracy is 83.63%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 2 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 91.34% (accuracy is 83.86%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 2 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 91.75% (accuracy is 84.08%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 2 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 92.51% (accuracy is 84.42%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 2 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.02% (accuracy is 85.39%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00007 seconds.
	In total interventions took 22.24447 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 88.33% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 90.24% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 90.85% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 91.01% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 91.18% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 91.34% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 91.75% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 92.51% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.02% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:Restarting run because we could not find test_acc_y_optimal_greedy_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 44
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.optimal.GreedyOptimal'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 2 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 88.33% (accuracy is 79.56%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 2 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 96.09% (accuracy is 88.89%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 2 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 97.57% (accuracy is 91.33%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 2 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 98.00% (accuracy is 91.95%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 2 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 98.13% (accuracy is 92.36%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 2 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 98.11% (accuracy is 92.34%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 2 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 97.91% (accuracy is 91.90%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 2 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 97.27% (accuracy is 90.53%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 2 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.02% (accuracy is 85.39%).
DEBUG:root:	Average intervention took 0.00025 seconds and construction took 0.00007 seconds.
	In total interventions took 22.61889 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 88.33% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 96.09% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 97.57% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 98.00% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 98.13% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 98.11% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 97.91% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 97.27% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.02% (avg int time is 0.00025s and construction time is 0.00007s).
DEBUG:root:Restarting run because we could not find test_acc_y_group_random_no_prior_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in old results.
[rank: 0] Global seed set to 44
DEBUG:root:Loading trained model from results/mnist_intcem/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625_lambda_fold_3.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8]
DEBUG:root:Intervening in <class 'cem.models.intcbm.IntAwareConceptEmbeddingModel'> using <class 'cem.interventions.random.IndependentRandomMaskIntPolicy'>
DEBUG:root:Intervening with 0 out of 8 concept groups
DEBUG:root:	For split 2 with 0 groups intervened
DEBUG:root:	Test AUC when intervening with 0 concept groups is 88.33% (accuracy is 79.56%).
DEBUG:root:Intervening with 1 out of 8 concept groups
DEBUG:root:	For split 2 with 1 groups intervened
DEBUG:root:	Test AUC when intervening with 1 concept groups is 89.03% (accuracy is 80.24%).
DEBUG:root:Intervening with 2 out of 8 concept groups
DEBUG:root:	For split 2 with 2 groups intervened
DEBUG:root:	Test AUC when intervening with 2 concept groups is 89.62% (accuracy is 80.88%).
DEBUG:root:Intervening with 3 out of 8 concept groups
DEBUG:root:	For split 2 with 3 groups intervened
DEBUG:root:	Test AUC when intervening with 3 concept groups is 90.54% (accuracy is 81.53%).
DEBUG:root:Intervening with 4 out of 8 concept groups
DEBUG:root:	For split 2 with 4 groups intervened
DEBUG:root:	Test AUC when intervening with 4 concept groups is 91.23% (accuracy is 82.19%).
DEBUG:root:Intervening with 5 out of 8 concept groups
DEBUG:root:	For split 2 with 5 groups intervened
DEBUG:root:	Test AUC when intervening with 5 concept groups is 91.89% (accuracy is 82.96%).
DEBUG:root:Intervening with 6 out of 8 concept groups
DEBUG:root:	For split 2 with 6 groups intervened
DEBUG:root:	Test AUC when intervening with 6 concept groups is 92.56% (accuracy is 83.76%).
DEBUG:root:Intervening with 7 out of 8 concept groups
DEBUG:root:	For split 2 with 7 groups intervened
DEBUG:root:	Test AUC when intervening with 7 concept groups is 93.35% (accuracy is 84.42%).
DEBUG:root:Intervening with 8 out of 8 concept groups
DEBUG:root:	For split 2 with 8 groups intervened
DEBUG:root:	Test AUC when intervening with 8 concept groups is 94.02% (accuracy is 85.39%).
DEBUG:root:	Average intervention took 0.00013 seconds and construction took 0.00004 seconds.
	In total interventions took 11.90641 seconds
DEBUG:root:		Test AUC when intervening with 0 concept groups is 88.33% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 1 concept groups is 89.03% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 2 concept groups is 89.62% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 3 concept groups is 90.54% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 4 concept groups is 91.23% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 5 concept groups is 91.89% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 6 concept groups is 92.56% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 7 concept groups is 93.35% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:		Test AUC when intervening with 8 concept groups is 94.02% (avg int time is 0.00013s and construction time is 0.00004s).
DEBUG:root:	Results for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 in split 2:
DEBUG:root:		test_acc_y -> 0.7688
DEBUG:root:		test_auc_y -> 0.8810321206648356
DEBUG:root:		test_f1_y -> 0.8023239158573401
DEBUG:root:		test_acc_c -> 0.9561555555555559
DEBUG:root:		test_auc_c -> 0.8946005208729615
DEBUG:root:		test_f1_c -> 0.9068178533403696
DEBUG:root:		training_epochs -> 82
DEBUG:root:		training_time -> 1140.3233177661896
DEBUG:root:		num_trainable_params -> 0
DEBUG:root:		num_non_trainable_params -> 2116333
DEBUG:root:		test_acc_y_intcem_policy_ints -> [0.8833405967689334, 0.902350843257009, 0.9085009510189844, 0.9101147921718125, 0.9118286068003086, 0.9134450595274896, 0.9175331626731724, 0.9250862774777554, 0.9402252070479493]
DEBUG:root:		avg_int_time_intcem_policy_ints -> 0.00024716072612338593
DEBUG:root:		construction_time_intcem_policy_ints -> 7.2479248046875e-05
DEBUG:root:		test_acc_y_optimal_greedy_no_prior_ints -> [0.8833405967689334, 0.9609454161693703, 0.9757489961007128, 0.9799780587425831, 0.9812698566135115, 0.9811073583805979, 0.9791276008540599, 0.9727121385932509, 0.9402252070479493]
DEBUG:root:		avg_int_time_optimal_greedy_no_prior_ints -> 0.00025132101111941863
DEBUG:root:		construction_time_optimal_greedy_no_prior_ints -> 7.271766662597656e-05
DEBUG:root:		test_acc_y_group_random_no_prior_ints -> [0.8833405967689334, 0.890300977462582, 0.8961631852098594, 0.905428715750538, 0.9123250862802952, 0.9189182030407632, 0.9255599493382213, 0.9335088934348013, 0.9402252070479493]
DEBUG:root:		avg_int_time_group_random_no_prior_ints -> 0.00013229346805148655
DEBUG:root:		construction_time_group_random_no_prior_ints -> 4.0531158447265625e-05
DEBUG:root:	Trial 3 COMPLETED for IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 ending at 10/05/2024 at 10:06:10 (22.6262 minutes):	Time Breakdown:		Initialization: 0.0000 minutes		Training: 19.2021 minutes		Test Interventions: 3.4240 minutes		Evaluate Representation Metric: 0.0000 minutes
DEBUG:root:		Done with trial 3
DEBUG:root:		Done with trial 3
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        Test metric               DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
     test_avg_c_y_acc          0.8624777777777778
      test_c_accuracy          0.9561555555555559
        test_c_auc             0.8946005208729615
         test_c_f1             0.9068178533403696
     test_concept_loss         3.6467015743255615
    test_current_steps          1820.27197265625
    test_horizon_limit          9.019449234008789
  test_intervention_loss               0.0
test_intervention_task_loss            0.0
         test_loss             3.6467015743255615
    test_mask_accuracy                -1.0
      test_task_loss                   0.0
      test_y_accuracy                0.7688
        test_y_auc             0.8810321206648356
         test_y_f1             0.8023239158573401
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
c_acc: 95.62%, y_acc: 76.88%, c_auc: 89.46%, y_auc: 88.10% with 82 epochs in 1140.32 seconds
********** Results in between trial 3 **********
	 ******************************
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+
|                                                                               Method                                                                               |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   |   25% Int Acc   |   50% Int Acc   |   75% Int Acc   |   100% Int Acc  |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 | 0.7829 ± 0.0141 | 0.8816 ± 0.0006 | 0.9549 ± 0.0013  | 0.8917 ± 0.0029 | 0.8949 ± 0.0012 | 0.9115 ± 0.0008 | 0.9263 ± 0.0008 | 0.9416 ± 0.0014 |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+



********** Results after trial 3 **********
	 ******************************
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+
|                                                                               Method                                                                               |  Task Accuracy  |     Task AUC    | Concept Accuracy |   Concept AUC   |   25% Int Acc   |   50% Int Acc   |   75% Int Acc   |   100% Int Acc  |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+
| IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_0.625 | 0.7829 ± 0.0141 | 0.8816 ± 0.0006 | 0.9549 ± 0.0013  | 0.8917 ± 0.0029 | 0.8949 ± 0.0012 | 0.9115 ± 0.0008 | 0.9263 ± 0.0008 | 0.9416 ± 0.0014 |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------+------------------+-----------------+-----------------+-----------------+-----------------+-----------------+



