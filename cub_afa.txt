INFO:root:Results will be dumped in results/afa/cub_afa
DEBUG:root:And the dataset's root directory is /home/xty20/cem/cem/data/CUB200/
[rank: 0] Global seed set to 42
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "check_val_every_n_epoch": 3,
    "competence_levels": [
        1,
        0
    ],
    "dataset": "cub",
    "intervention_batch_size": 512,
    "intervention_freq": 1,
    "intervention_policies": [
        "afacem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "num_workers": 8,
    "results_dir": "results/afa/cub_afa",
    "root_dir": "/home/xty20/cem/cem/data/CUB200/",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "final_reward_ratio": 1,
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intermediate_reward_ratio": 0.02,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "num_rollouts": 1,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 1,
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 32,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "lambda_nll": 1,
            "lambda_xent": 1,
            "layer_cfg": [
                "ML",
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 50,
            "model_classes": true,
            "n_components": 200,
            "num_samples": 10,
            "optimizer": "adam",
            "patience": 3,
            "prior": "autoreg",
            "prior_hids": [
                1,
                1
            ],
            "prior_layers": 2,
            "prior_units": 1,
            "rnncp_layers": 2,
            "rnncp_units": 32,
            "transformations": [
                "AF",
                "TL",
                "TL",
                "AF"
            ],
            "weight_decay": 0.01
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": true,
            "ent_coef": 0.0,
            "lin_layers": [
                512,
                512,
                256,
                256
            ],
            "normalize_advantages": true,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "allow_no_action": false,
        "bool": false,
        "c_extractor_arch": "resnet34",
        "cbm_aneal_rate": 1,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_cbm_loss",
        "emb_size": 16,
        "enable_checkpointing": true,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "mask_no_action": true,
        "momentum": 0.9,
        "normalize_values": false,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "start_split": 0,
        "top_k_accuracy": null,
        "train_ac_model": true,
        "train_afa_model": true,
        "training_intervention_prob": 0.25,
        "use_ac_model": true,
        "weight_decay": 0.001,
        "weight_loss": true
    },
    "test_subsampling": 0.5,
    "trials": 3
}
INFO:root:Training sample shape is: torch.Size([64, 3, 299, 299]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.LongTensor
INFO:root:	Number of output classes: 200
INFO:root:Training concept shape is: torch.Size([64, 112]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 112
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/afa/cub_afa/acflow_sampling_1_model_trial_0.pt
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240514_203748-9yzurn4n
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run ac_flow_model_split_0
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_afa_results
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_afa_results/runs/9yzurn4n
DEBUG:root:AC Model input shape:	x:torch.Size([112])	b:torch.Size([112])	m:torch.Size([112])	y:torch.Size([])AC Data loader batch size: 32
DEBUG:root:Found AC flow model saved in results/afa/cub_afa/acflow_sampling_1_model_trial_0.pt
DEBUG:root:<class 'cem.models.acflow.ACFlow'>
False
DEBUG:root:Restarting run because we could not find test_accuracy_ACFlowModel in old results.
DEBUG:root:Getting test results without interventions.
[TRIAL 1/3 BEGINS AT 14/05/2024 at 20:37:46
Testing: 0it [00:00, ?it/s]Testing:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   1%|          | 1/182 [00:00<02:56,  1.02it/s]Testing DataLoader 0:   1%|          | 2/182 [00:01<02:18,  1.30it/s]Testing DataLoader 0:   2%|‚ñè         | 3/182 [00:02<02:04,  1.44it/s]Testing DataLoader 0:   2%|‚ñè         | 4/182 [00:02<01:57,  1.52it/s]Testing DataLoader 0:   3%|‚ñé         | 5/182 [00:03<01:52,  1.57it/s]Testing DataLoader 0:   3%|‚ñé         | 6/182 [00:03<01:49,  1.60it/s]Testing DataLoader 0:   4%|‚ñç         | 7/182 [00:04<01:47,  1.63it/s]Testing DataLoader 0:   4%|‚ñç         | 8/182 [00:04<01:45,  1.65it/s]Testing DataLoader 0:   5%|‚ñç         | 9/182 [00:05<01:43,  1.67it/s]Testing DataLoader 0:   5%|‚ñå         | 10/182 [00:05<01:42,  1.68it/s]Testing DataLoader 0:   6%|‚ñå         | 11/182 [00:06<01:41,  1.69it/s]Testing DataLoader 0:   7%|‚ñã         | 12/182 [00:07<01:40,  1.70it/s]Testing DataLoader 0:   7%|‚ñã         | 13/182 [00:07<01:38,  1.71it/s]Testing DataLoader 0:   8%|‚ñä         | 14/182 [00:08<01:37,  1.71it/s]Testing DataLoader 0:   8%|‚ñä         | 15/182 [00:08<01:37,  1.72it/s]Testing DataLoader 0:   9%|‚ñâ         | 16/182 [00:09<01:36,  1.73it/s]Testing DataLoader 0:   9%|‚ñâ         | 17/182 [00:09<01:35,  1.73it/s]Testing DataLoader 0:  10%|‚ñâ         | 18/182 [00:10<01:34,  1.74it/s]Testing DataLoader 0:  10%|‚ñà         | 19/182 [00:10<01:33,  1.74it/s]Testing DataLoader 0:  11%|‚ñà         | 20/182 [00:11<01:32,  1.74it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 21/182 [00:12<01:32,  1.75it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 22/182 [00:12<01:31,  1.75it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 23/182 [00:13<01:30,  1.75it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 24/182 [00:13<01:30,  1.75it/s]Testing DataLoader 0:  14%|‚ñà‚ñé        | 25/182 [00:14<01:29,  1.76it/s]Testing DataLoader 0:  14%|‚ñà‚ñç        | 26/182 [00:14<01:28,  1.76it/s]Testing DataLoader 0:  15%|‚ñà‚ñç        | 27/182 [00:15<01:28,  1.76it/s]Testing DataLoader 0:  15%|‚ñà‚ñå        | 28/182 [00:15<01:27,  1.76it/s]Testing DataLoader 0:  16%|‚ñà‚ñå        | 29/182 [00:16<01:26,  1.76it/s]Testing DataLoader 0:  16%|‚ñà‚ñã        | 30/182 [00:17<01:26,  1.76it/s]Testing DataLoader 0:  17%|‚ñà‚ñã        | 31/182 [00:17<01:25,  1.77it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 32/182 [00:18<01:24,  1.77it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 33/182 [00:18<01:24,  1.77it/s]Testing DataLoader 0:  19%|‚ñà‚ñä        | 34/182 [00:19<01:23,  1.77it/s]Testing DataLoader 0:  19%|‚ñà‚ñâ        | 35/182 [00:19<01:23,  1.77it/s]Testing DataLoader 0:  20%|‚ñà‚ñâ        | 36/182 [00:20<01:22,  1.77it/s]Testing DataLoader 0:  20%|‚ñà‚ñà        | 37/182 [00:20<01:21,  1.77it/s]Testing DataLoader 0:  21%|‚ñà‚ñà        | 38/182 [00:21<01:21,  1.77it/s]Testing DataLoader 0:  21%|‚ñà‚ñà‚ñè       | 39/182 [00:21<01:20,  1.77it/s]Testing DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 40/182 [00:22<01:20,  1.77it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 41/182 [00:23<01:19,  1.78it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 42/182 [00:23<01:18,  1.78it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñé       | 43/182 [00:24<01:18,  1.78it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñç       | 44/182 [00:24<01:17,  1.78it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñç       | 45/182 [00:25<01:17,  1.78it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñå       | 46/182 [00:25<01:16,  1.78it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 47/182 [00:26<01:15,  1.78it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñã       | 48/182 [00:26<01:15,  1.78it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 49/182 [00:27<01:14,  1.78it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 50/182 [00:28<01:14,  1.78it/s]Testing DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 51/182 [00:28<01:13,  1.78it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñä       | 52/182 [00:29<01:12,  1.78it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñâ       | 53/182 [00:29<01:12,  1.78it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñâ       | 54/182 [00:30<01:11,  1.78it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñà       | 55/182 [00:30<01:11,  1.78it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà       | 56/182 [00:31<01:10,  1.78it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà‚ñè      | 57/182 [00:31<01:10,  1.78it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 58/182 [00:32<01:09,  1.78it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 59/182 [00:33<01:08,  1.78it/s]Testing DataLoader 0:  33%|‚ñà‚ñà‚ñà‚ñé      | 60/182 [00:33<01:08,  1.79it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñé      | 61/182 [00:34<01:07,  1.79it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñç      | 62/182 [00:34<01:07,  1.79it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñç      | 63/182 [00:35<01:06,  1.79it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñå      | 64/182 [00:35<01:06,  1.79it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñå      | 65/182 [00:36<01:05,  1.79it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñã      | 66/182 [00:36<01:04,  1.79it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 67/182 [00:37<01:04,  1.79it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 68/182 [00:38<01:03,  1.79it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 69/182 [00:38<01:03,  1.79it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 70/182 [00:39<01:02,  1.79it/s]Testing DataLoader 0:  39%|‚ñà‚ñà‚ñà‚ñâ      | 71/182 [00:39<01:02,  1.79it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñâ      | 72/182 [00:40<01:01,  1.79it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñà      | 73/182 [00:40<01:00,  1.79it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 74/182 [00:41<01:00,  1.79it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 75/182 [00:41<00:59,  1.79it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 76/182 [00:42<00:59,  1.79it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 77/182 [00:43<00:58,  1.79it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 78/182 [00:43<00:58,  1.79it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 79/182 [00:44<00:57,  1.79it/s]Testing DataLoader 0:  44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 80/182 [00:44<00:56,  1.79it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 81/182 [00:45<00:56,  1.79it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 82/182 [00:45<00:55,  1.79it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 83/182 [00:46<00:55,  1.79it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 84/182 [00:46<00:54,  1.79it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 85/182 [00:47<00:54,  1.79it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 86/182 [00:47<00:53,  1.79it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 87/182 [00:48<00:53,  1.79it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 88/182 [00:49<00:52,  1.79it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 89/182 [00:49<00:51,  1.79it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 90/182 [00:50<00:51,  1.79it/s]Testing DataLoader 0:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 91/182 [00:50<00:50,  1.79it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 92/182 [00:51<00:50,  1.79it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 93/182 [00:51<00:49,  1.79it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 94/182 [00:52<00:49,  1.79it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 95/182 [00:52<00:48,  1.79it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 96/182 [00:53<00:47,  1.79it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 97/182 [00:54<00:47,  1.79it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 98/182 [00:54<00:46,  1.79it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 99/182 [00:55<00:46,  1.79it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 100/182 [00:55<00:45,  1.79it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 101/182 [00:56<00:45,  1.79it/s]Testing DataLoader 0:  56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 102/182 [00:56<00:44,  1.79it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 103/182 [00:57<00:44,  1.79it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 104/182 [00:57<00:43,  1.79it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 105/182 [00:58<00:42,  1.79it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 106/182 [00:59<00:42,  1.80it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 107/182 [00:59<00:41,  1.80it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 108/182 [01:00<00:41,  1.80it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 109/182 [01:00<00:40,  1.80it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 110/182 [01:01<00:40,  1.80it/s]Testing DataLoader 0:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 111/182 [01:01<00:39,  1.80it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 112/182 [01:02<00:38,  1.80it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 113/182 [01:02<00:38,  1.80it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 114/182 [01:03<00:37,  1.80it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 115/182 [01:04<00:37,  1.80it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 116/182 [01:04<00:36,  1.80it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 117/182 [01:05<00:36,  1.80it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 118/182 [01:05<00:35,  1.80it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 119/182 [01:06<00:35,  1.80it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 120/182 [01:06<00:34,  1.80it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 121/182 [01:07<00:33,  1.80it/s]Testing DataLoader 0:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 122/182 [01:07<00:33,  1.80it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 123/182 [01:08<00:32,  1.80it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 124/182 [01:08<00:32,  1.80it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 125/182 [01:09<00:31,  1.80it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 126/182 [01:10<00:31,  1.80it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 127/182 [01:10<00:30,  1.80it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 128/182 [01:11<00:30,  1.80it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 129/182 [01:11<00:29,  1.80it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 130/182 [01:12<00:28,  1.80it/s]Testing DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 131/182 [01:12<00:28,  1.80it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 132/182 [01:13<00:27,  1.80it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 133/182 [01:13<00:27,  1.80it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 134/182 [01:14<00:26,  1.80it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 135/182 [01:15<00:26,  1.80it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 136/182 [01:15<00:25,  1.80it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 137/182 [01:16<00:25,  1.80it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 138/182 [01:16<00:24,  1.80it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 139/182 [01:17<00:23,  1.80it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 140/182 [01:17<00:23,  1.80it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 141/182 [01:18<00:22,  1.80it/s]Testing DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 142/182 [01:18<00:22,  1.80it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 143/182 [01:19<00:21,  1.80it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 144/182 [01:20<00:21,  1.80it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 145/182 [01:20<00:20,  1.80it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 146/182 [01:21<00:20,  1.80it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 147/182 [01:21<00:19,  1.80it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 148/182 [01:22<00:18,  1.80it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 149/182 [01:22<00:18,  1.80it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 150/182 [01:23<00:17,  1.80it/s]Testing DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 151/182 [01:23<00:17,  1.80it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 152/182 [01:24<00:16,  1.80it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 153/182 [01:25<00:16,  1.80it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 154/182 [01:25<00:15,  1.80it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 155/182 [01:26<00:15,  1.80it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 156/182 [01:26<00:14,  1.80it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 157/182 [01:27<00:13,  1.80it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 158/182 [01:27<00:13,  1.80it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 159/182 [01:28<00:12,  1.80it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 160/182 [01:28<00:12,  1.80it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 161/182 [01:29<00:11,  1.80it/s]Testing DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 162/182 [01:29<00:11,  1.80it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 163/182 [01:30<00:10,  1.80it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 164/182 [01:31<00:09,  1.80it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 165/182 [01:31<00:09,  1.80it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 166/182 [01:32<00:08,  1.80it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 167/182 [01:32<00:08,  1.80it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 168/182 [01:33<00:07,  1.80it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 169/182 [01:33<00:07,  1.80it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 170/182 [01:34<00:06,  1.80it/s]Testing DataLoader 0:  94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 171/182 [01:34<00:06,  1.80it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 172/182 [01:35<00:05,  1.80it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 173/182 [01:36<00:04,  1.80it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 174/182 [01:36<00:04,  1.80it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 175/182 [01:37<00:03,  1.80it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 176/182 [01:37<00:03,  1.80it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 177/182 [01:38<00:02,  1.80it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 178/182 [01:38<00:02,  1.80it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 179/182 [01:39<00:01,  1.80it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 180/182 [01:39<00:01,  1.80it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 181/182 [01:40<00:00,  1.80it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.81it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.81it/s]wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.014 MB uploadedwandb: / 0.014 MB of 0.014 MB uploadedwandb: - 0.035 MB of 0.035 MB uploadedwandb:                                                                                
wandb: üöÄ View run ac_flow_model_split_0 at: https://wandb.ai/thomasyuan/cub_afa_results/runs/9yzurn4n
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_afa_results
wandb: Synced 5 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240514_203748-9yzurn4n/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
[rank: 0] Global seed set to 42
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_1_model_trial_0.pt
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240514_203939-sr9nieb8
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_1
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_afa_results
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_afa_results/runs/sr9nieb8
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_1.ckpt
DEBUG:root:Loaded model

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Test metric             DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      test_accuracy        0.005005177576094866
        test_nll             1.573411464691162
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
AC Model test_accuracy: 0.50%, 
AC Model test_nll: 157.34%, 
AC Model training_time: 0.00%, 
AC Model num_epochs: 0.00%, 
with 0 epochs in 0.00 seconds
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_1]
config:
<built-in function localtime>
	start_split -> 0
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	weight_loss -> True
	c_extractor_arch -> resnet34
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_cbm_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> True
	only_train_ac_model -> False
	allow_no_action -> False
	mask_no_action -> True
	train_afa_model -> True
	continue_training -> False
	cbm_aneal_rate -> 1
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'architecture': 'flow', 'max_epochs': 50, 'batch_size': 32, 'transformations': ['AF', 'TL', 'TL', 'AF'], 'layer_cfg': ['ML', 'LR', 'CP2'], 'rnncp_units': 32, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 200, 'prior_units': 1, 'prior_layers': 2, 'prior_hids': [1, 1], 'optimizer': 'adam', 'learning_rate': 0.0001, 'weight_decay': 0.01, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10, 'patience': 3, 'lambda_nll': 1, 'lambda_xent': 1, 'model_classes': True, 'save_path': 'results/afa/cub_afa/acflow_sampling_1_model_trial_0.pt'}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	normalize_values -> False
	use_ac_model -> True
	afa_model_config -> {'lin_layers': [512, 512, 256, 256], 'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': True, 'normalize_advantages': True, 'num_envs': 1}
	trials -> 3
	results_dir -> results/afa/cub_afa
	dataset -> cub
	num_workers -> 8
	batch_size -> 64
	root_dir -> /home/xty20/cem/cem/data/CUB200/
	sampling_percent -> 1
	test_subsampling -> 0.5
	sampling_groups -> True
	competence_levels -> [1, 0]
	check_val_every_n_epoch -> 3
	intervention_freq -> 1
	intervention_batch_size -> 512
	intervention_policies -> ['afacem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	max_epochs -> 300
	time_last_called -> 2024/05/14 at 20:37:43
	n_concepts -> 112
	n_tasks -> 200
	concept_map -> defaultdict(<class 'list'>, {'has_bill_shape': [0, 1, 2, 3], 'has_wing_color': [4, 5, 6, 7, 8, 9], 'has_upperparts_color': [10, 11, 12, 13, 14, 15], 'has_underparts_color': [16, 17, 18, 19, 20, 21], 'has_breast_pattern': [22, 23, 24], 'has_back_color': [25, 26, 27, 28, 29, 30], 'has_tail_shape': [31], 'has_upper_tail_color': [32, 33, 34, 35, 36], 'has_head_pattern': [37, 38], 'has_breast_color': [39, 40, 41, 42, 43, 44], 'has_throat_color': [45, 46, 47, 48, 49], 'has_eye_color': [50], 'has_bill_length': [51, 52], 'has_forehead_color': [53, 54, 55, 56, 57, 58], 'has_under_tail_color': [59, 60, 61, 62, 63], 'has_nape_color': [64, 65, 66, 67, 68, 69], 'has_belly_color': [70, 71, 72, 73, 74, 75], 'has_wing_shape': [76, 77], 'has_size': [78, 79, 80], 'has_shape': [81, 82], 'has_back_pattern': [83, 84, 85], 'has_tail_pattern': [86, 87, 88], 'has_belly_pattern': [89], 'has_primary_color': [90, 91, 92, 93, 94, 95], 'has_leg_color': [96, 97, 98], 'has_bill_color': [99, 100, 101], 'has_crown_color': [102, 103, 104, 105, 106, 107], 'has_wing_pattern': [108, 109, 110, 111]})
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	num_rollouts -> 1
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	final_reward_ratio -> 1
	intermediate_reward_ratio -> 0.02
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 29713401 ]
[Number of non-trainable parameters in model 14837872 ]
	Found cached model... loading it

[1]+  Stopped                 python experiments/run_experiments_rl.py -c experiments/configs/afa_configs/cub_afa3.yaml --debug --project_name="cub_afa_results"
Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 12, in <module>
    import pytorch_lightning as pl
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pytorch_lightning/__init__.py", line 34, in <module>
    from lightning_fabric.utilities.seed import seed_everything  # noqa: E402
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/lightning_fabric/__init__.py", line 23, in <module>
    from lightning_fabric.fabric import Fabric  # noqa: E402
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/lightning_fabric/fabric.py", line 23, in <module>
    from lightning_utilities.core.apply_func import apply_to_collection
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/lightning_utilities/__init__.py", line 6, in <module>
    from lightning_utilities.core.apply_func import apply_to_collection
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/lightning_utilities/core/__init__.py", line 4, in <module>
    from lightning_utilities.core.imports import compare_version, module_available
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/lightning_utilities/core/imports.py", line 14, in <module>
    import pkg_resources
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pkg_resources/__init__.py", line 3325, in <module>
    def _initialize_master_working_set():
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pkg_resources/__init__.py", line 3299, in _call_aside
    f(*args, **kwargs)
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pkg_resources/__init__.py", line 3357, in _initialize_master_working_set
    list(map(working_set.add_entry, sys.path))
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pkg_resources/__init__.py", line 671, in add_entry
    for dist in find_distributions(entry, True):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pkg_resources/__init__.py", line 2127, in find_on_path
    entries = (os.path.join(path_item, child) for child in safe_listdir(path_item))
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/pkg_resources/__init__.py", line 2176, in safe_listdir
    return os.listdir(path)
KeyboardInterrupt
INFO:root:Results will be dumped in results/afa/cub_afa
DEBUG:root:And the dataset's root directory is /home/xty20/cem/cem/data/CUB200/
[rank: 0] Global seed set to 42
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "check_val_every_n_epoch": 3,
    "competence_levels": [
        1,
        0
    ],
    "dataset": "cub",
    "intervention_batch_size": 128,
    "intervention_freq": 1,
    "intervention_policies": [
        "afacem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "num_workers": 8,
    "results_dir": "results/afa/cub_afa",
    "root_dir": "/home/xty20/cem/cem/data/CUB200/",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "final_reward_ratio": 1,
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intermediate_reward_ratio": 0.02,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "num_rollouts": 1,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 1,
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 32,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "lambda_nll": 1,
            "lambda_xent": 1,
            "layer_cfg": [
                "ML",
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 50,
            "model_classes": true,
            "n_components": 200,
            "num_samples": 10,
            "optimizer": "adam",
            "patience": 3,
            "prior": "autoreg",
            "prior_hids": [
                1,
                1
            ],
            "prior_layers": 2,
            "prior_units": 1,
            "rnncp_layers": 2,
            "rnncp_units": 32,
            "transformations": [
                "AF",
                "TL",
                "TL",
                "AF"
            ],
            "weight_decay": 0.01
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": true,
            "ent_coef": 0.0,
            "lin_layers": [
                512,
                512,
                256,
                256
            ],
            "normalize_advantages": true,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "allow_no_action": false,
        "bool": false,
        "c_extractor_arch": "resnet34",
        "cbm_aneal_rate": 1,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_cbm_loss",
        "emb_size": 16,
        "enable_checkpointing": true,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "mask_no_action": true,
        "momentum": 0.9,
        "normalize_values": false,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "start_split": 1,
        "top_k_accuracy": null,
        "train_ac_model": true,
        "train_afa_model": true,
        "training_intervention_prob": 0.25,
        "use_ac_model": true,
        "weight_decay": 0.001,
        "weight_loss": true
    },
    "test_subsampling": 0.5,
    "trials": 3
}
INFO:root:Training sample shape is: torch.Size([64, 3, 299, 299]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.LongTensor
INFO:root:	Number of output classes: 200
INFO:root:Training concept shape is: torch.Size([64, 112]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 112
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240514_205427-i1wa6lmq
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run ac_flow_model_split_1
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_afa_results
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_afa_results/runs/i1wa6lmq
DEBUG:root:AC Model input shape:	x:torch.Size([112])	b:torch.Size([112])	m:torch.Size([112])	y:torch.Size([])AC Data loader batch size: 32
DEBUG:root:Found AC flow model saved in results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt
DEBUG:root:<class 'cem.models.acflow.ACFlow'>
False
DEBUG:root:Restarting run because we could not find test_accuracy_ACFlowModel in old results.
DEBUG:root:Getting test results without interventions.
[TRIAL 2/3 BEGINS AT 14/05/2024 at 20:54:26
Testing: 0it [00:00, ?it/s]Testing:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   1%|          | 1/182 [00:01<03:04,  1.02s/it]Testing DataLoader 0:   1%|          | 2/182 [00:01<02:22,  1.27it/s]Testing DataLoader 0:   2%|‚ñè         | 3/182 [00:02<02:06,  1.41it/s]Testing DataLoader 0:   2%|‚ñè         | 4/182 [00:02<01:59,  1.49it/s]Testing DataLoader 0:   3%|‚ñé         | 5/182 [00:03<01:54,  1.55it/s]Testing DataLoader 0:   3%|‚ñé         | 6/182 [00:03<01:50,  1.59it/s]Testing DataLoader 0:   4%|‚ñç         | 7/182 [00:04<01:48,  1.62it/s]Testing DataLoader 0:   4%|‚ñç         | 8/182 [00:04<01:46,  1.64it/s]Testing DataLoader 0:   5%|‚ñç         | 9/182 [00:05<01:44,  1.66it/s]Testing DataLoader 0:   5%|‚ñå         | 10/182 [00:05<01:42,  1.67it/s]Testing DataLoader 0:   6%|‚ñå         | 11/182 [00:06<01:41,  1.69it/s]Testing DataLoader 0:   7%|‚ñã         | 12/182 [00:07<01:40,  1.70it/s]Testing DataLoader 0:   7%|‚ñã         | 13/182 [00:07<01:39,  1.70it/s]Testing DataLoader 0:   8%|‚ñä         | 14/182 [00:08<01:38,  1.71it/s]Testing DataLoader 0:   8%|‚ñä         | 15/182 [00:08<01:37,  1.72it/s]Testing DataLoader 0:   9%|‚ñâ         | 16/182 [00:09<01:36,  1.72it/s]Testing DataLoader 0:   9%|‚ñâ         | 17/182 [00:09<01:35,  1.73it/s]Testing DataLoader 0:  10%|‚ñâ         | 18/182 [00:10<01:34,  1.73it/s]Testing DataLoader 0:  10%|‚ñà         | 19/182 [00:10<01:33,  1.74it/s]Testing DataLoader 0:  11%|‚ñà         | 20/182 [00:11<01:32,  1.74it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 21/182 [00:12<01:32,  1.75it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 22/182 [00:12<01:31,  1.75it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 23/182 [00:13<01:30,  1.75it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 24/182 [00:13<01:30,  1.75it/s]Testing DataLoader 0:  14%|‚ñà‚ñé        | 25/182 [00:14<01:29,  1.76it/s]Testing DataLoader 0:  14%|‚ñà‚ñç        | 26/182 [00:14<01:28,  1.76it/s]Testing DataLoader 0:  15%|‚ñà‚ñç        | 27/182 [00:15<01:28,  1.76it/s]Testing DataLoader 0:  15%|‚ñà‚ñå        | 28/182 [00:15<01:27,  1.76it/s]Testing DataLoader 0:  16%|‚ñà‚ñå        | 29/182 [00:16<01:26,  1.77it/s]Testing DataLoader 0:  16%|‚ñà‚ñã        | 30/182 [00:16<01:26,  1.77it/s]Testing DataLoader 0:  17%|‚ñà‚ñã        | 31/182 [00:17<01:25,  1.77it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 32/182 [00:18<01:24,  1.77it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 33/182 [00:18<01:24,  1.77it/s]Testing DataLoader 0:  19%|‚ñà‚ñä        | 34/182 [00:19<01:23,  1.77it/s]Testing DataLoader 0:  19%|‚ñà‚ñâ        | 35/182 [00:19<01:22,  1.77it/s]Testing DataLoader 0:  20%|‚ñà‚ñâ        | 36/182 [00:20<01:22,  1.78it/s]Testing DataLoader 0:  20%|‚ñà‚ñà        | 37/182 [00:20<01:21,  1.78it/s]Testing DataLoader 0:  21%|‚ñà‚ñà        | 38/182 [00:21<01:21,  1.78it/s]Testing DataLoader 0:  21%|‚ñà‚ñà‚ñè       | 39/182 [00:21<01:20,  1.78it/s]Testing DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 40/182 [00:22<01:19,  1.78it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 41/182 [00:23<01:19,  1.78it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 42/182 [00:23<01:18,  1.78it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñé       | 43/182 [00:24<01:17,  1.78it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñç       | 44/182 [00:24<01:17,  1.78it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñç       | 45/182 [00:25<01:16,  1.78it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñå       | 46/182 [00:25<01:16,  1.78it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 47/182 [00:26<01:15,  1.79it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñã       | 48/182 [00:26<01:15,  1.79it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 49/182 [00:27<01:14,  1.79it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 50/182 [00:27<01:13,  1.79it/s]Testing DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 51/182 [00:28<01:13,  1.79it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñä       | 52/182 [00:29<01:12,  1.79it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñâ       | 53/182 [00:29<01:12,  1.79it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñâ       | 54/182 [00:30<01:11,  1.79it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñà       | 55/182 [00:30<01:10,  1.79it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà       | 56/182 [00:31<01:10,  1.79it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà‚ñè      | 57/182 [00:31<01:09,  1.79it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 58/182 [00:32<01:09,  1.79it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 59/182 [00:32<01:08,  1.79it/s]Testing DataLoader 0:  33%|‚ñà‚ñà‚ñà‚ñé      | 60/182 [00:33<01:08,  1.79it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñé      | 61/182 [00:34<01:07,  1.79it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñç      | 62/182 [00:34<01:06,  1.79it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñç      | 63/182 [00:35<01:06,  1.79it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñå      | 64/182 [00:35<01:05,  1.79it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñå      | 65/182 [00:36<01:05,  1.79it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñã      | 66/182 [00:36<01:04,  1.79it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 67/182 [00:37<01:04,  1.79it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 68/182 [00:37<01:03,  1.80it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 69/182 [00:38<01:02,  1.80it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 70/182 [00:38<01:02,  1.80it/s]Testing DataLoader 0:  39%|‚ñà‚ñà‚ñà‚ñâ      | 71/182 [00:39<01:01,  1.80it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñâ      | 72/182 [00:40<01:01,  1.80it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñà      | 73/182 [00:40<01:00,  1.80it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 74/182 [00:41<01:00,  1.80it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 75/182 [00:41<00:59,  1.80it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 76/182 [00:42<00:58,  1.80it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 77/182 [00:42<00:58,  1.80it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 78/182 [00:43<00:57,  1.80it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 79/182 [00:43<00:57,  1.80it/s]Testing DataLoader 0:  44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 80/182 [00:44<00:56,  1.80it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 81/182 [00:45<00:56,  1.80it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 82/182 [00:45<00:55,  1.80it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 83/182 [00:46<00:55,  1.80it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 84/182 [00:46<00:54,  1.80it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 85/182 [00:47<00:53,  1.80it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 86/182 [00:47<00:53,  1.80it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 87/182 [00:48<00:52,  1.80it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 88/182 [00:48<00:52,  1.80it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 89/182 [00:49<00:51,  1.80it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 90/182 [00:49<00:51,  1.80it/s]Testing DataLoader 0:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 91/182 [00:50<00:50,  1.80it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 92/182 [00:51<00:49,  1.80it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 93/182 [00:51<00:49,  1.80it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 94/182 [00:52<00:48,  1.80it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 95/182 [00:52<00:48,  1.80it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 96/182 [00:53<00:47,  1.80it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 97/182 [00:53<00:47,  1.80it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 98/182 [00:54<00:46,  1.80it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 99/182 [00:54<00:46,  1.80it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 100/182 [00:55<00:45,  1.80it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 101/182 [00:56<00:44,  1.80it/s]Testing DataLoader 0:  56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 102/182 [00:56<00:44,  1.80it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 103/182 [00:57<00:43,  1.80it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 104/182 [00:57<00:43,  1.80it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 105/182 [00:58<00:42,  1.80it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 106/182 [00:58<00:42,  1.80it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 107/182 [00:59<00:41,  1.80it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 108/182 [00:59<00:41,  1.80it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 109/182 [01:00<00:40,  1.80it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 110/182 [01:00<00:39,  1.80it/s]Testing DataLoader 0:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 111/182 [01:01<00:39,  1.80it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 112/182 [01:02<00:38,  1.80it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 113/182 [01:02<00:38,  1.80it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 114/182 [01:03<00:37,  1.80it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 115/182 [01:03<00:37,  1.80it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 116/182 [01:04<00:36,  1.80it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 117/182 [01:04<00:36,  1.80it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 118/182 [01:05<00:35,  1.80it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 119/182 [01:05<00:34,  1.80it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 120/182 [01:06<00:34,  1.80it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 121/182 [01:07<00:33,  1.80it/s]Testing DataLoader 0:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 122/182 [01:07<00:33,  1.80it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 123/182 [01:08<00:32,  1.81it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 124/182 [01:08<00:32,  1.81it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 125/182 [01:09<00:31,  1.81it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 126/182 [01:09<00:31,  1.81it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 127/182 [01:10<00:30,  1.81it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 128/182 [01:10<00:29,  1.81it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 129/182 [01:11<00:29,  1.81it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 130/182 [01:11<00:28,  1.81it/s]Testing DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 131/182 [01:12<00:28,  1.81it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 132/182 [01:13<00:27,  1.81it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 133/182 [01:13<00:27,  1.81it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 134/182 [01:14<00:26,  1.81it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 135/182 [01:14<00:26,  1.81it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 136/182 [01:15<00:25,  1.81it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 137/182 [01:15<00:24,  1.81it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 138/182 [01:16<00:24,  1.81it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 139/182 [01:16<00:23,  1.81it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 140/182 [01:17<00:23,  1.81it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 141/182 [01:18<00:22,  1.81it/s]Testing DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 142/182 [01:18<00:22,  1.81it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 143/182 [01:19<00:21,  1.81it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 144/182 [01:19<00:21,  1.81it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 145/182 [01:20<00:20,  1.81it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 146/182 [01:20<00:19,  1.81it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 147/182 [01:21<00:19,  1.81it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 148/182 [01:21<00:18,  1.81it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 149/182 [01:22<00:18,  1.81it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 150/182 [01:22<00:17,  1.81it/s]Testing DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 151/182 [01:23<00:17,  1.81it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 152/182 [01:24<00:16,  1.81it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 153/182 [01:24<00:16,  1.81it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 154/182 [01:25<00:15,  1.81it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 155/182 [01:25<00:14,  1.81it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 156/182 [01:26<00:14,  1.81it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 157/182 [01:26<00:13,  1.81it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 158/182 [01:27<00:13,  1.81it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 159/182 [01:27<00:12,  1.81it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 160/182 [01:28<00:12,  1.81it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 161/182 [01:29<00:11,  1.81it/s]Testing DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 162/182 [01:29<00:11,  1.81it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 163/182 [01:30<00:10,  1.81it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 164/182 [01:30<00:09,  1.81it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 165/182 [01:31<00:09,  1.81it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 166/182 [01:31<00:08,  1.81it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 167/182 [01:32<00:08,  1.81it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 168/182 [01:32<00:07,  1.81it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 169/182 [01:33<00:07,  1.81it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 170/182 [01:33<00:06,  1.81it/s]Testing DataLoader 0:  94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 171/182 [01:34<00:06,  1.81it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 172/182 [01:35<00:05,  1.81it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 173/182 [01:35<00:04,  1.81it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 174/182 [01:36<00:04,  1.81it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 175/182 [01:36<00:03,  1.81it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 176/182 [01:37<00:03,  1.81it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 177/182 [01:37<00:02,  1.81it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 178/182 [01:38<00:02,  1.81it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 179/182 [01:38<00:01,  1.81it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 180/182 [01:39<00:01,  1.81it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 181/182 [01:40<00:00,  1.81it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.81it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.81it/s]wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.024 MB uploadedwandb: / 0.014 MB of 0.024 MB uploadedwandb: - 0.024 MB of 0.024 MB uploadedwandb:                                                                                
wandb: üöÄ View run ac_flow_model_split_1 at: https://wandb.ai/thomasyuan/cub_afa_results/runs/i1wa6lmq
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_afa_results
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240514_205427-i1wa6lmq/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
[rank: 0] Global seed set to 43
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240514_205615-81vv4ivg
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_afa_results
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_afa_results/runs/81vv4ivg
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2.ckpt
DEBUG:root:Loaded model
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Testing with budget None

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Test metric             DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      test_accuracy         0.8153262138366699
        test_nll           -0.42401838302612305
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
AC Model test_accuracy: 81.53%, 
AC Model test_nll: -42.40%, 
AC Model training_time: 123478.32%, 
AC Model num_epochs: 1700.00%, 
with 17.0 epochs in 1234.78 seconds
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2]
config:
<built-in function localtime>
	start_split -> 1
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	weight_loss -> True
	c_extractor_arch -> resnet34
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_cbm_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> True
	only_train_ac_model -> False
	allow_no_action -> False
	mask_no_action -> True
	train_afa_model -> True
	continue_training -> False
	cbm_aneal_rate -> 1
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> True
	ac_model_config -> {'architecture': 'flow', 'max_epochs': 50, 'batch_size': 32, 'transformations': ['AF', 'TL', 'TL', 'AF'], 'layer_cfg': ['ML', 'LR', 'CP2'], 'rnncp_units': 32, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 200, 'prior_units': 1, 'prior_layers': 2, 'prior_hids': [1, 1], 'optimizer': 'adam', 'learning_rate': 0.0001, 'weight_decay': 0.01, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10, 'patience': 3, 'lambda_nll': 1, 'lambda_xent': 1, 'model_classes': True, 'save_path': 'results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt'}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	normalize_values -> False
	use_ac_model -> True
	afa_model_config -> {'lin_layers': [512, 512, 256, 256], 'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': True, 'normalize_advantages': True, 'num_envs': 1}
	trials -> 3
	results_dir -> results/afa/cub_afa
	dataset -> cub
	num_workers -> 8
	batch_size -> 64
	root_dir -> /home/xty20/cem/cem/data/CUB200/
	sampling_percent -> 1
	test_subsampling -> 0.5
	sampling_groups -> True
	competence_levels -> [1, 0]
	check_val_every_n_epoch -> 3
	intervention_freq -> 1
	intervention_batch_size -> 128
	intervention_policies -> ['afacem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	max_epochs -> 300
	time_last_called -> 2024/05/14 at 20:54:24
	n_concepts -> 112
	n_tasks -> 200
	concept_map -> defaultdict(<class 'list'>, {'has_bill_shape': [0, 1, 2, 3], 'has_wing_color': [4, 5, 6, 7, 8, 9], 'has_upperparts_color': [10, 11, 12, 13, 14, 15], 'has_underparts_color': [16, 17, 18, 19, 20, 21], 'has_breast_pattern': [22, 23, 24], 'has_back_color': [25, 26, 27, 28, 29, 30], 'has_tail_shape': [31], 'has_upper_tail_color': [32, 33, 34, 35, 36], 'has_head_pattern': [37, 38], 'has_breast_color': [39, 40, 41, 42, 43, 44], 'has_throat_color': [45, 46, 47, 48, 49], 'has_eye_color': [50], 'has_bill_length': [51, 52], 'has_forehead_color': [53, 54, 55, 56, 57, 58], 'has_under_tail_color': [59, 60, 61, 62, 63], 'has_nape_color': [64, 65, 66, 67, 68, 69], 'has_belly_color': [70, 71, 72, 73, 74, 75], 'has_wing_shape': [76, 77], 'has_size': [78, 79, 80], 'has_shape': [81, 82], 'has_back_pattern': [83, 84, 85], 'has_tail_pattern': [86, 87, 88], 'has_belly_pattern': [89], 'has_primary_color': [90, 91, 92, 93, 94, 95], 'has_leg_color': [96, 97, 98], 'has_bill_color': [99, 100, 101], 'has_crown_color': [102, 103, 104, 105, 106, 107], 'has_wing_pattern': [108, 109, 110, 111]})
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	num_rollouts -> 1
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	final_reward_ratio -> 1
	intermediate_reward_ratio -> 0.02
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 29713401 ]
[Number of non-trainable parameters in model 14837872 ]
	Found cached model... loading it
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa in old results.
DEBUG:root:Getting test results without interventions
DEBUG:root:Testing with budget None
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        Test metric               DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ent_loss                      0.0
          pg_loss             -0.017258232459425926
      test_agent_loss          0.30261528491973877
     test_avg_c_y_acc          0.8293957190555685
      test_c_accuracy          0.9484408538039586
        test_c_auc             0.8960137487687668
         test_c_f1             0.8991549886751957
       test_cbm_loss            5.723240375518799
     test_concept_loss         3.3223366737365723
    test_current_steps          2757.86474609375
    test_horizon_limit                 2.0
test_intervention_accuracy     0.9056761268781303
   test_intervention_auc               0.0
  test_intervention_loss       0.30261528491973877
test_intervention_task_loss    2.4009034633636475
         test_loss              6.025855541229248
    test_mask_accuracy                 0.0
      test_task_loss                   0.0
      test_y_accuracy          0.7103505843071787
        test_y_auc                     0.0
         test_y_f1             0.5701931616708421
          v_loss               0.31987351179122925
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
val_c_acc: 94.84%, val_y_acc: 71.04%, val_c_auc: 89.60%, val_y_auc: 0.00% with 39.0 epochs in 11442.09 seconds
wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.014 MB uploadedwandb: / 0.048 MB of 0.067 MB uploaded (0.007 MB deduped)wandb: - 0.048 MB of 0.067 MB uploaded (0.007 MB deduped)wandb: \ 0.067 MB of 0.067 MB uploaded (0.007 MB deduped)wandb:                                                                                
wandb: W&B sync reduced upload amount by 10.5%             
wandb: üöÄ View run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2 at: https://wandb.ai/thomasyuan/cub_afa_results/runs/81vv4ivg
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_afa_results
wandb: Synced 5 W&B file(s), 0 media file(s), 2 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240514_205615-81vv4ivg/logs
DEBUG:urllib3.connectionpool:Resetting dropped connection: o151352.ingest.sentry.io
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        Test metric               DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ent_loss                      0.0
          pg_loss             0.0070273964665830135
      test_agent_loss           0.205216646194458
     test_avg_c_y_acc          0.8375004623009024
      test_c_accuracy          0.9487323709255877
        test_c_auc             0.9421118155330803
         test_c_f1             0.8333005079127813
       test_cbm_loss            5.559075355529785
     test_concept_loss          3.301851272583008
    test_current_steps          2812.76708984375
    test_horizon_limit                 2.0
test_intervention_accuracy     0.9212978943734899
   test_intervention_auc               0.0
  test_intervention_loss        0.205216646194458
test_intervention_task_loss    2.2572240829467773
         test_loss              5.764292240142822
    test_mask_accuracy                 0.0
      test_task_loss                   0.0
      test_y_accuracy          0.7262685536762168
        test_y_auc                     0.0
         test_y_f1             0.25389501393130637
          v_loss               0.19818925857543945
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
c_acc: 94.87%, y_acc: 72.63%, c_auc: 94.21%, y_auc: 0.00% with 39.0 epochs in 11442.09 seconds
DEBUG:root:Restarting run because we could not find test_acc_y_afacem_policy_ints_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa in old results.
[rank: 0] Global seed set to 43
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2.ckpt
DEBUG:root:Intervention groups: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28]
DEBUG:root:Intervening in <class 'cem.models.afacbm.AFAModel'> using <class 'cem.interventions.afacem_policy.AFACemInterventionPolicy'>
DEBUG:root:Intervening with 0 out of 28 concept groups
DEBUG:root:	For split 1 with 0 groups intervened
DEBUG:root:Testing with budget 0
DEBUG:root:	Test Accuracy when intervening with 0 concept groups is 72.11.
DEBUG:root:Intervening with 1 out of 28 concept groups
DEBUG:root:	For split 1 with 1 groups intervened
DEBUG:root:Testing with budget 1
DEBUG:root:	Test Accuracy when intervening with 1 concept groups is 75.15.
DEBUG:root:Intervening with 2 out of 28 concept groups
DEBUG:root:	For split 1 with 2 groups intervened
DEBUG:root:Testing with budget 2
DEBUG:root:	Test Accuracy when intervening with 2 concept groups is 77.08.
DEBUG:root:Intervening with 3 out of 28 concept groups
DEBUG:root:	For split 1 with 3 groups intervened
DEBUG:root:Testing with budget 3
Traceback (most recent call last):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/interventions/utils.py", line 411, in intervene_in_cbm
    [test_batch_results] = trainer.test(
TypeError: cannot unpack non-iterable NoneType object

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "experiments/run_experiments_rl.py", line 913, in <module>
    main(
  File "experiments/run_experiments_rl.py", line 509, in main
    intervention_utils.test_interventions(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/interventions/utils.py", line 1411, in test_interventions
    (int_results, avg_time, constr_time), loaded = load_call(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 90, in load_call
    return function(**kwargs), False
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/interventions/utils.py", line 416, in intervene_in_cbm
    raise ValueError(f"Failed to intervene with {num_groups_intervened} groups while restoring checkpoint from {trainer.ckpt_path}")
ValueError: Failed to intervene with 3 groups while restoring checkpoint from None
Error in atexit._run_exitfuncs:
Traceback (most recent call last):
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1079, in wait
    return self._wait(timeout=timeout)
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1804, in _wait
    (pid, sts) = self._try_wait(0)
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1762, in _try_wait
    (pid, sts) = os.waitpid(self.pid, wait_flags)
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/wandb_manager.py", line 176, in _teardown
    result = self._service.join()
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/wandb/sdk/service/service.py", line 263, in join
    ret = self._internal_proc.wait()
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1092, in wait
    self._wait(timeout=sigint_timeout)
  File "/usr/local/software/master/python/3.8/lib/python3.8/subprocess.py", line 1798, in _wait
    time.sleep(delay)
KeyboardInterrupt
INFO:root:Results will be dumped in results/afa/cub_afa
DEBUG:root:And the dataset's root directory is /home/xty20/cem/cem/data/CUB200/
[rank: 0] Global seed set to 42
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "check_val_every_n_epoch": 3,
    "competence_levels": [
        1,
        0
    ],
    "dataset": "cub",
    "intervention_batch_size": 128,
    "intervention_freq": 1,
    "intervention_policies": [
        "afacem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "num_workers": 8,
    "results_dir": "results/afa/cub_afa",
    "root_dir": "/home/xty20/cem/cem/data/CUB200/",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "final_reward_ratio": 1,
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intermediate_reward_ratio": 0.02,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "num_rollouts": 1,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 1,
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 32,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "lambda_nll": 1,
            "lambda_xent": 1,
            "layer_cfg": [
                "ML",
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 50,
            "model_classes": true,
            "n_components": 200,
            "num_samples": 10,
            "optimizer": "adam",
            "patience": 3,
            "prior": "autoreg",
            "prior_hids": [
                1,
                1
            ],
            "prior_layers": 2,
            "prior_units": 1,
            "rnncp_layers": 2,
            "rnncp_units": 32,
            "transformations": [
                "AF",
                "TL",
                "TL",
                "AF"
            ],
            "weight_decay": 0.01
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": true,
            "ent_coef": 0.0,
            "lin_layers": [
                512,
                512,
                256,
                256
            ],
            "normalize_advantages": true,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "allow_no_action": false,
        "bool": false,
        "c_extractor_arch": "resnet34",
        "cbm_aneal_rate": 1,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 0.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_cbm_loss",
        "emb_size": 16,
        "enable_checkpointing": false,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "mask_no_action": true,
        "momentum": 0.9,
        "normalize_values": false,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 5,
        "save_model": true,
        "sigmoidal_prob": false,
        "start_split": 2,
        "top_k_accuracy": null,
        "train_ac_model": true,
        "train_afa_model": true,
        "training_intervention_prob": 0.25,
        "use_ac_model": true,
        "weight_decay": 0.001,
        "weight_loss": true
    },
    "test_subsampling": 0.5,
    "trials": 3
}
INFO:root:Training sample shape is: torch.Size([64, 3, 299, 299]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.LongTensor
INFO:root:	Number of output classes: 200
INFO:root:Training concept shape is: torch.Size([64, 112]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 112
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/afa/cub_afa/acflow_sampling_1_model_trial_2.pt
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240514_212041-j4cq3295
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run ac_flow_model_split_2
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_afa_results
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_afa_results/runs/j4cq3295
DEBUG:root:AC Model input shape:	x:torch.Size([112])	b:torch.Size([112])	m:torch.Size([112])	y:torch.Size([])AC Data loader batch size: 32
DEBUG:root:Found AC flow model saved in results/afa/cub_afa/acflow_sampling_1_model_trial_2.pt
DEBUG:root:<class 'cem.models.acflow.ACFlow'>
False
DEBUG:root:Restarting run because we could not find test_accuracy_ACFlowModel in old results.
DEBUG:root:Getting test results without interventions.
[TRIAL 3/3 BEGINS AT 14/05/2024 at 21:20:40
Testing: 0it [00:00, ?it/s]Testing:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   1%|          | 1/182 [00:00<02:52,  1.05it/s]Testing DataLoader 0:   1%|          | 2/182 [00:01<02:15,  1.33it/s]Testing DataLoader 0:   2%|‚ñè         | 3/182 [00:02<02:02,  1.46it/s]Testing DataLoader 0:   2%|‚ñè         | 4/182 [00:02<01:56,  1.53it/s]Testing DataLoader 0:   3%|‚ñé         | 5/182 [00:03<01:51,  1.58it/s]Testing DataLoader 0:   3%|‚ñé         | 6/182 [00:03<01:48,  1.62it/s]Testing DataLoader 0:   4%|‚ñç         | 7/182 [00:04<01:46,  1.64it/s]Testing DataLoader 0:   4%|‚ñç         | 8/182 [00:04<01:44,  1.66it/s]Testing DataLoader 0:   5%|‚ñç         | 9/182 [00:05<01:43,  1.68it/s]Testing DataLoader 0:   5%|‚ñå         | 10/182 [00:05<01:41,  1.69it/s]Testing DataLoader 0:   6%|‚ñå         | 11/182 [00:06<01:40,  1.70it/s]Testing DataLoader 0:   7%|‚ñã         | 12/182 [00:07<01:39,  1.71it/s]Testing DataLoader 0:   7%|‚ñã         | 13/182 [00:07<01:38,  1.72it/s]Testing DataLoader 0:   8%|‚ñä         | 14/182 [00:08<01:37,  1.73it/s]Testing DataLoader 0:   8%|‚ñä         | 15/182 [00:08<01:36,  1.73it/s]Testing DataLoader 0:   9%|‚ñâ         | 16/182 [00:09<01:35,  1.74it/s]Testing DataLoader 0:   9%|‚ñâ         | 17/182 [00:09<01:34,  1.74it/s]Testing DataLoader 0:  10%|‚ñâ         | 18/182 [00:10<01:34,  1.74it/s]Testing DataLoader 0:  10%|‚ñà         | 19/182 [00:10<01:33,  1.75it/s]Testing DataLoader 0:  11%|‚ñà         | 20/182 [00:11<01:32,  1.75it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 21/182 [00:11<01:31,  1.75it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 22/182 [00:12<01:31,  1.76it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 23/182 [00:13<01:30,  1.76it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 24/182 [00:13<01:29,  1.76it/s]Testing DataLoader 0:  14%|‚ñà‚ñé        | 25/182 [00:14<01:29,  1.76it/s]Testing DataLoader 0:  14%|‚ñà‚ñç        | 26/182 [00:14<01:28,  1.76it/s]Testing DataLoader 0:  15%|‚ñà‚ñç        | 27/182 [00:15<01:27,  1.77it/s]Testing DataLoader 0:  15%|‚ñà‚ñå        | 28/182 [00:15<01:27,  1.77it/s]Testing DataLoader 0:  16%|‚ñà‚ñå        | 29/182 [00:16<01:26,  1.77it/s]Testing DataLoader 0:  16%|‚ñà‚ñã        | 30/182 [00:16<01:25,  1.77it/s]Testing DataLoader 0:  17%|‚ñà‚ñã        | 31/182 [00:17<01:25,  1.77it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 32/182 [00:18<01:24,  1.77it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 33/182 [00:18<01:23,  1.78it/s]Testing DataLoader 0:  19%|‚ñà‚ñä        | 34/182 [00:19<01:23,  1.78it/s]Testing DataLoader 0:  19%|‚ñà‚ñâ        | 35/182 [00:19<01:22,  1.78it/s]Testing DataLoader 0:  20%|‚ñà‚ñâ        | 36/182 [00:20<01:22,  1.78it/s]Testing DataLoader 0:  20%|‚ñà‚ñà        | 37/182 [00:20<01:21,  1.78it/s]Testing DataLoader 0:  21%|‚ñà‚ñà        | 38/182 [00:21<01:20,  1.78it/s]Testing DataLoader 0:  21%|‚ñà‚ñà‚ñè       | 39/182 [00:21<01:20,  1.78it/s]Testing DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 40/182 [00:22<01:19,  1.78it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 41/182 [00:23<01:19,  1.78it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 42/182 [00:23<01:18,  1.78it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñé       | 43/182 [00:24<01:17,  1.78it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñç       | 44/182 [00:24<01:17,  1.78it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñç       | 45/182 [00:25<01:16,  1.78it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñå       | 46/182 [00:25<01:16,  1.79it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 47/182 [00:26<01:15,  1.79it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñã       | 48/182 [00:26<01:14,  1.79it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 49/182 [00:27<01:14,  1.79it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 50/182 [00:27<01:13,  1.79it/s]Testing DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 51/182 [00:28<01:13,  1.79it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñä       | 52/182 [00:29<01:12,  1.79it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñâ       | 53/182 [00:29<01:12,  1.79it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñâ       | 54/182 [00:30<01:11,  1.79it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñà       | 55/182 [00:30<01:10,  1.79it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà       | 56/182 [00:31<01:10,  1.79it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà‚ñè      | 57/182 [00:31<01:09,  1.79it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 58/182 [00:32<01:09,  1.79it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 59/182 [00:32<01:08,  1.79it/s]Testing DataLoader 0:  33%|‚ñà‚ñà‚ñà‚ñé      | 60/182 [00:33<01:08,  1.79it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñé      | 61/182 [00:34<01:07,  1.79it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñç      | 62/182 [00:34<01:06,  1.79it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñç      | 63/182 [00:35<01:06,  1.79it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñå      | 64/182 [00:35<01:05,  1.79it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñå      | 65/182 [00:36<01:05,  1.79it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñã      | 66/182 [00:36<01:04,  1.79it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 67/182 [00:37<01:04,  1.79it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 68/182 [00:37<01:03,  1.79it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 69/182 [00:38<01:02,  1.79it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 70/182 [00:38<01:02,  1.80it/s]Testing DataLoader 0:  39%|‚ñà‚ñà‚ñà‚ñâ      | 71/182 [00:39<01:01,  1.80it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñâ      | 72/182 [00:40<01:01,  1.80it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñà      | 73/182 [00:40<01:00,  1.80it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 74/182 [00:41<01:00,  1.80it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 75/182 [00:41<00:59,  1.80it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 76/182 [00:42<00:58,  1.80it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 77/182 [00:42<00:58,  1.80it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 78/182 [00:43<00:57,  1.80it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 79/182 [00:43<00:57,  1.80it/s]Testing DataLoader 0:  44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 80/182 [00:44<00:56,  1.80it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 81/182 [00:45<00:56,  1.80it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 82/182 [00:45<00:55,  1.80it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 83/182 [00:46<00:55,  1.80it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 84/182 [00:46<00:54,  1.80it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 85/182 [00:47<00:53,  1.80it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 86/182 [00:47<00:53,  1.80it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 87/182 [00:48<00:52,  1.80it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 88/182 [00:48<00:52,  1.80it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 89/182 [00:49<00:51,  1.80it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 90/182 [00:49<00:51,  1.80it/s]Testing DataLoader 0:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 91/182 [00:50<00:50,  1.80it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 92/182 [00:51<00:49,  1.80it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 93/182 [00:51<00:49,  1.80it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 94/182 [00:52<00:48,  1.80it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 95/182 [00:52<00:48,  1.80it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 96/182 [00:53<00:47,  1.80it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 97/182 [00:53<00:47,  1.80it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 98/182 [00:54<00:46,  1.80it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 99/182 [00:54<00:46,  1.80it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 100/182 [00:55<00:45,  1.80it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 101/182 [00:55<00:44,  1.80it/s]Testing DataLoader 0:  56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 102/182 [00:56<00:44,  1.80it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 103/182 [00:57<00:43,  1.80it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 104/182 [00:57<00:43,  1.80it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 105/182 [00:58<00:42,  1.80it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 106/182 [00:58<00:42,  1.81it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 107/182 [00:59<00:41,  1.81it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 108/182 [00:59<00:40,  1.81it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 109/182 [01:00<00:40,  1.81it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 110/182 [01:00<00:39,  1.81it/s]Testing DataLoader 0:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 111/182 [01:01<00:39,  1.81it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 112/182 [01:02<00:38,  1.81it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 113/182 [01:02<00:38,  1.81it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 114/182 [01:03<00:37,  1.81it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 115/182 [01:03<00:37,  1.81it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 116/182 [01:04<00:36,  1.81it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 117/182 [01:04<00:35,  1.81it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 118/182 [01:05<00:35,  1.81it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 119/182 [01:05<00:34,  1.81it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 120/182 [01:06<00:34,  1.81it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 121/182 [01:06<00:33,  1.81it/s]Testing DataLoader 0:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 122/182 [01:07<00:33,  1.81it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 123/182 [01:08<00:32,  1.81it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 124/182 [01:08<00:32,  1.81it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 125/182 [01:09<00:31,  1.81it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 126/182 [01:09<00:30,  1.81it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 127/182 [01:10<00:30,  1.81it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 128/182 [01:10<00:29,  1.81it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 129/182 [01:11<00:29,  1.81it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 130/182 [01:11<00:28,  1.81it/s]Testing DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 131/182 [01:12<00:28,  1.81it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 132/182 [01:12<00:27,  1.81it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 133/182 [01:13<00:27,  1.81it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 134/182 [01:14<00:26,  1.81it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 135/182 [01:14<00:25,  1.81it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 136/182 [01:15<00:25,  1.81it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 137/182 [01:15<00:24,  1.81it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 138/182 [01:16<00:24,  1.81it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 139/182 [01:16<00:23,  1.81it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 140/182 [01:17<00:23,  1.81it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 141/182 [01:17<00:22,  1.81it/s]Testing DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 142/182 [01:18<00:22,  1.81it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 143/182 [01:18<00:21,  1.81it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 144/182 [01:19<00:20,  1.81it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 145/182 [01:20<00:20,  1.81it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 146/182 [01:20<00:19,  1.81it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 147/182 [01:21<00:19,  1.81it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 148/182 [01:21<00:18,  1.81it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 149/182 [01:22<00:18,  1.81it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 150/182 [01:22<00:17,  1.81it/s]Testing DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 151/182 [01:23<00:17,  1.81it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 152/182 [01:23<00:16,  1.81it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 153/182 [01:24<00:16,  1.81it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 154/182 [01:24<00:15,  1.81it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 155/182 [01:25<00:14,  1.81it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 156/182 [01:26<00:14,  1.81it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 157/182 [01:26<00:13,  1.81it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 158/182 [01:27<00:13,  1.81it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 159/182 [01:27<00:12,  1.81it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 160/182 [01:28<00:12,  1.81it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 161/182 [01:28<00:11,  1.81it/s]Testing DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 162/182 [01:29<00:11,  1.81it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 163/182 [01:29<00:10,  1.81it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 164/182 [01:30<00:09,  1.81it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 165/182 [01:31<00:09,  1.81it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 166/182 [01:31<00:08,  1.81it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 167/182 [01:32<00:08,  1.81it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 168/182 [01:32<00:07,  1.81it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 169/182 [01:33<00:07,  1.81it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 170/182 [01:33<00:06,  1.81it/s]Testing DataLoader 0:  94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 171/182 [01:34<00:06,  1.81it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 172/182 [01:34<00:05,  1.81it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 173/182 [01:35<00:04,  1.81it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 174/182 [01:35<00:04,  1.81it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 175/182 [01:36<00:03,  1.81it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 176/182 [01:37<00:03,  1.81it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 177/182 [01:37<00:02,  1.81it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 178/182 [01:38<00:02,  1.81it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 179/182 [01:38<00:01,  1.81it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 180/182 [01:39<00:01,  1.81it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 181/182 [01:39<00:00,  1.81it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.82it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.82it/s]wandb: - 0.014 MB of 0.014 MB uploadedwandb: \ 0.014 MB of 0.014 MB uploadedwandb: | 0.014 MB of 0.024 MB uploadedwandb: / 0.014 MB of 0.024 MB uploadedwandb: - 0.024 MB of 0.024 MB uploadedwandb:                                                                                
wandb: üöÄ View run ac_flow_model_split_2 at: https://wandb.ai/thomasyuan/cub_afa_results/runs/j4cq3295
wandb: ‚≠êÔ∏è View project at: https://wandb.ai/thomasyuan/cub_afa_results
wandb: Synced 5 W&B file(s), 0 media file(s), 0 artifact file(s) and 0 other file(s)
wandb: Find logs at: ./wandb/run-20240514_212041-j4cq3295/logs
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): o151352.ingest.sentry.io:443
DEBUG:urllib3.connectionpool:https://o151352.ingest.sentry.io:443 "POST /api/4504800232407040/envelope/ HTTP/1.1" 200 0
[rank: 0] Global seed set to 44
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_1_model_trial_2.pt
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240514_212230-0ocl0tyh
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_3
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_afa_results
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_afa_results/runs/0ocl0tyh
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_3.pt
DEBUG:root:Loaded model
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Testing with budget None

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Test metric             DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      test_accuracy         0.8306869268417358
        test_nll            -0.5926539301872253
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
AC Model test_accuracy: 83.07%, 
AC Model test_nll: -59.27%, 
AC Model training_time: 173581.77%, 
AC Model num_epochs: 2400.00%, 
with 24.0 epochs in 1735.82 seconds
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_3]
config:
<built-in function localtime>
	start_split -> 2
	top_k_accuracy -> None
	save_model -> True
	patience -> 5
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	weight_loss -> True
	c_extractor_arch -> resnet34
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_cbm_loss
	early_stopping_mode -> min
	early_stopping_delta -> 0.0
	momentum -> 0.9
	sigmoidal_prob -> False
	training_intervention_prob -> 0.25
	train_ac_model -> True
	only_train_ac_model -> False
	allow_no_action -> False
	mask_no_action -> True
	train_afa_model -> True
	continue_training -> False
	cbm_aneal_rate -> 1
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> False
	ac_model_config -> {'architecture': 'flow', 'max_epochs': 50, 'batch_size': 32, 'transformations': ['AF', 'TL', 'TL', 'AF'], 'layer_cfg': ['ML', 'LR', 'CP2'], 'rnncp_units': 32, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 200, 'prior_units': 1, 'prior_layers': 2, 'prior_hids': [1, 1], 'optimizer': 'adam', 'learning_rate': 0.0001, 'weight_decay': 0.01, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10, 'patience': 3, 'lambda_nll': 1, 'lambda_xent': 1, 'model_classes': True, 'save_path': 'results/afa/cub_afa/acflow_sampling_1_model_trial_2.pt'}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	normalize_values -> False
	use_ac_model -> True
	afa_model_config -> {'lin_layers': [512, 512, 256, 256], 'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': True, 'normalize_advantages': True, 'num_envs': 1}
	trials -> 3
	results_dir -> results/afa/cub_afa
	dataset -> cub
	num_workers -> 8
	batch_size -> 64
	root_dir -> /home/xty20/cem/cem/data/CUB200/
	sampling_percent -> 1
	test_subsampling -> 0.5
	sampling_groups -> True
	competence_levels -> [1, 0]
	check_val_every_n_epoch -> 3
	intervention_freq -> 1
	intervention_batch_size -> 128
	intervention_policies -> ['afacem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	max_epochs -> 300
	time_last_called -> 2024/05/14 at 21:20:38
	n_concepts -> 112
	n_tasks -> 200
	concept_map -> defaultdict(<class 'list'>, {'has_bill_shape': [0, 1, 2, 3], 'has_wing_color': [4, 5, 6, 7, 8, 9], 'has_upperparts_color': [10, 11, 12, 13, 14, 15], 'has_underparts_color': [16, 17, 18, 19, 20, 21], 'has_breast_pattern': [22, 23, 24], 'has_back_color': [25, 26, 27, 28, 29, 30], 'has_tail_shape': [31], 'has_upper_tail_color': [32, 33, 34, 35, 36], 'has_head_pattern': [37, 38], 'has_breast_color': [39, 40, 41, 42, 43, 44], 'has_throat_color': [45, 46, 47, 48, 49], 'has_eye_color': [50], 'has_bill_length': [51, 52], 'has_forehead_color': [53, 54, 55, 56, 57, 58], 'has_under_tail_color': [59, 60, 61, 62, 63], 'has_nape_color': [64, 65, 66, 67, 68, 69], 'has_belly_color': [70, 71, 72, 73, 74, 75], 'has_wing_shape': [76, 77], 'has_size': [78, 79, 80], 'has_shape': [81, 82], 'has_back_pattern': [83, 84, 85], 'has_tail_pattern': [86, 87, 88], 'has_belly_pattern': [89], 'has_primary_color': [90, 91, 92, 93, 94, 95], 'has_leg_color': [96, 97, 98], 'has_bill_color': [99, 100, 101], 'has_crown_color': [102, 103, 104, 105, 106, 107], 'has_wing_pattern': [108, 109, 110, 111]})
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	num_rollouts -> 1
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	final_reward_ratio -> 1
	intermediate_reward_ratio -> 0.02
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 29713401 ]
[Number of non-trainable parameters in model 14837872 ]
	Found cached model... loading it
DEBUG:root:Restarting run because we could not find test_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa in old results.
DEBUG:root:Getting test results without interventions
DEBUG:root:Testing with budget None
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        Test metric               DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ent_loss                      0.0
          pg_loss             0.042932894080877304
      test_agent_loss          0.4311330318450928
     test_avg_c_y_acc          0.8313036608633436
      test_c_accuracy          0.9497525637968043
        test_c_auc             0.8985154701096789
         test_c_f1             0.9025731990701827
       test_cbm_loss            5.693005561828613
     test_concept_loss         3.1229071617126465
    test_current_steps          2719.86474609375
    test_horizon_limit                 2.0
test_intervention_accuracy     0.8839732888146912
   test_intervention_auc               0.0
  test_intervention_loss       0.4311330318450928
test_intervention_task_loss     2.570098638534546
         test_loss              6.124138832092285
    test_mask_accuracy                 0.0
      test_task_loss                   0.0
      test_y_accuracy          0.7128547579298832
        test_y_auc                     0.0
         test_y_f1             0.5746936810304379
          v_loss               0.38820013403892517
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
val_c_acc: 94.98%, val_y_acc: 71.29%, val_c_auc: 89.85%, val_y_auc: 0.00% with 33.0 epochs in 13367.56 seconds
{
    "batch_size": 64,
    "check_val_every_n_epoch": 3,
    "competence_levels": 1,
    "dataset": "cub",
    "intervention_batch_size": 128,
    "intervention_freq": 1,
    "intervention_policies": [
        "afacem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "num_workers": 8,
    "results_dir": "results/afa/cub_afa",
    "root_dir": "/home/xty20/cem/cem/data/CUB200/",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "final_reward_ratio": 1,
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intermediate_reward_ratio": 0.02,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "num_rollouts": 7,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 1,
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 32,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "lambda_nll": 1,
            "lambda_xent": 1,
            "layer_cfg": [
                "ML",
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 50,
            "model_classes": true,
            "n_components": 200,
            "num_samples": 10,
            "optimizer": "adam",
            "patience": 3,
            "prior": "autoreg",
            "prior_hids": [
                1,
                1
            ],
            "prior_layers": 2,
            "prior_units": 1,
            "rnncp_layers": 2,
            "rnncp_units": 32,
            "transformations": [
                "AF",
                "TL",
                "TL",
                "AF"
            ],
            "weight_decay": 0.01
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": true,
            "ent_coef": 0.0,
            "lin_layers": [
                512,
                512,
                256,
                256
            ],
            "normalize_advantages": true,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "allow_no_action": false,
        "bool": false,
        "c_extractor_arch": "resnet34",
        "cbm_aneal_rate": 1,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 1.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_cbm_loss",
        "emb_size": 16,
        "enable_checkpointing": false,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "mask_no_action": true,
        "momentum": 0.9,
        "normalize_values": false,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 3,
        "run_ois": false,
        "save_model": true,
        "sigmoidal_prob": false,
        "start_split": 1,
        "top_k_accuracy": null,
        "train_ac_model": true,
        "train_afa_model": true,
        "training_intervention_prob": 0.25,
        "use_ac_model": true,
        "weight_decay": 0.001,
        "weight_loss": true
    },
    "test_subsampling": 0.5,
    "trials": 3
}
[TRIAL 2/3 BEGINS AT 15/05/2024 at 19:17:01
Testing: 0it [00:00, ?it/s]Testing:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/182 [00:00<?, ?it/s]Testing DataLoader 0:   1%|          | 1/182 [00:01<04:24,  1.46s/it]Testing DataLoader 0:   1%|          | 2/182 [00:02<03:00,  1.00s/it]Testing DataLoader 0:   2%|‚ñè         | 3/182 [00:02<02:32,  1.17it/s]Testing DataLoader 0:   2%|‚ñè         | 4/182 [00:03<02:17,  1.29it/s]Testing DataLoader 0:   3%|‚ñé         | 5/182 [00:03<02:09,  1.37it/s]Testing DataLoader 0:   3%|‚ñé         | 6/182 [00:04<02:03,  1.43it/s]Testing DataLoader 0:   4%|‚ñç         | 7/182 [00:04<01:58,  1.48it/s]Testing DataLoader 0:   4%|‚ñç         | 8/182 [00:05<01:55,  1.51it/s]Testing DataLoader 0:   5%|‚ñç         | 9/182 [00:05<01:52,  1.54it/s]Testing DataLoader 0:   5%|‚ñå         | 10/182 [00:06<01:49,  1.57it/s]Testing DataLoader 0:   6%|‚ñå         | 11/182 [00:06<01:47,  1.59it/s]Testing DataLoader 0:   7%|‚ñã         | 12/182 [00:07<01:45,  1.60it/s]Testing DataLoader 0:   7%|‚ñã         | 13/182 [00:08<01:44,  1.62it/s]Testing DataLoader 0:   8%|‚ñä         | 14/182 [00:08<01:42,  1.63it/s]Testing DataLoader 0:   8%|‚ñä         | 15/182 [00:09<01:41,  1.64it/s]Testing DataLoader 0:   9%|‚ñâ         | 16/182 [00:09<01:40,  1.65it/s]Testing DataLoader 0:   9%|‚ñâ         | 17/182 [00:10<01:39,  1.66it/s]Testing DataLoader 0:  10%|‚ñâ         | 18/182 [00:10<01:38,  1.67it/s]Testing DataLoader 0:  10%|‚ñà         | 19/182 [00:11<01:37,  1.68it/s]Testing DataLoader 0:  11%|‚ñà         | 20/182 [00:11<01:36,  1.69it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 21/182 [00:12<01:35,  1.69it/s]Testing DataLoader 0:  12%|‚ñà‚ñè        | 22/182 [00:12<01:34,  1.70it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 23/182 [00:13<01:33,  1.70it/s]Testing DataLoader 0:  13%|‚ñà‚ñé        | 24/182 [00:14<01:32,  1.71it/s]Testing DataLoader 0:  14%|‚ñà‚ñé        | 25/182 [00:14<01:31,  1.71it/s]Testing DataLoader 0:  14%|‚ñà‚ñç        | 26/182 [00:15<01:30,  1.72it/s]Testing DataLoader 0:  15%|‚ñà‚ñç        | 27/182 [00:15<01:30,  1.72it/s]Testing DataLoader 0:  15%|‚ñà‚ñå        | 28/182 [00:16<01:29,  1.72it/s]Testing DataLoader 0:  16%|‚ñà‚ñå        | 29/182 [00:16<01:28,  1.73it/s]Testing DataLoader 0:  16%|‚ñà‚ñã        | 30/182 [00:17<01:27,  1.73it/s]Testing DataLoader 0:  17%|‚ñà‚ñã        | 31/182 [00:17<01:27,  1.73it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 32/182 [00:18<01:26,  1.74it/s]Testing DataLoader 0:  18%|‚ñà‚ñä        | 33/182 [00:18<01:25,  1.74it/s]Testing DataLoader 0:  19%|‚ñà‚ñä        | 34/182 [00:19<01:24,  1.74it/s]Testing DataLoader 0:  19%|‚ñà‚ñâ        | 35/182 [00:20<01:24,  1.74it/s]Testing DataLoader 0:  20%|‚ñà‚ñâ        | 36/182 [00:20<01:23,  1.75it/s]Testing DataLoader 0:  20%|‚ñà‚ñà        | 37/182 [00:21<01:22,  1.75it/s]Testing DataLoader 0:  21%|‚ñà‚ñà        | 38/182 [00:21<01:22,  1.75it/s]Testing DataLoader 0:  21%|‚ñà‚ñà‚ñè       | 39/182 [00:22<01:21,  1.75it/s]Testing DataLoader 0:  22%|‚ñà‚ñà‚ñè       | 40/182 [00:22<01:20,  1.75it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 41/182 [00:23<01:20,  1.76it/s]Testing DataLoader 0:  23%|‚ñà‚ñà‚ñé       | 42/182 [00:23<01:19,  1.76it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñé       | 43/182 [00:24<01:19,  1.76it/s]Testing DataLoader 0:  24%|‚ñà‚ñà‚ñç       | 44/182 [00:24<01:18,  1.76it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñç       | 45/182 [00:25<01:17,  1.76it/s]Testing DataLoader 0:  25%|‚ñà‚ñà‚ñå       | 46/182 [00:26<01:17,  1.76it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñå       | 47/182 [00:26<01:16,  1.77it/s]Testing DataLoader 0:  26%|‚ñà‚ñà‚ñã       | 48/182 [00:27<01:15,  1.77it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 49/182 [00:27<01:15,  1.77it/s]Testing DataLoader 0:  27%|‚ñà‚ñà‚ñã       | 50/182 [00:28<01:14,  1.77it/s]Testing DataLoader 0:  28%|‚ñà‚ñà‚ñä       | 51/182 [00:28<01:14,  1.77it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñä       | 52/182 [00:29<01:13,  1.77it/s]Testing DataLoader 0:  29%|‚ñà‚ñà‚ñâ       | 53/182 [00:29<01:12,  1.77it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñâ       | 54/182 [00:30<01:12,  1.77it/s]Testing DataLoader 0:  30%|‚ñà‚ñà‚ñà       | 55/182 [00:31<01:11,  1.77it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà       | 56/182 [00:31<01:10,  1.77it/s]Testing DataLoader 0:  31%|‚ñà‚ñà‚ñà‚ñè      | 57/182 [00:32<01:10,  1.78it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 58/182 [00:32<01:09,  1.78it/s]Testing DataLoader 0:  32%|‚ñà‚ñà‚ñà‚ñè      | 59/182 [00:33<01:09,  1.78it/s]Testing DataLoader 0:  33%|‚ñà‚ñà‚ñà‚ñé      | 60/182 [00:33<01:08,  1.78it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñé      | 61/182 [00:34<01:08,  1.78it/s]Testing DataLoader 0:  34%|‚ñà‚ñà‚ñà‚ñç      | 62/182 [00:34<01:07,  1.78it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñç      | 63/182 [00:35<01:06,  1.78it/s]Testing DataLoader 0:  35%|‚ñà‚ñà‚ñà‚ñå      | 64/182 [00:35<01:06,  1.78it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñå      | 65/182 [00:36<01:05,  1.78it/s]Testing DataLoader 0:  36%|‚ñà‚ñà‚ñà‚ñã      | 66/182 [00:37<01:05,  1.78it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 67/182 [00:37<01:04,  1.78it/s]Testing DataLoader 0:  37%|‚ñà‚ñà‚ñà‚ñã      | 68/182 [00:38<01:03,  1.78it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 69/182 [00:38<01:03,  1.78it/s]Testing DataLoader 0:  38%|‚ñà‚ñà‚ñà‚ñä      | 70/182 [00:39<01:02,  1.79it/s]Testing DataLoader 0:  39%|‚ñà‚ñà‚ñà‚ñâ      | 71/182 [00:39<01:02,  1.79it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñâ      | 72/182 [00:40<01:01,  1.79it/s]Testing DataLoader 0:  40%|‚ñà‚ñà‚ñà‚ñà      | 73/182 [00:40<01:01,  1.79it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 74/182 [00:41<01:00,  1.79it/s]Testing DataLoader 0:  41%|‚ñà‚ñà‚ñà‚ñà      | 75/182 [00:41<00:59,  1.79it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 76/182 [00:42<00:59,  1.79it/s]Testing DataLoader 0:  42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 77/182 [00:43<00:58,  1.79it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 78/182 [00:43<00:58,  1.79it/s]Testing DataLoader 0:  43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 79/182 [00:44<00:57,  1.79it/s]Testing DataLoader 0:  44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 80/182 [00:44<00:56,  1.79it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 81/182 [00:45<00:56,  1.79it/s]Testing DataLoader 0:  45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 82/182 [00:45<00:55,  1.79it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 83/182 [00:46<00:55,  1.79it/s]Testing DataLoader 0:  46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 84/182 [00:46<00:54,  1.79it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 85/182 [00:47<00:54,  1.79it/s]Testing DataLoader 0:  47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 86/182 [00:47<00:53,  1.79it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 87/182 [00:48<00:52,  1.79it/s]Testing DataLoader 0:  48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 88/182 [00:49<00:52,  1.79it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 89/182 [00:49<00:51,  1.79it/s]Testing DataLoader 0:  49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 90/182 [00:50<00:51,  1.79it/s]Testing DataLoader 0:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 91/182 [00:50<00:50,  1.79it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 92/182 [00:51<00:50,  1.79it/s]Testing DataLoader 0:  51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 93/182 [00:51<00:49,  1.80it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 94/182 [00:52<00:49,  1.80it/s]Testing DataLoader 0:  52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 95/182 [00:52<00:48,  1.80it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 96/182 [00:53<00:47,  1.80it/s]Testing DataLoader 0:  53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 97/182 [00:53<00:47,  1.80it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 98/182 [00:54<00:46,  1.80it/s]Testing DataLoader 0:  54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 99/182 [00:55<00:46,  1.80it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 100/182 [00:55<00:45,  1.80it/s]Testing DataLoader 0:  55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 101/182 [00:56<00:45,  1.80it/s]Testing DataLoader 0:  56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 102/182 [00:56<00:44,  1.80it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 103/182 [00:57<00:43,  1.80it/s]Testing DataLoader 0:  57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 104/182 [00:57<00:43,  1.80it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 105/182 [00:58<00:42,  1.80it/s]Testing DataLoader 0:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 106/182 [00:58<00:42,  1.80it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 107/182 [00:59<00:41,  1.80it/s]Testing DataLoader 0:  59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 108/182 [01:00<00:41,  1.80it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 109/182 [01:00<00:40,  1.80it/s]Testing DataLoader 0:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 110/182 [01:01<00:39,  1.80it/s]Testing DataLoader 0:  61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 111/182 [01:01<00:39,  1.80it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 112/182 [01:02<00:38,  1.80it/s]Testing DataLoader 0:  62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 113/182 [01:02<00:38,  1.80it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 114/182 [01:03<00:37,  1.80it/s]Testing DataLoader 0:  63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 115/182 [01:03<00:37,  1.80it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 116/182 [01:04<00:36,  1.80it/s]Testing DataLoader 0:  64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 117/182 [01:04<00:36,  1.80it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 118/182 [01:05<00:35,  1.80it/s]Testing DataLoader 0:  65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 119/182 [01:06<00:34,  1.80it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 120/182 [01:06<00:34,  1.80it/s]Testing DataLoader 0:  66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 121/182 [01:07<00:33,  1.80it/s]Testing DataLoader 0:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 122/182 [01:07<00:33,  1.80it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 123/182 [01:08<00:32,  1.80it/s]Testing DataLoader 0:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 124/182 [01:08<00:32,  1.80it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 125/182 [01:09<00:31,  1.80it/s]Testing DataLoader 0:  69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 126/182 [01:09<00:31,  1.80it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 127/182 [01:10<00:30,  1.80it/s]Testing DataLoader 0:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 128/182 [01:10<00:29,  1.80it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 129/182 [01:11<00:29,  1.80it/s]Testing DataLoader 0:  71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 130/182 [01:12<00:28,  1.80it/s]Testing DataLoader 0:  72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 131/182 [01:12<00:28,  1.80it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 132/182 [01:13<00:27,  1.80it/s]Testing DataLoader 0:  73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 133/182 [01:13<00:27,  1.81it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 134/182 [01:14<00:26,  1.81it/s]Testing DataLoader 0:  74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 135/182 [01:14<00:26,  1.81it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 136/182 [01:15<00:25,  1.81it/s]Testing DataLoader 0:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 137/182 [01:15<00:24,  1.81it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 138/182 [01:16<00:24,  1.81it/s]Testing DataLoader 0:  76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 139/182 [01:16<00:23,  1.81it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 140/182 [01:17<00:23,  1.81it/s]Testing DataLoader 0:  77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 141/182 [01:18<00:22,  1.81it/s]Testing DataLoader 0:  78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 142/182 [01:18<00:22,  1.81it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 143/182 [01:19<00:21,  1.81it/s]Testing DataLoader 0:  79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 144/182 [01:19<00:21,  1.81it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 145/182 [01:20<00:20,  1.81it/s]Testing DataLoader 0:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 146/182 [01:20<00:19,  1.81it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 147/182 [01:21<00:19,  1.81it/s]Testing DataLoader 0:  81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 148/182 [01:21<00:18,  1.81it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 149/182 [01:22<00:18,  1.81it/s]Testing DataLoader 0:  82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 150/182 [01:22<00:17,  1.81it/s]Testing DataLoader 0:  83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 151/182 [01:23<00:17,  1.81it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 152/182 [01:24<00:16,  1.81it/s]Testing DataLoader 0:  84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 153/182 [01:24<00:16,  1.81it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 154/182 [01:25<00:15,  1.81it/s]Testing DataLoader 0:  85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 155/182 [01:25<00:14,  1.81it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 156/182 [01:26<00:14,  1.81it/s]Testing DataLoader 0:  86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 157/182 [01:26<00:13,  1.81it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 158/182 [01:27<00:13,  1.81it/s]Testing DataLoader 0:  87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 159/182 [01:27<00:12,  1.81it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 160/182 [01:28<00:12,  1.81it/s]Testing DataLoader 0:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 161/182 [01:28<00:11,  1.81it/s]Testing DataLoader 0:  89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 162/182 [01:29<00:11,  1.81it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 163/182 [01:30<00:10,  1.81it/s]Testing DataLoader 0:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 164/182 [01:30<00:09,  1.81it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 165/182 [01:31<00:09,  1.81it/s]Testing DataLoader 0:  91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 166/182 [01:31<00:08,  1.81it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 167/182 [01:32<00:08,  1.81it/s]Testing DataLoader 0:  92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 168/182 [01:32<00:07,  1.81it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 169/182 [01:33<00:07,  1.81it/s]Testing DataLoader 0:  93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 170/182 [01:33<00:06,  1.81it/s]Testing DataLoader 0:  94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 171/182 [01:34<00:06,  1.81it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 172/182 [01:34<00:05,  1.81it/s]Testing DataLoader 0:  95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 173/182 [01:35<00:04,  1.81it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 174/182 [01:36<00:04,  1.81it/s]Testing DataLoader 0:  96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 175/182 [01:36<00:03,  1.81it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 176/182 [01:37<00:03,  1.81it/s]Testing DataLoader 0:  97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 177/182 [01:37<00:02,  1.81it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 178/182 [01:38<00:02,  1.81it/s]Testing DataLoader 0:  98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 179/182 [01:38<00:01,  1.81it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 180/182 [01:39<00:01,  1.81it/s]Testing DataLoader 0:  99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 181/182 [01:39<00:00,  1.81it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.82it/s]Testing DataLoader 0: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 182/182 [01:40<00:00,  1.82it/s]
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       Test metric             DataLoader 0
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      test_accuracy         0.8163617253303528
        test_nll            -0.4342779219150543
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
AC Model test_accuracy: 81.64%, 
AC Model test_nll: -43.43%, 
AC Model training_time: 123478.32%, 
AC Model num_epochs: 1700.00%, 
with 17.0 epochs in 1234.78 seconds
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2]
config:
<built-in function localtime>
	start_split -> 1
	top_k_accuracy -> None
	save_model -> True
	patience -> 3
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	weight_loss -> True
	c_extractor_arch -> resnet34
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_cbm_loss
	early_stopping_mode -> min
	early_stopping_delta -> 1.0
	momentum -> 0.9
	sigmoidal_prob -> False
	run_ois -> False
	training_intervention_prob -> 0.25
	train_ac_model -> True
	only_train_ac_model -> False
	allow_no_action -> False
	mask_no_action -> True
	train_afa_model -> True
	continue_training -> False
	cbm_aneal_rate -> 1
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> False
	ac_model_config -> {'architecture': 'flow', 'max_epochs': 50, 'batch_size': 32, 'transformations': ['AF', 'TL', 'TL', 'AF'], 'layer_cfg': ['ML', 'LR', 'CP2'], 'rnncp_units': 32, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 200, 'prior_units': 1, 'prior_layers': 2, 'prior_hids': [1, 1], 'optimizer': 'adam', 'learning_rate': 0.0001, 'weight_decay': 0.01, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10, 'patience': 3, 'lambda_nll': 1, 'lambda_xent': 1, 'model_classes': True, 'save_path': 'results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt'}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	normalize_values -> False
	use_ac_model -> True
	afa_model_config -> {'lin_layers': [512, 512, 256, 256], 'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': True, 'normalize_advantages': True, 'num_envs': 1}
	trials -> 3
	results_dir -> results/afa/cub_afa
	dataset -> cub
	num_workers -> 8
	batch_size -> 64
	root_dir -> /home/xty20/cem/cem/data/CUB200/
	sampling_percent -> 1
	test_subsampling -> 0.5
	sampling_groups -> True
	competence_levels -> 1
	check_val_every_n_epoch -> 3
	intervention_freq -> 1
	intervention_batch_size -> 128
	intervention_policies -> ['afacem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	max_epochs -> 300
	time_last_called -> 2024/05/15 at 19:16:59
	n_concepts -> 112
	n_tasks -> 200
	concept_map -> defaultdict(<class 'list'>, {'has_bill_shape': [0, 1, 2, 3], 'has_wing_color': [4, 5, 6, 7, 8, 9], 'has_upperparts_color': [10, 11, 12, 13, 14, 15], 'has_underparts_color': [16, 17, 18, 19, 20, 21], 'has_breast_pattern': [22, 23, 24], 'has_back_color': [25, 26, 27, 28, 29, 30], 'has_tail_shape': [31], 'has_upper_tail_color': [32, 33, 34, 35, 36], 'has_head_pattern': [37, 38], 'has_breast_color': [39, 40, 41, 42, 43, 44], 'has_throat_color': [45, 46, 47, 48, 49], 'has_eye_color': [50], 'has_bill_length': [51, 52], 'has_forehead_color': [53, 54, 55, 56, 57, 58], 'has_under_tail_color': [59, 60, 61, 62, 63], 'has_nape_color': [64, 65, 66, 67, 68, 69], 'has_belly_color': [70, 71, 72, 73, 74, 75], 'has_wing_shape': [76, 77], 'has_size': [78, 79, 80], 'has_shape': [81, 82], 'has_back_pattern': [83, 84, 85], 'has_tail_pattern': [86, 87, 88], 'has_belly_pattern': [89], 'has_primary_color': [90, 91, 92, 93, 94, 95], 'has_leg_color': [96, 97, 98], 'has_bill_color': [99, 100, 101], 'has_crown_color': [102, 103, 104, 105, 106, 107], 'has_wing_pattern': [108, 109, 110, 111]})
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	num_rollouts -> 7
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	final_reward_ratio -> 1
	intermediate_reward_ratio -> 0.02
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 29713401 ]
[Number of non-trainable parameters in model 14837872 ]
	Found cached model... loading it
INFO:root:Results will be dumped in results/afa/cub_afa
DEBUG:root:And the dataset's root directory is /home/xty20/cem/cem/data/CUB200/
[rank: 0] Global seed set to 42
[rank: 0] Global seed set to 42
{
    "batch_size": 64,
    "check_val_every_n_epoch": 3,
    "competence_levels": 1,
    "dataset": "cub",
    "intervention_batch_size": 128,
    "intervention_freq": 1,
    "intervention_policies": [
        "afacem_policy",
        "optimal_greedy_no_prior",
        "group_random_no_prior"
    ],
    "max_epochs": 300,
    "num_workers": 8,
    "results_dir": "results/afa/cub_afa",
    "root_dir": "/home/xty20/cem/cem/data/CUB200/",
    "runs": [
        {
            "architecture": "IntAwareConceptEmbeddingModel",
            "average_trajectory": true,
            "beta_a": 1,
            "beta_b": 3,
            "embedding_activation": "leakyrelu",
            "extra_name": "Retry_concept_loss_weight_{concept_loss_weight}_intervention_weight_{intervention_weight}_horizon_rate_{horizon_rate}_intervention_discount_{intervention_discount}_task_discount_{intervention_task_discount}_sampling_percent_{sampling_percent}",
            "final_reward_ratio": 1,
            "horizon_binary_representation": true,
            "horizon_rate": 1.005,
            "horizon_uniform_distr": true,
            "include_only_last_trajectory_loss": true,
            "include_task_trajectory_loss": true,
            "initial_horizon": 2,
            "initialize_discount": false,
            "int_model_layers": [
                128,
                128,
                64,
                64
            ],
            "int_model_use_bn": true,
            "intcem_task_loss_weight": 0,
            "intermediate_reward_ratio": 0.02,
            "intervention_discount": 1,
            "intervention_task_discount": 1.1,
            "intervention_task_loss_weight": 1,
            "intervention_weight": 1,
            "legacy_mode": false,
            "max_horizon": 6,
            "model_pretrain_path": null,
            "num_rollouts": 1,
            "propagate_target_gradients": false,
            "task_loss_weight": 0,
            "tau": 1,
            "training_intervention_prob": 0.25,
            "use_concept_groups": true,
            "use_full_mask_distr": false,
            "use_horizon": false
        }
    ],
    "sampling_groups": true,
    "sampling_percent": 1,
    "shared_params": {
        "ac_model_config": {
            "affine_hids": [
                256,
                256
            ],
            "architecture": "flow",
            "batch_size": 32,
            "clip_gradient": 1,
            "coupling_hids": [
                256,
                256
            ],
            "decay_rate": 0.5,
            "decay_steps": 10000,
            "lambda_nll": 1,
            "lambda_xent": 1,
            "layer_cfg": [
                "ML",
                "LR",
                "CP2"
            ],
            "learning_rate": 0.0001,
            "linear_hids": [
                256,
                256
            ],
            "linear_rank": -1,
            "max_epochs": 50,
            "model_classes": true,
            "n_components": 200,
            "num_samples": 10,
            "optimizer": "adam",
            "patience": 3,
            "prior": "autoreg",
            "prior_hids": [
                1,
                1
            ],
            "prior_layers": 2,
            "prior_units": 1,
            "rnncp_layers": 2,
            "rnncp_units": 32,
            "transformations": [
                "AF",
                "TL",
                "TL",
                "AF"
            ],
            "weight_decay": 0.01
        },
        "ac_model_nll_ratio": 0.5,
        "ac_model_rollouts": 1,
        "ac_model_weight": 2,
        "afa_model_config": {
            "act_fun": "relu",
            "clip_coef": 0.2,
            "clip_vloss": true,
            "ent_coef": 0.0,
            "lin_layers": [
                512,
                512,
                256,
                256
            ],
            "normalize_advantages": true,
            "num_envs": 1,
            "ortho_init": false,
            "vf_coef": 1.0
        },
        "allow_no_action": false,
        "bool": false,
        "c_extractor_arch": "resnet34",
        "cbm_aneal_rate": 1,
        "cbm_starting_aneal_rate": 1,
        "concept_loss_weight": 5,
        "continue_training": false,
        "early_stopping_delta": 1.0,
        "early_stopping_mode": "min",
        "early_stopping_monitor": "val_cbm_loss",
        "emb_size": 16,
        "enable_checkpointing": false,
        "extra_dims": 0,
        "learning_rate": 0.0001,
        "mask_no_action": true,
        "momentum": 0.9,
        "normalize_values": false,
        "only_train_ac_model": false,
        "optimizer": "adam",
        "patience": 3,
        "run_ois": false,
        "save_model": true,
        "sigmoidal_prob": false,
        "start_split": 1,
        "top_k_accuracy": null,
        "train_ac_model": false,
        "train_afa_model": true,
        "training_intervention_prob": 0.25,
        "use_ac_model": true,
        "weight_decay": 0.001,
        "weight_loss": true
    },
    "test_subsampling": 0.5,
    "trials": 3
}
INFO:root:Training sample shape is: torch.Size([64, 3, 299, 299]) with type torch.FloatTensor
INFO:root:Training label shape is: torch.Size([64]) with type torch.LongTensor
INFO:root:	Number of output classes: 200
INFO:root:Training concept shape is: torch.Size([64, 112]) with type torch.FloatTensor
INFO:root:	Number of training concepts: 112
INFO:root:Setting log level to: "DEBUG"
DEBUG:root:Setting ac model save path to be results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt
[rank: 0] Global seed set to 43
DEBUG:root:AC CBM loaded AC model checkpoint from results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt
DEBUG:git.util:Failed checking if running in CYGWIN due to: FileNotFoundError(2, 'No such file or directory')
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:git.cmd:Popen(['git', 'rev-parse', '--show-toplevel'], cwd=/home/xty20/cem, stdin=None, shell=False, universal_newlines=False)
DEBUG:urllib3.connectionpool:Starting new HTTPS connection (1): api.wandb.ai:443
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
DEBUG:urllib3.connectionpool:https://api.wandb.ai:443 "POST /graphql HTTP/1.1" 200 None
wandb: Currently logged in as: thomasyuan1 (thomasyuan). Use `wandb login --relogin` to force relogin
DEBUG:git.cmd:Popen(['git', 'cat-file', '--batch-check'], cwd=/home/xty20/cem, stdin=<valid stream>, shell=False, universal_newlines=False)
wandb: wandb version 0.17.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.16.6
wandb: Run data is saved locally in /home/xty20/cem/wandb/run-20240515_192415-n0a1rtdf
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2
wandb: ‚≠êÔ∏è View project at https://wandb.ai/thomasyuan/cub_afa_results
wandb: üöÄ View run at https://wandb.ai/thomasyuan/cub_afa_results/runs/n0a1rtdf
DEBUG:root:Loading trained model from results/afa/cub_afa/IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2.pt
DEBUG:root:Loaded model
DEBUG:root:Restarting run because we could not find val_acc_c_IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa in old results.
DEBUG:root:Getting validation results.
DEBUG:root:Testing with budget None
[TRIAL 2/3 BEGINS AT 15/05/2024 at 19:24:13
[Training IntAwareConceptEmbeddingModelRetry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa_resnet34_fold_2]
config:
<built-in function localtime>
	start_split -> 1
	top_k_accuracy -> None
	save_model -> True
	patience -> 3
	emb_size -> 16
	extra_dims -> 0
	concept_loss_weight -> 5
	learning_rate -> 0.0001
	weight_decay -> 0.001
	weight_loss -> True
	c_extractor_arch -> resnet34
	optimizer -> adam
	bool -> False
	early_stopping_monitor -> val_cbm_loss
	early_stopping_mode -> min
	early_stopping_delta -> 1.0
	momentum -> 0.9
	sigmoidal_prob -> False
	run_ois -> False
	training_intervention_prob -> 0.25
	train_ac_model -> False
	only_train_ac_model -> False
	allow_no_action -> False
	mask_no_action -> True
	train_afa_model -> True
	continue_training -> False
	cbm_aneal_rate -> 1
	cbm_starting_aneal_rate -> 1
	enable_checkpointing -> False
	ac_model_config -> {'architecture': 'flow', 'max_epochs': 50, 'batch_size': 32, 'transformations': ['AF', 'TL', 'TL', 'AF'], 'layer_cfg': ['ML', 'LR', 'CP2'], 'rnncp_units': 32, 'rnncp_layers': 2, 'linear_hids': [256, 256], 'linear_rank': -1, 'affine_hids': [256, 256], 'coupling_hids': [256, 256], 'prior': 'autoreg', 'n_components': 200, 'prior_units': 1, 'prior_layers': 2, 'prior_hids': [1, 1], 'optimizer': 'adam', 'learning_rate': 0.0001, 'weight_decay': 0.01, 'decay_steps': 10000, 'decay_rate': 0.5, 'clip_gradient': 1, 'num_samples': 10, 'patience': 3, 'lambda_nll': 1, 'lambda_xent': 1, 'model_classes': True, 'save_path': 'results/afa/cub_afa/acflow_sampling_1_model_trial_1.pt'}
	ac_model_nll_ratio -> 0.5
	ac_model_weight -> 2
	ac_model_rollouts -> 1
	normalize_values -> False
	use_ac_model -> True
	afa_model_config -> {'lin_layers': [512, 512, 256, 256], 'act_fun': 'relu', 'ortho_init': False, 'vf_coef': 1.0, 'ent_coef': 0.0, 'clip_coef': 0.2, 'clip_vloss': True, 'normalize_advantages': True, 'num_envs': 1}
	trials -> 3
	results_dir -> results/afa/cub_afa
	dataset -> cub
	num_workers -> 8
	batch_size -> 64
	root_dir -> /home/xty20/cem/cem/data/CUB200/
	sampling_percent -> 1
	test_subsampling -> 0.5
	sampling_groups -> True
	competence_levels -> 1
	check_val_every_n_epoch -> 3
	intervention_freq -> 1
	intervention_batch_size -> 128
	intervention_policies -> ['afacem_policy', 'optimal_greedy_no_prior', 'group_random_no_prior']
	max_epochs -> 300
	time_last_called -> 2024/05/15 at 19:24:11
	n_concepts -> 112
	n_tasks -> 200
	concept_map -> defaultdict(<class 'list'>, {'has_bill_shape': [0, 1, 2, 3], 'has_wing_color': [4, 5, 6, 7, 8, 9], 'has_upperparts_color': [10, 11, 12, 13, 14, 15], 'has_underparts_color': [16, 17, 18, 19, 20, 21], 'has_breast_pattern': [22, 23, 24], 'has_back_color': [25, 26, 27, 28, 29, 30], 'has_tail_shape': [31], 'has_upper_tail_color': [32, 33, 34, 35, 36], 'has_head_pattern': [37, 38], 'has_breast_color': [39, 40, 41, 42, 43, 44], 'has_throat_color': [45, 46, 47, 48, 49], 'has_eye_color': [50], 'has_bill_length': [51, 52], 'has_forehead_color': [53, 54, 55, 56, 57, 58], 'has_under_tail_color': [59, 60, 61, 62, 63], 'has_nape_color': [64, 65, 66, 67, 68, 69], 'has_belly_color': [70, 71, 72, 73, 74, 75], 'has_wing_shape': [76, 77], 'has_size': [78, 79, 80], 'has_shape': [81, 82], 'has_back_pattern': [83, 84, 85], 'has_tail_pattern': [86, 87, 88], 'has_belly_pattern': [89], 'has_primary_color': [90, 91, 92, 93, 94, 95], 'has_leg_color': [96, 97, 98], 'has_bill_color': [99, 100, 101], 'has_crown_color': [102, 103, 104, 105, 106, 107], 'has_wing_pattern': [108, 109, 110, 111]})
	architecture -> IntAwareConceptEmbeddingModel
	extra_name -> Retry_concept_loss_weight_5_intervention_weight_1_horizon_rate_1.005_intervention_discount_1_task_discount_1.1_sampling_percent_1_afa
	horizon_binary_representation -> True
	include_task_trajectory_loss -> True
	include_only_last_trajectory_loss -> True
	task_loss_weight -> 0
	intervention_weight -> 1
	intervention_task_loss_weight -> 1
	initial_horizon -> 2
	use_concept_groups -> True
	use_full_mask_distr -> False
	propagate_target_gradients -> False
	int_model_use_bn -> True
	int_model_layers -> [128, 128, 64, 64]
	intcem_task_loss_weight -> 0
	embedding_activation -> leakyrelu
	tau -> 1
	max_horizon -> 6
	horizon_uniform_distr -> True
	num_rollouts -> 1
	beta_a -> 1
	beta_b -> 3
	intervention_task_discount -> 1.1
	final_reward_ratio -> 1
	intermediate_reward_ratio -> 0.02
	average_trajectory -> True
	use_horizon -> False
	initialize_discount -> False
	model_pretrain_path -> None
	horizon_rate -> 1.005
	intervention_discount -> 1
	legacy_mode -> False
[Number of parameters in model 29713401 ]
[Number of non-trainable parameters in model 14837872 ]
	Found cached model... loading it
Traceback (most recent call last):
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 374, in train_model
    values, _ = utils.load_call(
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/utils.py", line 90, in load_call
    return function(**kwargs), False
  File "/home/xty20/cem/venv/lib/python3.8/site-packages/cem-1.1.0-py3.8.egg/cem/train/training.py", line 336, in _inner_call
    [val_results] = trainer.test(model, val_dl)
TypeError: cannot unpack non-iterable NoneType object
wandb: ERROR Control-C detected -- Run data was not synced
